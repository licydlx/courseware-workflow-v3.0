{
    "sourceFile": "assets/prefabLibrary/models/t4-model/t4-05-model/t4-05-model-v3.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 87,
            "patches": [
                {
                    "date": 1625119227755,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1625119238440,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,9 +10,9 @@\n const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n const { ccclass, property } = cc._decorator;\r\n \r\n @ccclass\r\n-export default class t4_05_model_v2 extends cc.Component {\r\n+export default class t4_05_model_v3 extends cc.Component {\r\n     private _worldRoot: cc.Node;\r\n \r\n     private _view: fgui.GComponent;\r\n \r\n"
                },
                {
                    "date": 1625119562351,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -126,24 +126,17 @@\n         fgui.GRoot.inst.addChild(this._view);\r\n \r\n         this._c1 = this._view.getController(\"c1\");\r\n \r\n-        this._drawLan = this._view.getChild('lan').asImage;\r\n-        this._drawRed = this._view.getChild('red').asImage;\r\n \r\n-        this._lanRect = new cc.Rect(this._drawLan.x, this._drawLan.y, this._drawLan.width, this._drawLan.height);\r\n-        this._redRect = new cc.Rect(this._drawRed.x, this._drawRed.y, this._drawRed.width, this._drawRed.height);\r\n \r\n         // 臨時\r\n         // bug 初始设置不播放不生效\r\n         if (this._c1) {\r\n             this._c1.selectedIndex = 1;\r\n             this._c1.selectedIndex = 0;\r\n         }\r\n \r\n-        this._maskBg = this._view.getChild(\"maskBg\").asGraph;\r\n-        this._maskBg.visible = true;\r\n-\r\n         this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n         if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n \r\n         this._title = this._view.getChild(\"title\").asButton;\r\n@@ -153,16 +146,12 @@\n \r\n         this._startBtn = this._view.getChild(\"start\").asButton;\r\n         this._startBtn.on(fgui.Event.CLICK, this._clickStart, this);\r\n \r\n-        this._player = this._view.getChild('player').asImage;\r\n-        this._player.x = this._view.width;\r\n-        this._playerRect = new cc.Rect(this._player.x - 36, this._player.y + 10, 25, this._player.height);\r\n+        this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n+        this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n+        this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n-        this._view.off(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n-        this._view.off(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n-        this._view.off(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n-\r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n         this.graphics = huiNode.addComponent(cc.Graphics);\r\n"
                },
                {
                    "date": 1625119591172,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,9 +153,9 @@\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n-        this.graphics = huiNode.addComponent(cc.Graphics);\r\n+        this.graphics = this._view.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625119599508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -153,9 +153,9 @@\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n-        this.graphics = this._view.addComponent(cc.Graphics);\r\n+        this.graphics = this.node.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625119683176,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,43 +27,10 @@\n     private _package: any;\r\n \r\n     private _touchesPos: cc.Vec2[] = [];\r\n \r\n-    private _touchXMax: number = 0;\r\n-\r\n-    private _touchXMin: number = 0;\r\n-\r\n     private graphics: cc.Graphics = null;\r\n \r\n-    private _zhiLine: fgui.GObject;\r\n-\r\n-    private _drawLan: fgui.GImage;\r\n-\r\n-    private _moveMinX: number = 430;\r\n-\r\n-    private _lanRect: cc.Rect;\r\n-    private _redRect: cc.Rect;\r\n-    private _playerRect: cc.Rect;\r\n-    private _drawLineRect: cc.Rect;\r\n-\r\n-    private _drawRed: fgui.GImage;\r\n-\r\n-    private _maskBg: fgui.GGraph;\r\n-\r\n-    private _player: fgui.GImage;\r\n-\r\n-    private _moveSpeed: number = 1;\r\n-\r\n-    private _gameTime: number = 0;\r\n-\r\n-    private _defaultMinX: number = 550;\r\n-\r\n-    private _defaultMaxX: number = 1290;\r\n-\r\n-    private _defaultMidPosY: number = 635;\r\n-\r\n-    private _framesSecond: number = 20; //1秒钟运行20帧（次）\r\n-\r\n     private _dragging = false;\r\n \r\n     private _scheduleTime = 0.01;\r\n \r\n@@ -164,12 +131,9 @@\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n-            gameStart: false,\r\n-            gameOver: this.gameResult.No,\r\n             touch: \"end\",\r\n-            touchesPos: []\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n"
                },
                {
                    "date": 1625119721979,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,42 +33,16 @@\n     private _dragging = false;\r\n \r\n     private _scheduleTime = 0.01;\r\n \r\n-    private _showPosArr: any = [\r\n-        { 'line': { x: 25, y: 250 }, 'lan': { x: 16, y: 218 }, 'red': { x: 472, y: 218 } },\r\n-        { 'line': { x: 25, y: 345 }, 'lan': { x: 16, y: 312 }, 'red': { x: 472, y: 312 } },\r\n-        { 'line': { x: 25, y: 438 }, 'lan': { x: 16, y: 404 }, 'red': { x: 472, y: 404 } }];\r\n-\r\n-    private _showLines: any = [];\r\n-\r\n-    private _showLinesObj: any = [];\r\n-\r\n-    private _startBtn: fgui.GButton;\r\n-\r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n         GuideShow: 1,\r\n         WrongFeed: 2,\r\n         RightFeed: 3\r\n     });\r\n \r\n-    private gameResult: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        Fail: 2,\r\n-        Success: 3\r\n-    });\r\n-\r\n-    private lineType: any = cc.Enum({\r\n-\r\n-        StraightLine: 0,\r\n-        LineSegment: 1,\r\n-        LeftLanRays: 2,\r\n-        RightRedRays: 3\r\n-    });\r\n-\r\n     // 远程动态组件\r\n     private feedback: any;\r\n \r\n     private _state = {};\r\n"
                },
                {
                    "date": 1625119732919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,10 +67,8 @@\n         fgui.GRoot.inst.addChild(this._view);\r\n \r\n         this._c1 = this._view.getController(\"c1\");\r\n \r\n-\r\n-\r\n         // 臨時\r\n         // bug 初始设置不播放不生效\r\n         if (this._c1) {\r\n             this._c1.selectedIndex = 1;\r\n"
                },
                {
                    "date": 1625119744321,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -82,9 +82,9 @@\n \r\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n-        this._startBtn = this._view.getChild(\"start\").asButton;\r\n+        this._startBtn = this._view.getChild(\"restart\").asButton;\r\n         this._startBtn.on(fgui.Event.CLICK, this._clickStart, this);\r\n \r\n         this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n"
                },
                {
                    "date": 1625119761793,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -82,10 +82,10 @@\n \r\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n-        this._startBtn = this._view.getChild(\"restart\").asButton;\r\n-        this._startBtn.on(fgui.Event.CLICK, this._clickStart, this);\r\n+        this._restartBtn = this._view.getChild(\"restart\").asButton;\r\n+        this._restartBtn.on(fgui.Event.CLICK, this._clickStart, this);\r\n \r\n         this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n"
                },
                {
                    "date": 1625119771758,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,8 +23,11 @@\n     private _titleTrigger: fgui.GLoader;\r\n \r\n     private _submitBtn: fgui.GButton;\r\n \r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    _restartBtn\r\n     private _package: any;\r\n \r\n     private _touchesPos: cc.Vec2[] = [];\r\n \r\n"
                },
                {
                    "date": 1625119777290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,11 +23,10 @@\n     private _titleTrigger: fgui.GLoader;\r\n \r\n     private _submitBtn: fgui.GButton;\r\n \r\n-    private _submitBtn: fgui.GButton;\r\n+    private _restartBtn: fgui.GButton;\r\n \r\n-    _restartBtn\r\n     private _package: any;\r\n \r\n     private _touchesPos: cc.Vec2[] = [];\r\n \r\n"
                },
                {
                    "date": 1625119811740,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n         this._restartBtn = this._view.getChild(\"restart\").asButton;\r\n-        this._restartBtn.on(fgui.Event.CLICK, this._clickStart, this);\r\n+        this._restartBtn.on(fgui.Event.CLICK, this._clickReStart, this);\r\n \r\n         this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n@@ -250,9 +250,9 @@\n             return value1 - value2;\r\n         }\r\n     }\r\n \r\n-    private _clickStart(evt: any) {\r\n+    private _clickReStart(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.gameStart = true;\r\n         this.updateState(state);\r\n \r\n"
                },
                {
                    "date": 1625119858653,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,9 @@\n     private _titleTrigger: fgui.GLoader;\r\n \r\n     private _submitBtn: fgui.GButton;\r\n \r\n-    private _restartBtn: fgui.GButton;\r\n+    private _resetBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n     private _touchesPos: cc.Vec2[] = [];\r\n@@ -84,10 +84,10 @@\n \r\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n-        this._restartBtn = this._view.getChild(\"restart\").asButton;\r\n-        this._restartBtn.on(fgui.Event.CLICK, this._clickReStart, this);\r\n+        this._resetBtn = this._view.getChild(\"restart\").asButton;\r\n+        this._resetBtn.on(fgui.Event.CLICK, this._clickReset, this);\r\n \r\n         this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n@@ -250,9 +250,9 @@\n             return value1 - value2;\r\n         }\r\n     }\r\n \r\n-    private _clickReStart(evt: any) {\r\n+    private _clickReset(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.gameStart = true;\r\n         this.updateState(state);\r\n \r\n"
                },
                {
                    "date": 1625119931322,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,9 @@\n     private graphics: cc.Graphics = null;\r\n \r\n     private _dragging = false;\r\n \r\n-    private _scheduleTime = 0.01;\r\n+    private _scheduleTime = 0.02;\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n@@ -180,69 +180,9 @@\n         state.touch = 'end';\r\n         this.updateState(state);\r\n     }\r\n \r\n-    updatePlayerMove(dt) {\r\n \r\n-        // this.dragSchedule();\r\n-        this._gameTime++;\r\n-        console.log(this._gameTime);\r\n-        if (this._gameTime >= this._framesSecond * 9) {\r\n-\r\n-\r\n-            this._playerRect.x = this._player.x - 36;\r\n-            if (this._drawLineRect.intersects(this._playerRect)) {\r\n-\r\n-                this._moveSpeed = 6;\r\n-                if (this._player.x <= this._moveMinX) {\r\n-                    this._gameTime = 0;\r\n-                    this.unschedule(this.updatePlayerMove);\r\n-                    let state: any = globalThis._.cloneDeep(this._state);\r\n-                    state.gameOver = this.gameResult.Success;\r\n-                    this.updateState(state);\r\n-                }\r\n-\r\n-            } else {\r\n-\r\n-                console.log('===== _player.x ====' + this._player.x);\r\n-                console.log('===== _touchXMin ====' + this._touchXMin);\r\n-                console.log('===== _moveMinX ====' + this._moveMinX);\r\n-\r\n-                console.log(this._drawLineRect);\r\n-                console.log(this._playerRect);\r\n-\r\n-                if (this._player.x > this._touchXMin) {\r\n-\r\n-                    this._gameTime = 0;\r\n-                    this.unschedule(this.updatePlayerMove);\r\n-\r\n-                    //游戏结束\r\n-                    let state: any = globalThis._.cloneDeep(this._state);\r\n-                    state.gameOver = this.gameResult.Fail;\r\n-                    this.updateState(state);\r\n-\r\n-                    return;\r\n-\r\n-                } else if (this._player.x <= this._touchXMin && this._player.x <= this._moveMinX) {\r\n-\r\n-                    this._gameTime = 0;\r\n-                    this.unschedule(this.updatePlayerMove);\r\n-\r\n-                    let state: any = globalThis._.cloneDeep(this._state);\r\n-                    state.gameOver = this.gameResult.Success;\r\n-                    this.updateState(state);\r\n-                    return;\r\n-\r\n-                }\r\n-\r\n-\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        this._player.x -= 4.2 * this._moveSpeed;\r\n-    }\r\n-\r\n     // 排序方法\r\n     comparePos() {\r\n         return function (a, b) {\r\n             var value1 = a.x;\r\n@@ -252,9 +192,9 @@\n     }\r\n \r\n     private _clickReset(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.gameStart = true;\r\n+        state.reset = true;\r\n         this.updateState(state);\r\n \r\n     }\r\n \r\n"
                },
                {
                    "date": 1625120073100,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n-        this.graphics = this.node.addComponent(cc.Graphics);\r\n+        this.graphics = this.huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625120084234,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -106,8 +106,9 @@\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n             touch: \"end\",\r\n+            reset: false,\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n"
                },
                {
                    "date": 1625120147741,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -107,8 +107,9 @@\n             title: false,\r\n             submit: this.submitType.No,\r\n             touch: \"end\",\r\n             reset: false,\r\n+            touchesPos: [],\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n@@ -120,21 +121,11 @@\n         this._package = Package;\r\n \r\n         this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n \r\n-        this._zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n-        this._view.addChild(this._zhiLine);\r\n-        this._drawLineRect = new cc.Rect(this._zhiLine.x, this._zhiLine.y, this._zhiLine.width, this._zhiLine.height);\r\n+        // this._zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n+        // this._view.addChild(this._zhiLine);\r\n \r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n         if (components) {\r\n             for (const key in components) {\r\n                 let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n                 let componentBundle: any = await loadBundle(componentPath);\r\n"
                },
                {
                    "date": 1625120217855,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n-        this.graphics = this.huiNode.addComponent(cc.Graphics);\r\n+        this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625120357065,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -121,11 +121,8 @@\n         this._package = Package;\r\n \r\n         this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n \r\n-        // this._zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n-        // this._view.addChild(this._zhiLine);\r\n-\r\n         if (components) {\r\n             for (const key in components) {\r\n                 let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n                 let componentBundle: any = await loadBundle(componentPath);\r\n@@ -232,9 +229,8 @@\n         if (state.touch == \"start\") {\r\n \r\n             this._touchesPos = state.touchesPos;\r\n             this.graphics.clear();\r\n-            this._zhiLine.visible = false;\r\n             this._touchesPos.length = 0;\r\n \r\n         } else if (state.touch == \"move\") {\r\n \r\n@@ -245,9 +241,10 @@\n             this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n-                this._zhiLine.visible = true;\r\n+                // this._zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n+                // this._view.addChild(this._zhiLine);\r\n                 this._zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 this._zhiLine.x = this._touchesPos[0].x;\r\n                 this._zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 //this._zhiLine.y = 635;\r\n"
                },
                {
                    "date": 1625120362772,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,10 +241,10 @@\n             this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n-                // this._zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n-                // this._view.addChild(this._zhiLine);\r\n+                this._zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n+                this._view.addChild(this._zhiLine);\r\n                 this._zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 this._zhiLine.x = this._touchesPos[0].x;\r\n                 this._zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 //this._zhiLine.y = 635;\r\n"
                },
                {
                    "date": 1625120386045,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,9 +241,9 @@\n             this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n-                this._zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n+                let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(this._zhiLine);\r\n                 this._zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 this._zhiLine.x = this._touchesPos[0].x;\r\n                 this._zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n"
                },
                {
                    "date": 1625120391689,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -242,9 +242,9 @@\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n-                this._view.addChild(this._zhiLine);\r\n+                this._view.addChild(zhiLine);\r\n                 this._zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 this._zhiLine.x = this._touchesPos[0].x;\r\n                 this._zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 //this._zhiLine.y = 635;\r\n"
                },
                {
                    "date": 1625120399851,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -243,11 +243,11 @@\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n-                this._zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n-                this._zhiLine.x = this._touchesPos[0].x;\r\n-                this._zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n+                zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n+                zhiLine.x = this._touchesPos[0].x;\r\n+                zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 //this._zhiLine.y = 635;\r\n                 this._zhiLine.sortingOrder = 0;\r\n                 this._drawLan.sortingOrder = 1;\r\n                 this._drawRed.sortingOrder = 1;\r\n"
                },
                {
                    "date": 1625120528515,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -247,65 +247,18 @@\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 //this._zhiLine.y = 635;\r\n-                this._zhiLine.sortingOrder = 0;\r\n-                this._drawLan.sortingOrder = 1;\r\n-                this._drawRed.sortingOrder = 1;\r\n-                this._drawLineRect.y = this._zhiLine.y;\r\n-                this._drawLineRect.width = this._zhiLine.width;\r\n+                zhiLine.sortingOrder = 0;\r\n \r\n-                // 直线 线段 左蓝射线 右红射线\r\n-\r\n                 this._touchesPos.sort(this.comparePos());\r\n \r\n-                let tempPos0 = new cc.Vec2(this._touchesPos[0].x, this._view.height - this._touchesPos[0].y);\r\n-                let tempPos1 = new cc.Vec2(this._touchesPos[this._touchesPos.length - 1].x, this._view.height - this._touchesPos[this._touchesPos.length - 1].y);\r\n \r\n-                if (this._lanRect.contains(tempPos0)) {\r\n-                    console.log('==== 333 ====');\r\n-                    this._touchesPos[0].x = this._defaultMinX;\r\n-                }\r\n-                if (this._redRect.contains(tempPos1)) {\r\n-                    console.log('==== 444 ====');\r\n-                    this._touchesPos[this._touchesPos.length - 1].x = this._defaultMaxX;\r\n-                }\r\n-\r\n-                this._touchXMax = this._touchesPos[this._touchesPos.length - 1].x;\r\n-                this._touchXMin = this._touchesPos[0].x;\r\n-\r\n-                this._drawLineRect.x = this._touchesPos[0].x;\r\n-                this._drawLineRect.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n-\r\n             }\r\n \r\n         }\r\n \r\n \r\n-        if (!globalThis._.isEqual(oldState.gameOver, state.gameOver)) {\r\n-\r\n-            if (state.gameOver === this.gameResult.Success) {\r\n-\r\n-                this.unschedule(this.updatePlayerMove);\r\n-                this.rightLineFly();\r\n-\r\n-            } else if (state.gameOver === this.gameResult.Fail) {\r\n-\r\n-                this.unschedule(this.updatePlayerMove);\r\n-                //重新开始\r\n-                cc.tween(this._player)\r\n-                    .to(0.03, { y: this._player.y + 400 })\r\n-                    .call(() => {\r\n-                        let state: any = globalThis._.cloneDeep(this._state);\r\n-                        state.gameStart = false;\r\n-                        state.gameOver = this.gameResult.No;\r\n-                        this.updateState(state);\r\n-\r\n-                    })\r\n-                    .start()\r\n-            }\r\n-        }\r\n-\r\n         if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n \r\n             if (state.submit === this.submitType.RightFeed) {\r\n \r\n@@ -321,176 +274,14 @@\n                 this.handTips2(keyBtn);\r\n             }\r\n         }\r\n \r\n-        if (!globalThis._.isEqual(oldState.gameStart, state.gameStart)) {\r\n \r\n-            if (state.gameStart) {\r\n-\r\n-                // 游戏开始\r\n-                this._zhiLine.visible = false;\r\n-                this.graphics.clear();\r\n-                this._touchesPos.length = 0;\r\n-                this._player.x = this._view.width;\r\n-                this._player.y = 635;\r\n-                this._moveSpeed = 1;\r\n-                this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n-                this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n-                this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n-\r\n-                this.graphics.enabled = true;\r\n-\r\n-                this._startBtn.visible = false;\r\n-                this._maskBg.visible = false;\r\n-\r\n-                this.schedule(this.updatePlayerMove, 0.05);\r\n-\r\n-            } else {\r\n-\r\n-                this._view.off(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n-                this._view.off(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n-                this._view.off(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n-\r\n-                this._startBtn.visible = true;\r\n-                this._maskBg.visible = true;\r\n-                this.graphics.enabled = false;\r\n-\r\n-                this._zhiLine.visible = false;\r\n-                this._zhiLine.width = 0;\r\n-                this.graphics.clear();\r\n-                this._touchesPos.length = 0;\r\n-\r\n-                this.unschedule(this.updatePlayerMove);\r\n-            }\r\n-        }\r\n-\r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n             this.playTitle(state.title);\r\n         }\r\n     }\r\n \r\n-    rightLineFly() {\r\n-\r\n-        let len = this._showLinesObj.length;\r\n-\r\n-        if (len >= 3) {\r\n-\r\n-            return;\r\n-\r\n-        }\r\n-\r\n-        this._zhiLine.visible = false;\r\n-        this._drawLan.visible = false;\r\n-        this._drawRed.visible = false;\r\n-\r\n-        let dianLeftMin = this._drawLan.x;\r\n-        let dianLeftMax = this._drawLan.x + this._drawLan.width;\r\n-\r\n-        let dianRightMax = this._drawRed.x + this._drawRed.width;\r\n-        let dianRightMin = this._drawRed.x;\r\n-\r\n-        let cha = 5;\r\n-        let tempLineData = {};\r\n-\r\n-        // 1、直线\r\n-        if ((this._touchesPos[0].x - dianLeftMin) < -cha && (this._touchesPos[this._touchesPos.length - 1].x - dianRightMax) > cha) {\r\n-\r\n-            // 直线\r\n-            tempLineData['type'] = this.lineType.StraightLine\r\n-\r\n-        } else if (this._touchesPos[0].x >= dianLeftMin &&\r\n-            this._touchesPos[0].x <= dianLeftMax && this._touchesPos[this._touchesPos.length - 1].x >= dianRightMin && this._touchesPos[this._touchesPos.length - 1].x <= dianRightMax) {\r\n-\r\n-            //线段\r\n-            tempLineData['type'] = this.lineType.LineSegment;\r\n-\r\n-        } else if (this._touchesPos[0].x >= dianLeftMin &&\r\n-            this._touchesPos[0].x <= dianLeftMax && (this._touchesPos[this._touchesPos.length - 1].x - dianRightMax) > cha) {\r\n-\r\n-            // 左蓝射线\r\n-            tempLineData['type'] = this.lineType.LeftLanRays;\r\n-\r\n-        } else if (this._touchesPos[this._touchesPos.length - 1].x >= dianRightMin &&\r\n-            this._touchesPos[this._touchesPos.length - 1].x <= dianRightMax && (this._touchesPos[0].x - dianLeftMin) < -cha) {\r\n-\r\n-            // 右红射线\r\n-            tempLineData['type'] = this.lineType.RightRedRays;\r\n-\r\n-        }\r\n-\r\n-        this._showLines.push(tempLineData);\r\n-\r\n-        console.log('==== type 111 ====' + tempLineData['type']);\r\n-\r\n-        let lineW = Math.abs(this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x);\r\n-\r\n-        let leftLan = null;\r\n-        let rightRed = null;\r\n-\r\n-        let lineObj = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n-        this._view.addChild(lineObj);\r\n-        lineObj.width = lineW;\r\n-        lineObj.x = this._touchesPos[0].x;\r\n-        lineObj.y = this._touchesPos[0].y;\r\n-\r\n-        if (tempLineData['type'] === this.lineType.LineSegment) {\r\n-\r\n-            leftLan = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox27');\r\n-            this._view.addChild(leftLan);\r\n-            leftLan.x = this._touchesPos[0].x;\r\n-            leftLan.y = this._drawLan.y;\r\n-\r\n-            rightRed = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox26');\r\n-            this._view.addChild(rightRed);\r\n-            rightRed.x = this._touchesPos[this._touchesPos.length - 1].x;\r\n-            rightRed.y = this._drawRed.y;\r\n-\r\n-        } else if (tempLineData['type'] === this.lineType.LeftLanRays) {\r\n-\r\n-            leftLan = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox27');\r\n-            this._view.addChild(leftLan);\r\n-            leftLan.x = this._touchesPos[0].x;\r\n-            leftLan.y = this._drawLan.y;\r\n-\r\n-        } else if (tempLineData['type'] === this.lineType.RightRedRays) {\r\n-\r\n-            rightRed = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox26');\r\n-            this._view.addChild(rightRed);\r\n-            rightRed.x = this._touchesPos[this._touchesPos.length - 1].x;\r\n-            rightRed.y = this._drawRed.y;\r\n-        }\r\n-\r\n-        cc.tween(lineObj)\r\n-            .to(0.15, { x: this._showPosArr[len].line.x, y: this._showPosArr[len].line.y })\r\n-            .to(0.15, { scaleX: 0.7, scaleY: 0.7 })\r\n-            .call(() => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.gameStart = false;\r\n-                state.gameOver = this.gameResult.No;\r\n-                this.updateState(state);\r\n-\r\n-                lineObj.width = 710;\r\n-                this._showLinesObj.push(lineObj);\r\n-                this._zhiLine.visible = true;\r\n-                this._drawLan.visible = true;\r\n-                this._drawRed.visible = true;\r\n-                this._zhiLine.width = 0;\r\n-            })\r\n-            .start()\r\n-\r\n-        cc.tween(leftLan)\r\n-            .to(0.15, { x: this._showPosArr[len].lan.x, y: this._showPosArr[len].lan.y })\r\n-            .to(0.15, { scaleX: 0.7, scaleY: 0.7 })\r\n-            .start()\r\n-\r\n-        cc.tween(rightRed)\r\n-            .to(0.15, { x: this._showPosArr[len].red.x, y: this._showPosArr[len].red.y })\r\n-            .to(0.15, { scaleX: 0.7, scaleY: 0.7 })\r\n-            .start()\r\n-\r\n-\r\n-    }\r\n-\r\n     async playTitle(bool: boolean) {\r\n         this._c1.selectedIndex = bool ? 1 : 0;\r\n         if (bool) {\r\n             cc.audioEngine.stopAll();\r\n@@ -597,9 +388,9 @@\n     }\r\n \r\n     onEnable() {\r\n         this.registerState();\r\n-        // this.schedule(this.dragSchedule, this._scheduleTime);\r\n+        this.schedule(this.dragSchedule, this._scheduleTime);\r\n     }\r\n \r\n     onDisable() {\r\n         this.relieveState();\r\n"
                },
                {
                    "date": 1625120549291,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -91,9 +91,9 @@\n         this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n-        let huiNode = new cc.Node('huiNode');\r\n+        let huiNode = this._view.parent;\r\n         huiNode.parent = this._worldRoot;\r\n \r\n         this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n"
                },
                {
                    "date": 1625120555275,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,9 +92,8 @@\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n         let huiNode = this._view.parent;\r\n-        huiNode.parent = this._worldRoot;\r\n \r\n         this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n"
                },
                {
                    "date": 1625120573818,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -91,9 +91,9 @@\n         this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n-        let huiNode = this._view.parent;\r\n+        let huiNode = this._view.parent.node;\r\n \r\n         this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n"
                },
                {
                    "date": 1625120622269,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -91,9 +91,10 @@\n         this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n-        let huiNode = this._view.parent.node;\r\n+        let huiNode = new cc.Node('huiNode');\r\n+        huiNode.parent = this._worldRoot;\r\n \r\n         this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n"
                },
                {
                    "date": 1625120679333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,9 +237,9 @@\n             this._touchesPos = state.touchesPos;\r\n \r\n         } else if (state.touch == \"end\") {\r\n \r\n-            this.graphics.clear();\r\n+            // this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n"
                },
                {
                    "date": 1625120698686,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -99,9 +99,8 @@\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n-        this.graphics.enabled = false;\r\n \r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n"
                },
                {
                    "date": 1625120717231,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -236,9 +236,9 @@\n             this._touchesPos = state.touchesPos;\r\n \r\n         } else if (state.touch == \"end\") {\r\n \r\n-            // this.graphics.clear();\r\n+            this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n"
                },
                {
                    "date": 1625120761333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n-        this.graphics = huiNode.addComponent(cc.Graphics);\r\n+        this.graphics = this.node.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625120784132,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,8 +94,9 @@\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n+\r\n         this.graphics = this.node.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625120789805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -95,9 +95,9 @@\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n \r\n-        this.graphics = this.node.addComponent(cc.Graphics);\r\n+        this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625120839817,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,8 @@\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n-\r\n         this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625120981125,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this._worldRoot;\r\n \r\n-        this.graphics = huiNode.addComponent(cc.Graphics);\r\n+        this.graphics = this.node.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625121019972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,9 +92,9 @@\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n         let huiNode = new cc.Node('huiNode');\r\n-        huiNode.parent = this._worldRoot;\r\n+        huiNode.parent = this.node\r\n \r\n         this.graphics = this.node.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n"
                },
                {
                    "date": 1625121027027,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,11 +92,11 @@\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n         let huiNode = new cc.Node('huiNode');\r\n-        huiNode.parent = this.node\r\n+        huiNode.parent = this.node;\r\n \r\n-        this.graphics = this.node.addComponent(cc.Graphics);\r\n+        this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n         this.graphics.strokeColor = cc.color(255, 0, 0);\r\n         this.graphics.fillColor = cc.color(255, 0, 0);\r\n"
                },
                {
                    "date": 1625121067157,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,8 +93,9 @@\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n         let huiNode = new cc.Node('huiNode');\r\n         huiNode.parent = this.node;\r\n+        huiNode.zIndex = 9999;\r\n \r\n         this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n"
                },
                {
                    "date": 1625121119133,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,10 +92,9 @@\n         this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n         this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n \r\n         let huiNode = new cc.Node('huiNode');\r\n-        huiNode.parent = this.node;\r\n-        huiNode.zIndex = 9999;\r\n+        huiNode.parent = this._worldRoot;\r\n \r\n         this.graphics = huiNode.addComponent(cc.Graphics);\r\n         this.graphics.lineWidth = 20;\r\n         this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n"
                },
                {
                    "date": 1625121271019,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,21 +144,9 @@\n \r\n         this._dragging = true;\r\n         this._touchesPos.push(event.touch.getLocation());\r\n \r\n-        const MIN_POINT_DISTANCE = 4;\r\n \r\n-        let worldPos = this.node.convertToWorldSpaceAR(cc.v2(0, 0));\r\n-        this.graphics.moveTo(this._touchesPos[0].x - worldPos.x, this._touchesPos[0].y - worldPos.y);\r\n-        let lastIndex = 0;\r\n-        for (let i = 1, l = this._touchesPos.length; i < l; i++) {\r\n-            if (this._touchesPos[i].sub(this._touchesPos[lastIndex]).mag() < MIN_POINT_DISTANCE) {\r\n-                continue;\r\n-            }\r\n-            lastIndex = i;\r\n-            this.graphics.lineTo(this._touchesPos[i].x - worldPos.x, this._touchesPos[i].y - worldPos.y);\r\n-        }\r\n-        this.graphics.stroke();\r\n     }\r\n \r\n     _onDrawEnd(event) {\r\n \r\n@@ -233,9 +221,22 @@\n \r\n         } else if (state.touch == \"move\") {\r\n \r\n             this._touchesPos = state.touchesPos;\r\n+            const MIN_POINT_DISTANCE = 4;\r\n \r\n+            let worldPos = this.node.convertToWorldSpaceAR(cc.v2(0, 0));\r\n+            this.graphics.moveTo(this._touchesPos[0].x - worldPos.x, this._touchesPos[0].y - worldPos.y);\r\n+            let lastIndex = 0;\r\n+            for (let i = 1, l = this._touchesPos.length; i < l; i++) {\r\n+                if (this._touchesPos[i].sub(this._touchesPos[lastIndex]).mag() < MIN_POINT_DISTANCE) {\r\n+                    continue;\r\n+                }\r\n+                lastIndex = i;\r\n+                this.graphics.lineTo(this._touchesPos[i].x - worldPos.x, this._touchesPos[i].y - worldPos.y);\r\n+            }\r\n+            this.graphics.stroke();\r\n+\r\n         } else if (state.touch == \"end\") {\r\n \r\n             this.graphics.clear();\r\n \r\n"
                },
                {
                    "date": 1625121314072,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -220,8 +220,10 @@\n             this._touchesPos.length = 0;\r\n \r\n         } else if (state.touch == \"move\") {\r\n \r\n+            console.log('==== 3333333 拖拽定时器 ======');\r\n+\r\n             this._touchesPos = state.touchesPos;\r\n             const MIN_POINT_DISTANCE = 4;\r\n \r\n             let worldPos = this.node.convertToWorldSpaceAR(cc.v2(0, 0));\r\n"
                },
                {
                    "date": 1625121327601,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -220,9 +220,9 @@\n             this._touchesPos.length = 0;\r\n \r\n         } else if (state.touch == \"move\") {\r\n \r\n-            console.log('==== 3333333 拖拽定时器 ======');\r\n+            console.log('==== 44444 拖拽更新 ======');\r\n \r\n             this._touchesPos = state.touchesPos;\r\n             const MIN_POINT_DISTANCE = 4;\r\n \r\n"
                },
                {
                    "date": 1625121367867,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,9 @@\n     private graphics: cc.Graphics = null;\r\n \r\n     private _dragging = false;\r\n \r\n-    private _scheduleTime = 0.02;\r\n+    private _scheduleTime = 0.05;\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n"
                },
                {
                    "date": 1625121442606,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,4 +1,5 @@\n+import { PrivateNode } from '../../../../../creator';\r\n \r\n /*\r\n  * @Descripttion: \r\n  * @version: \r\n@@ -29,8 +30,10 @@\n     private _package: any;\r\n \r\n     private _touchesPos: cc.Vec2[] = [];\r\n \r\n+    private _temoPos: cc.Vec2\r\n+\r\n     private graphics: cc.Graphics = null;\r\n \r\n     private _dragging = false;\r\n \r\n"
                },
                {
                    "date": 1625121454016,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,11 +28,10 @@\n     private _resetBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n-    private _touchesPos: cc.Vec2[] = [];\r\n+    private _touchesPos: [],\r\n \r\n-    private _temoPos: cc.Vec2\r\n \r\n     private graphics: cc.Graphics = null;\r\n \r\n     private _dragging = false;\r\n"
                },
                {
                    "date": 1625121455432,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,9 @@\n     private _resetBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n-    private _touchesPos: [],\r\n+    private _touchesPos: [];\r\n \r\n \r\n     private graphics: cc.Graphics = null;\r\n \r\n"
                },
                {
                    "date": 1625121461108,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,9 @@\n     private _resetBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n-    private _touchesPos: [];\r\n+    private _touchesPos: any = [];\r\n \r\n \r\n     private graphics: cc.Graphics = null;\r\n \r\n"
                },
                {
                    "date": 1625121496578,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,8 +144,9 @@\n \r\n     _onDrawMove(event) {\r\n \r\n         this._dragging = true;\r\n+        let tempPos = { x: , y: };\r\n         this._touchesPos.push(event.touch.getLocation());\r\n \r\n \r\n     }\r\n"
                },
                {
                    "date": 1625121508503,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,10 +144,10 @@\n \r\n     _onDrawMove(event) {\r\n \r\n         this._dragging = true;\r\n-        let tempPos = { x: , y: };\r\n-        this._touchesPos.push(event.touch.getLocation());\r\n+        let tempPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().x };\r\n+        this._touchesPos.push();\r\n \r\n \r\n     }\r\n \r\n"
                },
                {
                    "date": 1625121515147,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -144,10 +144,10 @@\n \r\n     _onDrawMove(event) {\r\n \r\n         this._dragging = true;\r\n-        let tempPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().x };\r\n-        this._touchesPos.push();\r\n+        let tempPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n+        this._touchesPos.push(tempPos);\r\n \r\n \r\n     }\r\n \r\n"
                },
                {
                    "date": 1625121583886,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -137,19 +137,18 @@\n         console.log('===== start 111 ====' + event.touch.getLocation());\r\n \r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.touch = 'start';\r\n-        state.touchesPos.push(event.touch.getLocation());\r\n+        let tempPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n+        state.touchesPos.push(tempPos);\r\n         this.updateState(state);\r\n     }\r\n \r\n     _onDrawMove(event) {\r\n \r\n         this._dragging = true;\r\n         let tempPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n         this._touchesPos.push(tempPos);\r\n-\r\n-\r\n     }\r\n \r\n     _onDrawEnd(event) {\r\n \r\n"
                },
                {
                    "date": 1625121628780,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,9 +30,9 @@\n     private _package: any;\r\n \r\n     private _touchesPos: any = [];\r\n \r\n-\r\n+    private _moveCurPos: {};\r\n     private graphics: cc.Graphics = null;\r\n \r\n     private _dragging = false;\r\n \r\n"
                },
                {
                    "date": 1625121642425,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,8 +31,9 @@\n \r\n     private _touchesPos: any = [];\r\n \r\n     private _moveCurPos: {};\r\n+\r\n     private graphics: cc.Graphics = null;\r\n \r\n     private _dragging = false;\r\n \r\n@@ -146,9 +147,9 @@\n     _onDrawMove(event) {\r\n \r\n         this._dragging = true;\r\n         let tempPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n-        this._touchesPos.push(tempPos);\r\n+        this._moveCurPos.push(tempPos);\r\n     }\r\n \r\n     _onDrawEnd(event) {\r\n \r\n"
                },
                {
                    "date": 1625121650767,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,9 +146,9 @@\n \r\n     _onDrawMove(event) {\r\n \r\n         this._dragging = true;\r\n-        let tempPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n+        this._moveCurPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n         this._moveCurPos.push(tempPos);\r\n     }\r\n \r\n     _onDrawEnd(event) {\r\n"
                },
                {
                    "date": 1625121685674,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -147,9 +147,8 @@\n     _onDrawMove(event) {\r\n \r\n         this._dragging = true;\r\n         this._moveCurPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n-        this._moveCurPos.push(tempPos);\r\n     }\r\n \r\n     _onDrawEnd(event) {\r\n \r\n@@ -193,11 +192,11 @@\n     dragSchedule() {\r\n         if (this._dragging) {\r\n \r\n             console.log('==== 3333333 拖拽定时器 ======');\r\n-\r\n             let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.touchesPos = this._touchesPos;\r\n+            this._moveCurPos\r\n+            state.touchesPos.push();\r\n             state.touch = \"move\";\r\n             this.updateState(state);\r\n         }\r\n     }\r\n"
                },
                {
                    "date": 1625121691472,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -193,10 +193,9 @@\n         if (this._dragging) {\r\n \r\n             console.log('==== 3333333 拖拽定时器 ======');\r\n             let state: any = globalThis._.cloneDeep(this._state);\r\n-            this._moveCurPos\r\n-            state.touchesPos.push();\r\n+            state.touchesPos.push(this._moveCurPos);\r\n             state.touch = \"move\";\r\n             this.updateState(state);\r\n         }\r\n     }\r\n"
                },
                {
                    "date": 1625121766372,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,9 +30,9 @@\n     private _package: any;\r\n \r\n     private _touchesPos: any = [];\r\n \r\n-    private _moveCurPos: {};\r\n+    private _moveCurPos: cc.Vec2;\r\n \r\n     private graphics: cc.Graphics = null;\r\n \r\n     private _dragging = false;\r\n"
                },
                {
                    "date": 1625121832454,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -138,9 +138,9 @@\n         console.log('===== start 111 ====' + event.touch.getLocation());\r\n \r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.touch = 'start';\r\n-        let tempPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n+        let tempPos = cc.Vec2(event.touch.getLocation().x, event.touch.getLocation().y); { x: , y: event.touch.getLocation().y };\r\n         state.touchesPos.push(tempPos);\r\n         this.updateState(state);\r\n     }\r\n \r\n"
                },
                {
                    "date": 1625121850477,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -138,9 +138,9 @@\n         console.log('===== start 111 ====' + event.touch.getLocation());\r\n \r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.touch = 'start';\r\n-        let tempPos = cc.Vec2(event.touch.getLocation().x, event.touch.getLocation().y); { x: , y: event.touch.getLocation().y };\r\n+        let tempPos = new cc.Vec2(event.touch.getLocation().x, event.touch.getLocation().y);\r\n         state.touchesPos.push(tempPos);\r\n         this.updateState(state);\r\n     }\r\n \r\n"
                },
                {
                    "date": 1625121859346,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,9 +146,9 @@\n \r\n     _onDrawMove(event) {\r\n \r\n         this._dragging = true;\r\n-        this._moveCurPos = { x: event.touch.getLocation().x, y: event.touch.getLocation().y };\r\n+        this._moveCurPos = new cc.Vec2(event.touch.getLocation().x, event.touch.getLocation().y);\r\n     }\r\n \r\n     _onDrawEnd(event) {\r\n \r\n"
                },
                {
                    "date": 1625122025752,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,9 @@\n     private graphics: cc.Graphics = null;\r\n \r\n     private _dragging = false;\r\n \r\n-    private _scheduleTime = 0.05;\r\n+    private _scheduleTime = 0.03;\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n"
                },
                {
                    "date": 1625122124572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,4 @@\n-import { PrivateNode } from '../../../../../creator';\r\n \r\n /*\r\n  * @Descripttion: \r\n  * @version: \r\n"
                },
                {
                    "date": 1625122762211,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -220,10 +220,8 @@\n             this._touchesPos.length = 0;\r\n \r\n         } else if (state.touch == \"move\") {\r\n \r\n-            console.log('==== 44444 拖拽更新 ======');\r\n-\r\n             this._touchesPos = state.touchesPos;\r\n             const MIN_POINT_DISTANCE = 4;\r\n \r\n             let worldPos = this.node.convertToWorldSpaceAR(cc.v2(0, 0));\r\n@@ -248,8 +246,10 @@\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n+\r\n+\r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n"
                },
                {
                    "date": 1625123064289,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -247,9 +247,8 @@\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n \r\n-\r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n"
                },
                {
                    "date": 1625123315231,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -281,120 +281,131 @@\n             this.playTitle(state.title);\r\n         }\r\n     }\r\n \r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n+    function angle(start, end) {\r\n+    var diff_x = end.x - start.x,\r\n+        diff_y = end.y - start.y;\r\n+    //返回角度,不是弧度\r\n+    return 360 * Math.atan(diff_y / diff_x) / (2 * Math.PI);\r\n+}\r\n \r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n+————————————————\r\n+版权声明：本文为CSDN博主「I - T枭」的原创文章，遵循CC 4.0 BY - SA版权协议，转载请附上原文出处链接及本声明。\r\n+原文链接：https://blog.csdn.net/hahahhahahahha123456/article/details/96750558\r\n \r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n+async playTitle(bool: boolean) {\r\n+    this._c1.selectedIndex = bool ? 1 : 0;\r\n+    if (bool) {\r\n+        cc.audioEngine.stopAll();\r\n+        this.forbidHandle();\r\n+        let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+        let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+        let audioId = cc.audioEngine.play(audio, false, 1);\r\n+        cc.audioEngine.setFinishCallback(audioId, () => {\r\n             let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n+            state.title = false;\r\n             this.updateState(state);\r\n-        }, 2000);\r\n+        });\r\n+    } else {\r\n+        this.disableForbidHandle();\r\n     }\r\n+}\r\n \r\n+answerFeedback(bool: boolean) {\r\n+    if (!this.feedback) return;\r\n+    let feedback: any = cc.instantiate(this.feedback);\r\n+    feedback.x = 960;\r\n+    feedback.y = 540;\r\n+    let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+    feedbackJs.init(bool);\r\n+    feedback.parent = cc.find(\"Canvas\").parent;\r\n \r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n+    setTimeout(() => {\r\n+        feedback.destroy();\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.No;\r\n+        this.updateState(state);\r\n+    }, 2000);\r\n+}\r\n \r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n \r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n+/**\r\n+ * 点击指引\r\n+ * @param obj 点击对象\r\n+ */\r\n+handTips2(obj: fgui.GObject) {\r\n+    let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+    this._view.addChild(hand);\r\n+    let tempX = obj.x;\r\n+    let tempY = obj.y;\r\n \r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n+    hand.x = tempX;\r\n+    hand.y = tempY;\r\n \r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n+    cc.tween(hand).to(0.3, {\r\n+        x: tempX - 30,\r\n+        y: tempY - 30\r\n+    }).to(0.3, {\r\n+        x: tempX,\r\n+        y: tempY\r\n+    }).to(0.3, {\r\n+        x: tempX - 30,\r\n+        y: tempY - 30\r\n+    }).to(0.3, {\r\n+        x: tempX,\r\n+        y: tempY\r\n+    }).call(() => {\r\n+        this._view.removeChild(hand);\r\n+        hand = null;\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.No;\r\n+        this.updateState(state)\r\n+    }).start();\r\n+}\r\n \r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+// 运行时 禁止操作\r\n+forbidHandle() {\r\n+    console.log('===  运行时 禁止操作 =====');\r\n+    let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+    if (!handleMask) {\r\n+        let handleMask = new cc.Node('handleMask');\r\n+        handleMask.addComponent(cc.BlockInputEvents);\r\n+        handleMask.parent = this._worldRoot;\r\n+        handleMask.width = 1920;\r\n+        handleMask.height = 1080;\r\n+        handleMask.x = 960;\r\n+        handleMask.y = 540;\r\n     }\r\n+}\r\n \r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n+// 消除禁止\r\n+disableForbidHandle() {\r\n+    let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+    if (handleMask) handleMask.destroy();\r\n+}\r\n \r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n+// 注册状态，及获取状态的方法\r\n+registerState() {\r\n+    if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+}\r\n \r\n-    onEnable() {\r\n-        this.registerState();\r\n-        this.schedule(this.dragSchedule, this._scheduleTime);\r\n-    }\r\n+// 解除状态，及获取状态的方法\r\n+relieveState() {\r\n+    if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+}\r\n \r\n-    onDisable() {\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n+// 本组件状态合并到全局\r\n+mergeState() {\r\n+    if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n }\r\n+\r\n+onEnable() {\r\n+    this.registerState();\r\n+    this.schedule(this.dragSchedule, this._scheduleTime);\r\n+}\r\n+\r\n+onDisable() {\r\n+    this.relieveState();\r\n+    cc.audioEngine.stopAll();\r\n+}\r\n+}\r\n"
                },
                {
                    "date": 1625123322914,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -288,11 +288,8 @@\n     //返回角度,不是弧度\r\n     return 360 * Math.atan(diff_y / diff_x) / (2 * Math.PI);\r\n }\r\n \r\n-————————————————\r\n-版权声明：本文为CSDN博主「I - T枭」的原创文章，遵循CC 4.0 BY - SA版权协议，转载请附上原文出处链接及本声明。\r\n-原文链接：https://blog.csdn.net/hahahhahahahha123456/article/details/96750558\r\n \r\n async playTitle(bool: boolean) {\r\n     this._c1.selectedIndex = bool ? 1 : 0;\r\n     if (bool) {\r\n"
                },
                {
                    "date": 1625123332459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -281,128 +281,128 @@\n             this.playTitle(state.title);\r\n         }\r\n     }\r\n \r\n-    function angle(start, end) {\r\n-    var diff_x = end.x - start.x,\r\n-        diff_y = end.y - start.y;\r\n-    //返回角度,不是弧度\r\n-    return 360 * Math.atan(diff_y / diff_x) / (2 * Math.PI);\r\n-}\r\n+    angle(start, end) {\r\n+        var diff_x = end.x - start.x,\r\n+            diff_y = end.y - start.y;\r\n+        //返回角度,不是弧度\r\n+        return 360 * Math.atan(diff_y / diff_x) / (2 * Math.PI);\r\n+    }\r\n \r\n \r\n-async playTitle(bool: boolean) {\r\n-    this._c1.selectedIndex = bool ? 1 : 0;\r\n-    if (bool) {\r\n-        cc.audioEngine.stopAll();\r\n-        this.forbidHandle();\r\n-        let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-        let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-        let audioId = cc.audioEngine.play(audio, false, 1);\r\n-        cc.audioEngine.setFinishCallback(audioId, () => {\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n             let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.title = false;\r\n+            state.submit = this.submitType.No;\r\n             this.updateState(state);\r\n-        });\r\n-    } else {\r\n-        this.disableForbidHandle();\r\n+        }, 2000);\r\n     }\r\n-}\r\n \r\n-answerFeedback(bool: boolean) {\r\n-    if (!this.feedback) return;\r\n-    let feedback: any = cc.instantiate(this.feedback);\r\n-    feedback.x = 960;\r\n-    feedback.y = 540;\r\n-    let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-    feedbackJs.init(bool);\r\n-    feedback.parent = cc.find(\"Canvas\").parent;\r\n \r\n-    setTimeout(() => {\r\n-        feedback.destroy();\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.No;\r\n-        this.updateState(state);\r\n-    }, 2000);\r\n-}\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n \r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n \r\n-/**\r\n- * 点击指引\r\n- * @param obj 点击对象\r\n- */\r\n-handTips2(obj: fgui.GObject) {\r\n-    let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-    this._view.addChild(hand);\r\n-    let tempX = obj.x;\r\n-    let tempY = obj.y;\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n \r\n-    hand.x = tempX;\r\n-    hand.y = tempY;\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n \r\n-    cc.tween(hand).to(0.3, {\r\n-        x: tempX - 30,\r\n-        y: tempY - 30\r\n-    }).to(0.3, {\r\n-        x: tempX,\r\n-        y: tempY\r\n-    }).to(0.3, {\r\n-        x: tempX - 30,\r\n-        y: tempY - 30\r\n-    }).to(0.3, {\r\n-        x: tempX,\r\n-        y: tempY\r\n-    }).call(() => {\r\n-        this._view.removeChild(hand);\r\n-        hand = null;\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.No;\r\n-        this.updateState(state)\r\n-    }).start();\r\n-}\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n \r\n-// 运行时 禁止操作\r\n-forbidHandle() {\r\n-    console.log('===  运行时 禁止操作 =====');\r\n-    let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-    if (!handleMask) {\r\n-        let handleMask = new cc.Node('handleMask');\r\n-        handleMask.addComponent(cc.BlockInputEvents);\r\n-        handleMask.parent = this._worldRoot;\r\n-        handleMask.width = 1920;\r\n-        handleMask.height = 1080;\r\n-        handleMask.x = 960;\r\n-        handleMask.y = 540;\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n     }\r\n-}\r\n \r\n-// 消除禁止\r\n-disableForbidHandle() {\r\n-    let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-    if (handleMask) handleMask.destroy();\r\n-}\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n \r\n-// 注册状态，及获取状态的方法\r\n-registerState() {\r\n-    if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-}\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n \r\n-// 解除状态，及获取状态的方法\r\n-relieveState() {\r\n-    if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-}\r\n+    onEnable() {\r\n+        this.registerState();\r\n+        this.schedule(this.dragSchedule, this._scheduleTime);\r\n+    }\r\n \r\n-// 本组件状态合并到全局\r\n-mergeState() {\r\n-    if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    onDisable() {\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n }\r\n-\r\n-onEnable() {\r\n-    this.registerState();\r\n-    this.schedule(this.dragSchedule, this._scheduleTime);\r\n-}\r\n-\r\n-onDisable() {\r\n-    this.relieveState();\r\n-    cc.audioEngine.stopAll();\r\n-}\r\n-}\r\n"
                },
                {
                    "date": 1625123361067,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,8 +241,10 @@\n             this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n+                let angle = this.angle\r\n+\r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n"
                },
                {
                    "date": 1625123366694,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,9 +241,9 @@\n             this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n-                let angle = this.angle\r\n+                let angle = this.angle();\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n"
                },
                {
                    "date": 1625123394899,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,9 +241,9 @@\n             this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n-                let angle = this.angle();\r\n+                let angle = this.angle(this._touchesPos[0], this._touchesPos[this._touchesPos.length]);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n"
                },
                {
                    "date": 1625123443530,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -248,9 +248,9 @@\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n-\r\n+                zhiLine.skewX\r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n"
                },
                {
                    "date": 1625123450278,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -248,9 +248,9 @@\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n-                zhiLine.skewX\r\n+                zhiLine.skewX = angle\r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n"
                },
                {
                    "date": 1625123459351,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -248,9 +248,10 @@\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n-                zhiLine.skewX = angle\r\n+                zhiLine.skewX = -angle;\r\n+                zhiLine.skewX = -angle;\r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n"
                },
                {
                    "date": 1625123465948,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -249,9 +249,9 @@\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 zhiLine.skewX = -angle;\r\n-                zhiLine.skewX = -angle;\r\n+                zhiLine.skewY = -angle;\r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n"
                },
                {
                    "date": 1625123577480,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,9 +241,9 @@\n             this.graphics.clear();\r\n \r\n             if (this._touchesPos.length > 0) {\r\n \r\n-                let angle = this.angle(this._touchesPos[0], this._touchesPos[this._touchesPos.length]);\r\n+                let angle = this.angle(this._touchesPos[0], this._touchesPos[this._touchesPos.length - 1]);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n"
                },
                {
                    "date": 1625123616648,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -248,10 +248,10 @@\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n-                zhiLine.skewX = -angle;\r\n-                zhiLine.skewY = -angle;\r\n+                zhiLine.skewX = angle;\r\n+                zhiLine.skewY = angle;\r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n"
                },
                {
                    "date": 1625123629491,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -243,8 +243,10 @@\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let angle = this.angle(this._touchesPos[0], this._touchesPos[this._touchesPos.length - 1]);\r\n \r\n+                console.log('===== ===' = );\r\n+\r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n"
                },
                {
                    "date": 1625123634699,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -243,9 +243,9 @@\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let angle = this.angle(this._touchesPos[0], this._touchesPos[this._touchesPos.length - 1]);\r\n \r\n-                console.log('===== ===' = );\r\n+                console.log('===== ===' + angle);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n"
                },
                {
                    "date": 1625123639859,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -243,9 +243,9 @@\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let angle = this.angle(this._touchesPos[0], this._touchesPos[this._touchesPos.length - 1]);\r\n \r\n-                console.log('===== ===' + angle);\r\n+                console.log('===== angle 333 ===' + angle);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n"
                },
                {
                    "date": 1625123645548,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -243,9 +243,9 @@\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let angle = this.angle(this._touchesPos[0], this._touchesPos[this._touchesPos.length - 1]);\r\n \r\n-                console.log('===== angle 333 ===' + angle);\r\n+                console.log('===== angle 333 === ' + angle);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n"
                },
                {
                    "date": 1625123731316,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -250,10 +250,10 @@\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n-                zhiLine.skewX = angle;\r\n-                zhiLine.skewY = angle;\r\n+                zhiLine.rotation = angle;\r\n+\r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n"
                },
                {
                    "date": 1625123763501,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -243,16 +243,16 @@\n             if (this._touchesPos.length > 0) {\r\n \r\n                 let angle = this.angle(this._touchesPos[0], this._touchesPos[this._touchesPos.length - 1]);\r\n \r\n-                console.log('===== angle 333 === ' + angle);\r\n+                console.log('===== angle 999999 === ' + angle);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n                 zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n-                zhiLine.rotation = angle;\r\n+                zhiLine.rotation = -angle;\r\n \r\n                 //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n"
                },
                {
                    "date": 1625124105712,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -247,9 +247,9 @@\n                 console.log('===== angle 999999 === ' + angle);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n-                zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n+                zhiLine.width = this._touchesPos[i].sub(this._touchesPos[lastIndex]).mag()\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 zhiLine.rotation = -angle;\r\n \r\n"
                },
                {
                    "date": 1625124110754,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -247,9 +247,9 @@\n                 console.log('===== angle 999999 === ' + angle);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n-                zhiLine.width = this._touchesPos[i].sub(this._touchesPos[lastIndex]).mag()\r\n+                zhiLine.width = this._touchesPos[i].sub(this._touchesPos[lastIndex]).mag();\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 zhiLine.rotation = -angle;\r\n \r\n"
                },
                {
                    "date": 1625124135040,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -247,9 +247,9 @@\n                 console.log('===== angle 999999 === ' + angle);\r\n \r\n                 let zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n                 this._view.addChild(zhiLine);\r\n-                zhiLine.width = this._touchesPos[i].sub(this._touchesPos[lastIndex]).mag();\r\n+                zhiLine.width = this._touchesPos[this._touchesPos.length - 1].sub(this._touchesPos[0]).mag();\r\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 zhiLine.rotation = -angle;\r\n \r\n"
                },
                {
                    "date": 1625124458526,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -252,9 +252,8 @@\n                 zhiLine.x = this._touchesPos[0].x;\r\n                 zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                 zhiLine.rotation = -angle;\r\n \r\n-                //this._zhiLine.y = 635;\r\n                 zhiLine.sortingOrder = 0;\r\n \r\n                 this._touchesPos.sort(this.comparePos());\r\n \r\n"
                }
            ],
            "date": 1625119227755,
            "name": "Commit-0",
            "content": "\r\n/*\r\n * @Descripttion: \r\n * @version: \r\n * @Author: ruzhuan\r\n * @Date: 2021-06-08 18:00:00\r\n * @LastEditors: ruzhuan\r\n * @LastEditTime: 2021-06-08 18:00:00\r\n */\r\nconst { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class t4_05_model_v2 extends cc.Component {\r\n    private _worldRoot: cc.Node;\r\n\r\n    private _view: fgui.GComponent;\r\n\r\n    private _c1: fgui.Controller;\r\n\r\n    private _title: fgui.GButton;\r\n\r\n    private _titleTrigger: fgui.GLoader;\r\n\r\n    private _submitBtn: fgui.GButton;\r\n\r\n    private _package: any;\r\n\r\n    private _touchesPos: cc.Vec2[] = [];\r\n\r\n    private _touchXMax: number = 0;\r\n\r\n    private _touchXMin: number = 0;\r\n\r\n    private graphics: cc.Graphics = null;\r\n\r\n    private _zhiLine: fgui.GObject;\r\n\r\n    private _drawLan: fgui.GImage;\r\n\r\n    private _moveMinX: number = 430;\r\n\r\n    private _lanRect: cc.Rect;\r\n    private _redRect: cc.Rect;\r\n    private _playerRect: cc.Rect;\r\n    private _drawLineRect: cc.Rect;\r\n\r\n    private _drawRed: fgui.GImage;\r\n\r\n    private _maskBg: fgui.GGraph;\r\n\r\n    private _player: fgui.GImage;\r\n\r\n    private _moveSpeed: number = 1;\r\n\r\n    private _gameTime: number = 0;\r\n\r\n    private _defaultMinX: number = 550;\r\n\r\n    private _defaultMaxX: number = 1290;\r\n\r\n    private _defaultMidPosY: number = 635;\r\n\r\n    private _framesSecond: number = 20; //1秒钟运行20帧（次）\r\n\r\n    private _dragging = false;\r\n\r\n    private _scheduleTime = 0.01;\r\n\r\n    private _showPosArr: any = [\r\n        { 'line': { x: 25, y: 250 }, 'lan': { x: 16, y: 218 }, 'red': { x: 472, y: 218 } },\r\n        { 'line': { x: 25, y: 345 }, 'lan': { x: 16, y: 312 }, 'red': { x: 472, y: 312 } },\r\n        { 'line': { x: 25, y: 438 }, 'lan': { x: 16, y: 404 }, 'red': { x: 472, y: 404 } }];\r\n\r\n    private _showLines: any = [];\r\n\r\n    private _showLinesObj: any = [];\r\n\r\n    private _startBtn: fgui.GButton;\r\n\r\n    private submitType: any = cc.Enum({\r\n\r\n        No: 0,\r\n        GuideShow: 1,\r\n        WrongFeed: 2,\r\n        RightFeed: 3\r\n    });\r\n\r\n    private gameResult: any = cc.Enum({\r\n\r\n        No: 0,\r\n        Fail: 2,\r\n        Success: 3\r\n    });\r\n\r\n    private lineType: any = cc.Enum({\r\n\r\n        StraightLine: 0,\r\n        LineSegment: 1,\r\n        LeftLanRays: 2,\r\n        RightRedRays: 3\r\n    });\r\n\r\n    // 远程动态组件\r\n    private feedback: any;\r\n\r\n    private _state = {};\r\n\r\n    get state(): any {\r\n        return this._state;\r\n    }\r\n\r\n    set state(v: any) {\r\n        this.updateUi(this._state, v);\r\n        this._state = v;\r\n        this.mergeState();\r\n    }\r\n\r\n    async onLoad() {\r\n\r\n        this._worldRoot = cc.find(\"Canvas\").parent;\r\n\r\n        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n\r\n        fgui.GRoot.inst.addChild(this._view);\r\n\r\n        this._c1 = this._view.getController(\"c1\");\r\n\r\n        this._drawLan = this._view.getChild('lan').asImage;\r\n        this._drawRed = this._view.getChild('red').asImage;\r\n\r\n        this._lanRect = new cc.Rect(this._drawLan.x, this._drawLan.y, this._drawLan.width, this._drawLan.height);\r\n        this._redRect = new cc.Rect(this._drawRed.x, this._drawRed.y, this._drawRed.width, this._drawRed.height);\r\n\r\n        // 臨時\r\n        // bug 初始设置不播放不生效\r\n        if (this._c1) {\r\n            this._c1.selectedIndex = 1;\r\n            this._c1.selectedIndex = 0;\r\n        }\r\n\r\n        this._maskBg = this._view.getChild(\"maskBg\").asGraph;\r\n        this._maskBg.visible = true;\r\n\r\n        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n\r\n        this._title = this._view.getChild(\"title\").asButton;\r\n\r\n        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n\r\n        this._startBtn = this._view.getChild(\"start\").asButton;\r\n        this._startBtn.on(fgui.Event.CLICK, this._clickStart, this);\r\n\r\n        this._player = this._view.getChild('player').asImage;\r\n        this._player.x = this._view.width;\r\n        this._playerRect = new cc.Rect(this._player.x - 36, this._player.y + 10, 25, this._player.height);\r\n\r\n        this._view.off(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n        this._view.off(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n        this._view.off(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n\r\n        let huiNode = new cc.Node('huiNode');\r\n        huiNode.parent = this._worldRoot;\r\n\r\n        this.graphics = huiNode.addComponent(cc.Graphics);\r\n        this.graphics.lineWidth = 20;\r\n        this.graphics.lineJoin = cc.Graphics.LineJoin.ROUND;\r\n        this.graphics.strokeColor = cc.color(255, 0, 0);\r\n        this.graphics.fillColor = cc.color(255, 0, 0);\r\n        this.graphics.enabled = false;\r\n\r\n        // 初始化state\r\n        this._state = {\r\n            title: false,\r\n            submit: this.submitType.No,\r\n            gameStart: false,\r\n            gameOver: this.gameResult.No,\r\n            touch: \"end\",\r\n            touchesPos: []\r\n        }\r\n    }\r\n\r\n    async init(data: any) {\r\n        // 临时 model component json 配置加载\r\n        let { pathConfig, model, components } = data;\r\n        let Package = pathConfig.packageName;\r\n        let GComponent = model.uiPath;\r\n        let { boxSoundUrl, guidIndex } = model.config;\r\n        this._package = Package;\r\n\r\n        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n\r\n        this._zhiLine = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n        this._view.addChild(this._zhiLine);\r\n        this._drawLineRect = new cc.Rect(this._zhiLine.x, this._zhiLine.y, this._zhiLine.width, this._zhiLine.height);\r\n\r\n        // 动效注册\r\n        // for (let v in ae) {\r\n        //     if (ae[v]) {\r\n        //         this[v] = {};\r\n        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n        //     }\r\n        // }\r\n\r\n        if (components) {\r\n            for (const key in components) {\r\n                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n                let componentBundle: any = await loadBundle(componentPath);\r\n                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n                this[key] = componentPrefab;\r\n            }\r\n        }\r\n    }\r\n\r\n    _onDrawStart(event) {\r\n        console.log('===== start 111 ====' + event.touch.getLocation());\r\n\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n        state.touch = 'start';\r\n        state.touchesPos.push(event.touch.getLocation());\r\n        this.updateState(state);\r\n    }\r\n\r\n    _onDrawMove(event) {\r\n\r\n        this._dragging = true;\r\n        this._touchesPos.push(event.touch.getLocation());\r\n\r\n        const MIN_POINT_DISTANCE = 4;\r\n\r\n        let worldPos = this.node.convertToWorldSpaceAR(cc.v2(0, 0));\r\n        this.graphics.moveTo(this._touchesPos[0].x - worldPos.x, this._touchesPos[0].y - worldPos.y);\r\n        let lastIndex = 0;\r\n        for (let i = 1, l = this._touchesPos.length; i < l; i++) {\r\n            if (this._touchesPos[i].sub(this._touchesPos[lastIndex]).mag() < MIN_POINT_DISTANCE) {\r\n                continue;\r\n            }\r\n            lastIndex = i;\r\n            this.graphics.lineTo(this._touchesPos[i].x - worldPos.x, this._touchesPos[i].y - worldPos.y);\r\n        }\r\n        this.graphics.stroke();\r\n    }\r\n\r\n    _onDrawEnd(event) {\r\n\r\n        this._dragging = false;\r\n\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n        state.touch = 'end';\r\n        this.updateState(state);\r\n    }\r\n\r\n    updatePlayerMove(dt) {\r\n\r\n        // this.dragSchedule();\r\n        this._gameTime++;\r\n        console.log(this._gameTime);\r\n        if (this._gameTime >= this._framesSecond * 9) {\r\n\r\n\r\n            this._playerRect.x = this._player.x - 36;\r\n            if (this._drawLineRect.intersects(this._playerRect)) {\r\n\r\n                this._moveSpeed = 6;\r\n                if (this._player.x <= this._moveMinX) {\r\n                    this._gameTime = 0;\r\n                    this.unschedule(this.updatePlayerMove);\r\n                    let state: any = globalThis._.cloneDeep(this._state);\r\n                    state.gameOver = this.gameResult.Success;\r\n                    this.updateState(state);\r\n                }\r\n\r\n            } else {\r\n\r\n                console.log('===== _player.x ====' + this._player.x);\r\n                console.log('===== _touchXMin ====' + this._touchXMin);\r\n                console.log('===== _moveMinX ====' + this._moveMinX);\r\n\r\n                console.log(this._drawLineRect);\r\n                console.log(this._playerRect);\r\n\r\n                if (this._player.x > this._touchXMin) {\r\n\r\n                    this._gameTime = 0;\r\n                    this.unschedule(this.updatePlayerMove);\r\n\r\n                    //游戏结束\r\n                    let state: any = globalThis._.cloneDeep(this._state);\r\n                    state.gameOver = this.gameResult.Fail;\r\n                    this.updateState(state);\r\n\r\n                    return;\r\n\r\n                } else if (this._player.x <= this._touchXMin && this._player.x <= this._moveMinX) {\r\n\r\n                    this._gameTime = 0;\r\n                    this.unschedule(this.updatePlayerMove);\r\n\r\n                    let state: any = globalThis._.cloneDeep(this._state);\r\n                    state.gameOver = this.gameResult.Success;\r\n                    this.updateState(state);\r\n                    return;\r\n\r\n                }\r\n\r\n\r\n\r\n            }\r\n        }\r\n\r\n        this._player.x -= 4.2 * this._moveSpeed;\r\n    }\r\n\r\n    // 排序方法\r\n    comparePos() {\r\n        return function (a, b) {\r\n            var value1 = a.x;\r\n            var value2 = b.x;\r\n            return value1 - value2;\r\n        }\r\n    }\r\n\r\n    private _clickStart(evt: any) {\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n        state.gameStart = true;\r\n        this.updateState(state);\r\n\r\n    }\r\n\r\n    private _clickSubmit(evt: any) {\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n        this.updateState(state);\r\n    }\r\n\r\n    private _clickTitle(evt: any) {\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n        state.title = true;\r\n        this.updateState(state);\r\n    }\r\n\r\n    // 临时\r\n    // 拖拽定时器\r\n    dragSchedule() {\r\n        if (this._dragging) {\r\n\r\n            console.log('==== 3333333 拖拽定时器 ======');\r\n\r\n            let state: any = globalThis._.cloneDeep(this._state);\r\n            state.touchesPos = this._touchesPos;\r\n            state.touch = \"move\";\r\n            this.updateState(state);\r\n        }\r\n    }\r\n\r\n    // 获取状态\r\n    getState(data: any) {\r\n        this.updateState(data);\r\n    }\r\n\r\n    // 更新状态层\r\n    updateState(curState: any) {\r\n        if (globalThis._.isEqual(this._state, curState)) return;\r\n        this.state = curState;\r\n    }\r\n\r\n    // 更新ui层\r\n    updateUi(oldState: any, state: any) {\r\n\r\n        if (state.touch == \"start\") {\r\n\r\n            this._touchesPos = state.touchesPos;\r\n            this.graphics.clear();\r\n            this._zhiLine.visible = false;\r\n            this._touchesPos.length = 0;\r\n\r\n        } else if (state.touch == \"move\") {\r\n\r\n            this._touchesPos = state.touchesPos;\r\n\r\n        } else if (state.touch == \"end\") {\r\n\r\n            this.graphics.clear();\r\n\r\n            if (this._touchesPos.length > 0) {\r\n\r\n                this._zhiLine.visible = true;\r\n                this._zhiLine.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n                this._zhiLine.x = this._touchesPos[0].x;\r\n                this._zhiLine.y = this._view.height - this._touchesPos[0].y;\r\n                //this._zhiLine.y = 635;\r\n                this._zhiLine.sortingOrder = 0;\r\n                this._drawLan.sortingOrder = 1;\r\n                this._drawRed.sortingOrder = 1;\r\n                this._drawLineRect.y = this._zhiLine.y;\r\n                this._drawLineRect.width = this._zhiLine.width;\r\n\r\n                // 直线 线段 左蓝射线 右红射线\r\n\r\n                this._touchesPos.sort(this.comparePos());\r\n\r\n                let tempPos0 = new cc.Vec2(this._touchesPos[0].x, this._view.height - this._touchesPos[0].y);\r\n                let tempPos1 = new cc.Vec2(this._touchesPos[this._touchesPos.length - 1].x, this._view.height - this._touchesPos[this._touchesPos.length - 1].y);\r\n\r\n                if (this._lanRect.contains(tempPos0)) {\r\n                    console.log('==== 333 ====');\r\n                    this._touchesPos[0].x = this._defaultMinX;\r\n                }\r\n                if (this._redRect.contains(tempPos1)) {\r\n                    console.log('==== 444 ====');\r\n                    this._touchesPos[this._touchesPos.length - 1].x = this._defaultMaxX;\r\n                }\r\n\r\n                this._touchXMax = this._touchesPos[this._touchesPos.length - 1].x;\r\n                this._touchXMin = this._touchesPos[0].x;\r\n\r\n                this._drawLineRect.x = this._touchesPos[0].x;\r\n                this._drawLineRect.width = this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x;\r\n\r\n            }\r\n\r\n        }\r\n\r\n\r\n        if (!globalThis._.isEqual(oldState.gameOver, state.gameOver)) {\r\n\r\n            if (state.gameOver === this.gameResult.Success) {\r\n\r\n                this.unschedule(this.updatePlayerMove);\r\n                this.rightLineFly();\r\n\r\n            } else if (state.gameOver === this.gameResult.Fail) {\r\n\r\n                this.unschedule(this.updatePlayerMove);\r\n                //重新开始\r\n                cc.tween(this._player)\r\n                    .to(0.03, { y: this._player.y + 400 })\r\n                    .call(() => {\r\n                        let state: any = globalThis._.cloneDeep(this._state);\r\n                        state.gameStart = false;\r\n                        state.gameOver = this.gameResult.No;\r\n                        this.updateState(state);\r\n\r\n                    })\r\n                    .start()\r\n            }\r\n        }\r\n\r\n        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n\r\n            if (state.submit === this.submitType.RightFeed) {\r\n\r\n                this.answerFeedback(true);\r\n\r\n            } else if (state.submit === this.submitType.WrongFeed) {\r\n\r\n                this.answerFeedback(false);\r\n\r\n            } else if (state.submit === this.submitType.GuideShow) {\r\n\r\n                let keyBtn = this._view.getChild('input1').asButton;\r\n                this.handTips2(keyBtn);\r\n            }\r\n        }\r\n\r\n        if (!globalThis._.isEqual(oldState.gameStart, state.gameStart)) {\r\n\r\n            if (state.gameStart) {\r\n\r\n                // 游戏开始\r\n                this._zhiLine.visible = false;\r\n                this.graphics.clear();\r\n                this._touchesPos.length = 0;\r\n                this._player.x = this._view.width;\r\n                this._player.y = 635;\r\n                this._moveSpeed = 1;\r\n                this._view.on(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n                this._view.on(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n                this._view.on(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n\r\n                this.graphics.enabled = true;\r\n\r\n                this._startBtn.visible = false;\r\n                this._maskBg.visible = false;\r\n\r\n                this.schedule(this.updatePlayerMove, 0.05);\r\n\r\n            } else {\r\n\r\n                this._view.off(cc.Node.EventType.TOUCH_START, this._onDrawStart, this);\r\n                this._view.off(cc.Node.EventType.TOUCH_MOVE, this._onDrawMove, this);\r\n                this._view.off(cc.Node.EventType.TOUCH_END, this._onDrawEnd, this);\r\n\r\n                this._startBtn.visible = true;\r\n                this._maskBg.visible = true;\r\n                this.graphics.enabled = false;\r\n\r\n                this._zhiLine.visible = false;\r\n                this._zhiLine.width = 0;\r\n                this.graphics.clear();\r\n                this._touchesPos.length = 0;\r\n\r\n                this.unschedule(this.updatePlayerMove);\r\n            }\r\n        }\r\n\r\n        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n            this.playTitle(state.title);\r\n        }\r\n    }\r\n\r\n    rightLineFly() {\r\n\r\n        let len = this._showLinesObj.length;\r\n\r\n        if (len >= 3) {\r\n\r\n            return;\r\n\r\n        }\r\n\r\n        this._zhiLine.visible = false;\r\n        this._drawLan.visible = false;\r\n        this._drawRed.visible = false;\r\n\r\n        let dianLeftMin = this._drawLan.x;\r\n        let dianLeftMax = this._drawLan.x + this._drawLan.width;\r\n\r\n        let dianRightMax = this._drawRed.x + this._drawRed.width;\r\n        let dianRightMin = this._drawRed.x;\r\n\r\n        let cha = 5;\r\n        let tempLineData = {};\r\n\r\n        // 1、直线\r\n        if ((this._touchesPos[0].x - dianLeftMin) < -cha && (this._touchesPos[this._touchesPos.length - 1].x - dianRightMax) > cha) {\r\n\r\n            // 直线\r\n            tempLineData['type'] = this.lineType.StraightLine\r\n\r\n        } else if (this._touchesPos[0].x >= dianLeftMin &&\r\n            this._touchesPos[0].x <= dianLeftMax && this._touchesPos[this._touchesPos.length - 1].x >= dianRightMin && this._touchesPos[this._touchesPos.length - 1].x <= dianRightMax) {\r\n\r\n            //线段\r\n            tempLineData['type'] = this.lineType.LineSegment;\r\n\r\n        } else if (this._touchesPos[0].x >= dianLeftMin &&\r\n            this._touchesPos[0].x <= dianLeftMax && (this._touchesPos[this._touchesPos.length - 1].x - dianRightMax) > cha) {\r\n\r\n            // 左蓝射线\r\n            tempLineData['type'] = this.lineType.LeftLanRays;\r\n\r\n        } else if (this._touchesPos[this._touchesPos.length - 1].x >= dianRightMin &&\r\n            this._touchesPos[this._touchesPos.length - 1].x <= dianRightMax && (this._touchesPos[0].x - dianLeftMin) < -cha) {\r\n\r\n            // 右红射线\r\n            tempLineData['type'] = this.lineType.RightRedRays;\r\n\r\n        }\r\n\r\n        this._showLines.push(tempLineData);\r\n\r\n        console.log('==== type 111 ====' + tempLineData['type']);\r\n\r\n        let lineW = Math.abs(this._touchesPos[this._touchesPos.length - 1].x - this._touchesPos[0].x);\r\n\r\n        let leftLan = null;\r\n        let rightRed = null;\r\n\r\n        let lineObj = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox2a');\r\n        this._view.addChild(lineObj);\r\n        lineObj.width = lineW;\r\n        lineObj.x = this._touchesPos[0].x;\r\n        lineObj.y = this._touchesPos[0].y;\r\n\r\n        if (tempLineData['type'] === this.lineType.LineSegment) {\r\n\r\n            leftLan = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox27');\r\n            this._view.addChild(leftLan);\r\n            leftLan.x = this._touchesPos[0].x;\r\n            leftLan.y = this._drawLan.y;\r\n\r\n            rightRed = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox26');\r\n            this._view.addChild(rightRed);\r\n            rightRed.x = this._touchesPos[this._touchesPos.length - 1].x;\r\n            rightRed.y = this._drawRed.y;\r\n\r\n        } else if (tempLineData['type'] === this.lineType.LeftLanRays) {\r\n\r\n            leftLan = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox27');\r\n            this._view.addChild(leftLan);\r\n            leftLan.x = this._touchesPos[0].x;\r\n            leftLan.y = this._drawLan.y;\r\n\r\n        } else if (tempLineData['type'] === this.lineType.RightRedRays) {\r\n\r\n            rightRed = fgui.UIPackage.createObjectFromURL('ui://mgpb39d5xdox26');\r\n            this._view.addChild(rightRed);\r\n            rightRed.x = this._touchesPos[this._touchesPos.length - 1].x;\r\n            rightRed.y = this._drawRed.y;\r\n        }\r\n\r\n        cc.tween(lineObj)\r\n            .to(0.15, { x: this._showPosArr[len].line.x, y: this._showPosArr[len].line.y })\r\n            .to(0.15, { scaleX: 0.7, scaleY: 0.7 })\r\n            .call(() => {\r\n                let state: any = globalThis._.cloneDeep(this._state);\r\n                state.gameStart = false;\r\n                state.gameOver = this.gameResult.No;\r\n                this.updateState(state);\r\n\r\n                lineObj.width = 710;\r\n                this._showLinesObj.push(lineObj);\r\n                this._zhiLine.visible = true;\r\n                this._drawLan.visible = true;\r\n                this._drawRed.visible = true;\r\n                this._zhiLine.width = 0;\r\n            })\r\n            .start()\r\n\r\n        cc.tween(leftLan)\r\n            .to(0.15, { x: this._showPosArr[len].lan.x, y: this._showPosArr[len].lan.y })\r\n            .to(0.15, { scaleX: 0.7, scaleY: 0.7 })\r\n            .start()\r\n\r\n        cc.tween(rightRed)\r\n            .to(0.15, { x: this._showPosArr[len].red.x, y: this._showPosArr[len].red.y })\r\n            .to(0.15, { scaleX: 0.7, scaleY: 0.7 })\r\n            .start()\r\n\r\n\r\n    }\r\n\r\n    async playTitle(bool: boolean) {\r\n        this._c1.selectedIndex = bool ? 1 : 0;\r\n        if (bool) {\r\n            cc.audioEngine.stopAll();\r\n            this.forbidHandle();\r\n            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n            let audioId = cc.audioEngine.play(audio, false, 1);\r\n            cc.audioEngine.setFinishCallback(audioId, () => {\r\n                let state: any = globalThis._.cloneDeep(this._state);\r\n                state.title = false;\r\n                this.updateState(state);\r\n            });\r\n        } else {\r\n            this.disableForbidHandle();\r\n        }\r\n    }\r\n\r\n    answerFeedback(bool: boolean) {\r\n        if (!this.feedback) return;\r\n        let feedback: any = cc.instantiate(this.feedback);\r\n        feedback.x = 960;\r\n        feedback.y = 540;\r\n        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n        feedbackJs.init(bool);\r\n        feedback.parent = cc.find(\"Canvas\").parent;\r\n\r\n        setTimeout(() => {\r\n            feedback.destroy();\r\n            let state: any = globalThis._.cloneDeep(this._state);\r\n            state.submit = this.submitType.No;\r\n            this.updateState(state);\r\n        }, 2000);\r\n    }\r\n\r\n\r\n    /**\r\n     * 点击指引\r\n     * @param obj 点击对象\r\n     */\r\n    handTips2(obj: fgui.GObject) {\r\n        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n        this._view.addChild(hand);\r\n        let tempX = obj.x;\r\n        let tempY = obj.y;\r\n\r\n        hand.x = tempX;\r\n        hand.y = tempY;\r\n\r\n        cc.tween(hand).to(0.3, {\r\n            x: tempX - 30,\r\n            y: tempY - 30\r\n        }).to(0.3, {\r\n            x: tempX,\r\n            y: tempY\r\n        }).to(0.3, {\r\n            x: tempX - 30,\r\n            y: tempY - 30\r\n        }).to(0.3, {\r\n            x: tempX,\r\n            y: tempY\r\n        }).call(() => {\r\n            this._view.removeChild(hand);\r\n            hand = null;\r\n            let state: any = globalThis._.cloneDeep(this._state);\r\n            state.submit = this.submitType.No;\r\n            this.updateState(state)\r\n        }).start();\r\n    }\r\n\r\n    // 运行时 禁止操作\r\n    forbidHandle() {\r\n        console.log('===  运行时 禁止操作 =====');\r\n        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n        if (!handleMask) {\r\n            let handleMask = new cc.Node('handleMask');\r\n            handleMask.addComponent(cc.BlockInputEvents);\r\n            handleMask.parent = this._worldRoot;\r\n            handleMask.width = 1920;\r\n            handleMask.height = 1080;\r\n            handleMask.x = 960;\r\n            handleMask.y = 540;\r\n        }\r\n    }\r\n\r\n    // 消除禁止\r\n    disableForbidHandle() {\r\n        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n        if (handleMask) handleMask.destroy();\r\n    }\r\n\r\n    // 注册状态，及获取状态的方法\r\n    registerState() {\r\n        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n    }\r\n\r\n    // 解除状态，及获取状态的方法\r\n    relieveState() {\r\n        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n    }\r\n\r\n    // 本组件状态合并到全局\r\n    mergeState() {\r\n        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n    }\r\n\r\n    onEnable() {\r\n        this.registerState();\r\n        // this.schedule(this.dragSchedule, this._scheduleTime);\r\n    }\r\n\r\n    onDisable() {\r\n        this.relieveState();\r\n        cc.audioEngine.stopAll();\r\n    }\r\n}\r\n"
        }
    ]
}