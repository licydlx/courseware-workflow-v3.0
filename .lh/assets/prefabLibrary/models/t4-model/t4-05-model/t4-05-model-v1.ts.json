{
    "sourceFile": "assets/prefabLibrary/models/t4-model/t4-05-model/t4-05-model-v1.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 317,
            "patches": [
                {
                    "date": 1624502666702,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1624503136463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,9 +77,8 @@\n \r\n \r\n         this._mask = this._view.getChild('maskBg').asGraph;\r\n         this._c1 = this._view.getController(\"c1\");\r\n-        this._c2 = this._view.getController(\"c2\");\r\n \r\n         // 臨時\r\n         // bug 初始设置不播放不生效\r\n         if (this._c1) {\r\n"
                },
                {
                    "date": 1624503193006,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,30 +17,16 @@\n     private _view: fgui.GComponent;\r\n \r\n     private _c1: fgui.Controller;\r\n \r\n-    private _c2: fgui.Controller;\r\n-\r\n-    private _paoShow: any = [];\r\n-\r\n-    private _chooseBtn: any = [];\r\n-\r\n-    private _selectIcons: any = [];\r\n-\r\n-    private _chooseCach: any = [];\r\n-\r\n     private _title: fgui.GButton;\r\n \r\n     private _titleTrigger: fgui.GLoader;\r\n \r\n     private _submitBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n-    private _boxSound: cc.AudioClip;\r\n-\r\n-    private _mask: fgui.GGraph;\r\n-\r\n     private _guidIndex: number = 0;\r\n \r\n     private _box3D: fgui.GLoader3D;\r\n \r\n@@ -85,51 +71,16 @@\n             this._c1.selectedIndex = 1;\r\n             this._c1.selectedIndex = 0;\r\n         }\r\n \r\n-        this._box3D = this._view.getChild(\"box\") as fgui.GLoader3D;\r\n-        this._box3D.on(fgui.Event.CLICK, this._clickBox, this);\r\n-        this._box3D.url = \"ui://733aoo45gzaz75\";\r\n-        this._box3D.animationName = 'sjq_idle';\r\n-\r\n         this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n         if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n \r\n         this._title = this._view.getChild(\"title\").asButton;\r\n \r\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n-        let paoGroup = this._view.getChild(\"pao\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == paoGroup) {\r\n-                let btn: fgui.GButton = this._view.getChildAt(i).asButton;\r\n-                btn.alpha = 0;\r\n-                this._paoShow.push(btn);\r\n-            }\r\n-        }\r\n-\r\n-        let chooseGroup = this._view.getChild(\"choose\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == chooseGroup) {\r\n-                let btn: fgui.GButton = this._view.getChildAt(i).asButton;\r\n-                btn.data = { index: this._chooseCach.length };\r\n-                let temp = { index: this._chooseCach.length, selected: false };\r\n-                this._chooseCach.push(temp);\r\n-                this._chooseBtn.push(btn);\r\n-                btn.on(fgui.Event.CLICK, this._clickChoose, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectedGroup = this._view.getChild(\"select\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectedGroup) {\r\n-                let icon: fgui.GImage = this._view.getChildAt(i).asImage;\r\n-                icon.visible = false;\r\n-                this._selectIcons.push(icon);\r\n-            }\r\n-        }\r\n-\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             boxPlay: false,\r\n"
                },
                {
                    "date": 1624503463820,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,12 +25,8 @@\n     private _submitBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n-    private _guidIndex: number = 0;\r\n-\r\n-    private _box3D: fgui.GLoader3D;\r\n-\r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n         GuideShow: 1,\r\n@@ -60,10 +56,8 @@\n         this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n \r\n         fgui.GRoot.inst.addChild(this._view);\r\n \r\n-\r\n-        this._mask = this._view.getChild('maskBg').asGraph;\r\n         this._c1 = this._view.getController(\"c1\");\r\n \r\n         // 臨時\r\n         // bug 初始设置不播放不生效\r\n@@ -82,11 +76,8 @@\n \r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n-            boxPlay: false,\r\n-            canChoose: false,\r\n-            chooseCach: this._chooseCach,\r\n             submit: this.submitType.No,\r\n         }\r\n     }\r\n \r\n"
                },
                {
                    "date": 1624503490663,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -90,12 +90,11 @@\n         this._package = Package;\r\n \r\n         this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n \r\n-        let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n \r\n-        if (guidIndex) this._guidIndex = guidIndex;\r\n \r\n         // 动效注册\r\n         // for (let v in ae) {\r\n         //     if (ae[v]) {\r\n"
                },
                {
                    "date": 1624503583640,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -113,25 +113,8 @@\n             }\r\n         }\r\n     }\r\n \r\n-    private _clickChoose(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        let obj: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let btn: fgui.GButton = obj.asButton;\r\n-\r\n-        for (let i = 0; i < state.chooseCach.length; i++) {\r\n-            state.chooseCach[i].selected = false;\r\n-        }\r\n-        for (let i = 0; i < state.chooseCach.length; i++) {\r\n-            if (state.chooseCach[i].index === btn.data.index) {\r\n-                state.chooseCach[i].selected = true;\r\n-                break;\r\n-            }\r\n-        }\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n \r\n         let isHave = 0;\r\n@@ -163,14 +146,8 @@\n \r\n         this.updateState(state);\r\n     }\r\n \r\n-    private _clickBox(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.boxPlay = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n     private _clickTitle(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.title = true;\r\n         this.updateState(state);\r\n@@ -190,29 +167,11 @@\n \r\n     // 更新ui层\r\n     updateUi(oldState: any, state: any) {\r\n \r\n-        if (!globalThis._.isEqual(oldState.boxPlay, state.boxPlay)) {\r\n-            if (state.boxPlay) {\r\n-                this.playBoxSpeak(state.boxPlay);\r\n-            } else {\r\n-                this._box3D.animationName = 'sjq_idle';\r\n-                this._c2.selectedIndex = 0;\r\n-            }\r\n-        }\r\n \r\n-        if (!globalThis._.isEqual(oldState.chooseCach, state.chooseCach)) {\r\n \r\n-            for (let i = 0; i < state.chooseCach.length; i++) {\r\n \r\n-                for (let j = 0; j < this._selectIcons.length; j++) {\r\n-                    if (state.chooseCach[i].index === j) {\r\n-                        this._selectIcons[j].visible = state.chooseCach[i].selected;\r\n-                        break;\r\n-                    }\r\n-                }\r\n-            }\r\n-        }\r\n \r\n         if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n \r\n             if (state.submit === this.submitType.RightFeed) {\r\n@@ -224,20 +183,16 @@\n                 this.answerFeedback(false);\r\n \r\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n-                this.handTips2(this._chooseBtn[this._guidIndex]);\r\n+\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n             this.playTitle(state.title);\r\n         }\r\n \r\n-        if (!globalThis._.isEqual(oldState.canChoose, state.canChoose)) {\r\n-            this._mask.visible = !state.canChoose;\r\n-        }\r\n-\r\n     }\r\n \r\n \r\n     async playTitle(bool: boolean) {\r\n@@ -257,75 +212,8 @@\n             this.disableForbidHandle();\r\n         }\r\n     }\r\n \r\n-    playBoxSpeak(bool: boolean) {\r\n-        if (bool) {\r\n-\r\n-            this._box3D.animationName = 'sjq_idle1to2';\r\n-\r\n-            cc.tween(this._box3D)\r\n-                .delay(0.3)\r\n-                .call(() => {\r\n-                    this._box3D.animationName = 'sjq_idle2';\r\n-                })\r\n-                .start()\r\n-\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            this.playBoxSound();\r\n-\r\n-        } else {\r\n-            this._c2.selectedIndex = 0;\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    async playBoxSound() {\r\n-\r\n-        for (let i = 0; i < this._paoShow.length; i++) {\r\n-            this._paoShow[i].alpha = 0;\r\n-        }\r\n-\r\n-        cc.tween(this)\r\n-            .delay(0.5)\r\n-            .call(() => {\r\n-\r\n-                this._c2.selectedIndex = 1;\r\n-                this.playPaoShowAnimate(0);\r\n-            })\r\n-            .start();\r\n-\r\n-        let audioId = cc.audioEngine.play(this._boxSound, false, 1);\r\n-        cc.audioEngine.setFinishCallback(audioId, () => {\r\n-            this._box3D.animationName = 'sjq_idle';\r\n-            this.disableForbidHandle();\r\n-            for (let i = 0; i < this._paoShow.length; i++) {\r\n-                this._paoShow[i].alpha = 0;\r\n-            }\r\n-            this._c2.selectedIndex = 0;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.boxPlay = false;\r\n-            state.canChoose = true;\r\n-            this.updateState(state);\r\n-\r\n-        });\r\n-    }\r\n-\r\n-    playPaoShowAnimate(index: number) {\r\n-\r\n-        cc.tween(this._paoShow[index])\r\n-            .to(1.0, { alpha: 1 })\r\n-            .call(() => {\r\n-                index++;\r\n-                if (index < this._paoShow.length) {\r\n-                    this.playPaoShowAnimate(index);\r\n-                }\r\n-            })\r\n-            .start()\r\n-\r\n-    }\r\n-\r\n     answerFeedback(bool: boolean) {\r\n         if (!this.feedback) return;\r\n         let feedback: any = cc.instantiate(this.feedback);\r\n         feedback.x = 960;\r\n@@ -417,9 +305,8 @@\n         this.registerState();\r\n     }\r\n \r\n     onDisable() {\r\n-        cc.tween(this._box3D).stop();\r\n         cc.tween(this).stop();\r\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n"
                },
                {
                    "date": 1624503781226,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,12 +167,8 @@\n \r\n     // 更新ui层\r\n     updateUi(oldState: any, state: any) {\r\n \r\n-\r\n-\r\n-\r\n-\r\n         if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n \r\n             if (state.submit === this.submitType.RightFeed) {\r\n \r\n"
                },
                {
                    "date": 1624504221674,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,309 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+\r\n+        let isHave = 0;\r\n+        for (let i = 0; i < state.chooseCach.length; i++) {\r\n+\r\n+            if (state.chooseCach[i].selected) {\r\n+                isHave++;\r\n+            }\r\n+        }\r\n+\r\n+        if (isHave === 0) {\r\n+            state.submit = this.submitType.GuideShow;\r\n+        } else if (isHave === 1) {\r\n+\r\n+            state.submit = this.submitType.WrongFeed;\r\n+\r\n+            for (let i = 0; i < state.chooseCach.length; i++) {\r\n+\r\n+                if (state.chooseCach[i].selected && state.chooseCach[i].index === 0) {\r\n+\r\n+                    state.submit = this.submitType.RightFeed;\r\n+                    break;\r\n+                }\r\n+            }\r\n+\r\n+        } else {\r\n+            state.submit = this.submitType.WrongFeed;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624504230561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -306,313 +306,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-\r\n-        let isHave = 0;\r\n-        for (let i = 0; i < state.chooseCach.length; i++) {\r\n-\r\n-            if (state.chooseCach[i].selected) {\r\n-                isHave++;\r\n-            }\r\n-        }\r\n-\r\n-        if (isHave === 0) {\r\n-            state.submit = this.submitType.GuideShow;\r\n-        } else if (isHave === 1) {\r\n-\r\n-            state.submit = this.submitType.WrongFeed;\r\n-\r\n-            for (let i = 0; i < state.chooseCach.length; i++) {\r\n-\r\n-                if (state.chooseCach[i].selected && state.chooseCach[i].index === 0) {\r\n-\r\n-                    state.submit = this.submitType.RightFeed;\r\n-                    break;\r\n-                }\r\n-            }\r\n-\r\n-        } else {\r\n-            state.submit = this.submitType.WrongFeed;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624504292226,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,309 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+\r\n+        let isHave = 0;\r\n+        for (let i = 0; i < state.chooseCach.length; i++) {\r\n+\r\n+            if (state.chooseCach[i].selected) {\r\n+                isHave++;\r\n+            }\r\n+        }\r\n+\r\n+        if (isHave === 0) {\r\n+            state.submit = this.submitType.GuideShow;\r\n+        } else if (isHave === 1) {\r\n+\r\n+            state.submit = this.submitType.WrongFeed;\r\n+\r\n+            for (let i = 0; i < state.chooseCach.length; i++) {\r\n+\r\n+                if (state.chooseCach[i].selected && state.chooseCach[i].index === 0) {\r\n+\r\n+                    state.submit = this.submitType.RightFeed;\r\n+                    break;\r\n+                }\r\n+            }\r\n+\r\n+        } else {\r\n+            state.submit = this.submitType.WrongFeed;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624504299184,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -179,16 +179,14 @@\n                 this.answerFeedback(false);\r\n \r\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n-\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n             this.playTitle(state.title);\r\n         }\r\n-\r\n     }\r\n \r\n \r\n     async playTitle(bool: boolean) {\r\n@@ -306,313 +304,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-\r\n-        let isHave = 0;\r\n-        for (let i = 0; i < state.chooseCach.length; i++) {\r\n-\r\n-            if (state.chooseCach[i].selected) {\r\n-                isHave++;\r\n-            }\r\n-        }\r\n-\r\n-        if (isHave === 0) {\r\n-            state.submit = this.submitType.GuideShow;\r\n-        } else if (isHave === 1) {\r\n-\r\n-            state.submit = this.submitType.WrongFeed;\r\n-\r\n-            for (let i = 0; i < state.chooseCach.length; i++) {\r\n-\r\n-                if (state.chooseCach[i].selected && state.chooseCach[i].index === 0) {\r\n-\r\n-                    state.submit = this.submitType.RightFeed;\r\n-                    break;\r\n-                }\r\n-            }\r\n-\r\n-        } else {\r\n-            state.submit = this.submitType.WrongFeed;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624504346928,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,307 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+\r\n+        let isHave = 0;\r\n+        for (let i = 0; i < state.chooseCach.length; i++) {\r\n+\r\n+            if (state.chooseCach[i].selected) {\r\n+                isHave++;\r\n+            }\r\n+        }\r\n+\r\n+        if (isHave === 0) {\r\n+            state.submit = this.submitType.GuideShow;\r\n+        } else if (isHave === 1) {\r\n+\r\n+            state.submit = this.submitType.WrongFeed;\r\n+\r\n+            for (let i = 0; i < state.chooseCach.length; i++) {\r\n+\r\n+                if (state.chooseCach[i].selected && state.chooseCach[i].index === 0) {\r\n+\r\n+                    state.submit = this.submitType.RightFeed;\r\n+                    break;\r\n+                }\r\n+            }\r\n+\r\n+        } else {\r\n+            state.submit = this.submitType.WrongFeed;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624504434610,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -304,311 +304,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-\r\n-        let isHave = 0;\r\n-        for (let i = 0; i < state.chooseCach.length; i++) {\r\n-\r\n-            if (state.chooseCach[i].selected) {\r\n-                isHave++;\r\n-            }\r\n-        }\r\n-\r\n-        if (isHave === 0) {\r\n-            state.submit = this.submitType.GuideShow;\r\n-        } else if (isHave === 1) {\r\n-\r\n-            state.submit = this.submitType.WrongFeed;\r\n-\r\n-            for (let i = 0; i < state.chooseCach.length; i++) {\r\n-\r\n-                if (state.chooseCach[i].selected && state.chooseCach[i].index === 0) {\r\n-\r\n-                    state.submit = this.submitType.RightFeed;\r\n-                    break;\r\n-                }\r\n-            }\r\n-\r\n-        } else {\r\n-            state.submit = this.submitType.WrongFeed;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624506511457,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,36 +115,13 @@\n     }\r\n \r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n \r\n-        let isHave = 0;\r\n-        for (let i = 0; i < state.chooseCach.length; i++) {\r\n \r\n-            if (state.chooseCach[i].selected) {\r\n-                isHave++;\r\n-            }\r\n-        }\r\n-\r\n-        if (isHave === 0) {\r\n-            state.submit = this.submitType.GuideShow;\r\n-        } else if (isHave === 1) {\r\n-\r\n-            state.submit = this.submitType.WrongFeed;\r\n-\r\n-            for (let i = 0; i < state.chooseCach.length; i++) {\r\n-\r\n-                if (state.chooseCach[i].selected && state.chooseCach[i].index === 0) {\r\n-\r\n-                    state.submit = this.submitType.RightFeed;\r\n-                    break;\r\n-                }\r\n-            }\r\n-\r\n-        } else {\r\n-            state.submit = this.submitType.WrongFeed;\r\n-        }\r\n-\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickTitle(evt: any) {\r\n"
                },
                {
                    "date": 1624506518708,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -119,9 +119,8 @@\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n \r\n-\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickTitle(evt: any) {\r\n"
                },
                {
                    "date": 1624506680753,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,8 +25,14 @@\n     private _submitBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n+    private _selectArr: [];\r\n+\r\n+    private _kuangArr: [];\r\n+\r\n+    private _textArr: [];\r\n+\r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n         GuideShow: 1,\r\n"
                },
                {
                    "date": 1624506761230,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -79,8 +79,10 @@\n \r\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n+        let optionGroup = this._view.getChild(\"optionBox\").asGroup;\r\n+\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n"
                },
                {
                    "date": 1624506768922,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -79,9 +79,9 @@\n \r\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n-        let optionGroup = this._view.getChild(\"optionBox\").asGroup;\r\n+        let kuangGroup = this._view.getChild(\"optionBox\").asGroup;\r\n \r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n"
                },
                {
                    "date": 1624506781405,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -79,9 +79,9 @@\n \r\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n-        let kuangGroup = this._view.getChild(\"optionBox\").asGroup;\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n \r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n"
                },
                {
                    "date": 1624506795854,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,9 +80,27 @@\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == optionGroup) {\r\n+                let btn = null;\r\n+                if (this._isAnimateShow) {\r\n \r\n+                    btn = this._view.getChildAt(i) as fgui.GLoader3D;\r\n+                    btn.animationName = this._animateName[btn.name].idle;\r\n+                    btn.skinName = this._animateName[btn.name].skin;\r\n+                    btn.url = \"ui://733aoo45gzaz72\";\r\n+\r\n+                } else {\r\n+                    btn = this._view.getChildAt(i).asButton;\r\n+                }\r\n+\r\n+                btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n+                this._options[btn.name] = btn;\r\n+            }\r\n+        }\r\n+\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n"
                },
                {
                    "date": 1624506823703,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,10 +27,8 @@\n     private _package: any;\r\n \r\n     private _selectArr: [];\r\n \r\n-    private _kuangArr: [];\r\n-\r\n     private _textArr: [];\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n"
                },
                {
                    "date": 1624506842596,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -79,9 +79,9 @@\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == optionGroup) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = null;\r\n                 if (this._isAnimateShow) {\r\n \r\n                     btn = this._view.getChildAt(i) as fgui.GLoader3D;\r\n"
                },
                {
                    "date": 1624506857772,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -80,18 +80,18 @@\n \r\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = null;\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n                 if (this._isAnimateShow) {\r\n \r\n                     btn = this._view.getChildAt(i) as fgui.GLoader3D;\r\n                     btn.animationName = this._animateName[btn.name].idle;\r\n                     btn.skinName = this._animateName[btn.name].skin;\r\n                     btn.url = \"ui://733aoo45gzaz72\";\r\n \r\n                 } else {\r\n-                    btn = this._view.getChildAt(i).asButton;\r\n+\r\n                 }\r\n \r\n                 btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n                 this._options[btn.name] = btn;\r\n"
                },
                {
                    "date": 1624506863069,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -81,19 +81,8 @@\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n-                if (this._isAnimateShow) {\r\n-\r\n-                    btn = this._view.getChildAt(i) as fgui.GLoader3D;\r\n-                    btn.animationName = this._animateName[btn.name].idle;\r\n-                    btn.skinName = this._animateName[btn.name].skin;\r\n-                    btn.url = \"ui://733aoo45gzaz72\";\r\n-\r\n-                } else {\r\n-\r\n-                }\r\n-\r\n                 btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n                 this._options[btn.name] = btn;\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624506868501,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -82,9 +82,8 @@\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n                 btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n-                this._options[btn.name] = btn;\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n"
                },
                {
                    "date": 1624506884365,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,295 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectArr: [];\r\n+\r\n+    private _textArr: [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624506890548,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -292,299 +292,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectArr: [];\r\n-\r\n-    private _textArr: [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624506946279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,295 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectArr: [];\r\n+\r\n+    private _textArr: [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624506974079,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -81,9 +81,9 @@\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n-                btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n@@ -125,303 +125,13 @@\n             }\r\n         }\r\n     }\r\n \r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n+    private _clickKuang(evt: any) {\r\n \r\n-        this.updateState(state);\r\n-    }\r\n \r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n     }\r\n \r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectArr: [];\r\n-\r\n-    private _textArr: [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                btn.on(fgui.Event.CLICK, this._clickOption, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n"
                },
                {
                    "date": 1624507010054,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -128,8 +128,9 @@\n \r\n     private _clickKuang(evt: any) {\r\n \r\n \r\n+\r\n     }\r\n \r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n"
                },
                {
                    "date": 1624507022052,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,8 +29,10 @@\n     private _selectArr: [];\r\n \r\n     private _textArr: [];\r\n \r\n+\r\n+\r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n         GuideShow: 1,\r\n"
                },
                {
                    "date": 1624507058371,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,10 +29,10 @@\n     private _selectArr: [];\r\n \r\n     private _textArr: [];\r\n \r\n+    private _kuangNameArr: [];\r\n \r\n-\r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n         GuideShow: 1,\r\n@@ -83,8 +83,9 @@\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624507125655,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,13 +25,13 @@\n     private _submitBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n-    private _selectArr: [];\r\n+    private _selectArr: any = [];\r\n \r\n-    private _textArr: [];\r\n+    private _textArr: any = [];\r\n \r\n-    private _kuangNameArr: [];\r\n+    private _kuangNameArr: any = [];\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n"
                },
                {
                    "date": 1624507188828,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,304 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectArr: any = [];\r\n+\r\n+    private _textArr: any = [];\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624507200285,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -301,308 +301,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectArr: any = [];\r\n-\r\n-    private _textArr: any = [];\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-\r\n-\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624507230754,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,8 +92,9 @@\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n"
                },
                {
                    "date": 1624507583074,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -132,9 +132,10 @@\n \r\n     private _clickKuang(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        selectKuangName\r\n     }\r\n \r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n"
                },
                {
                    "date": 1624507596809,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,306 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectArr: any = [];\r\n+\r\n+    private _textArr: any = [];\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624507608508,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -134,8 +134,9 @@\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.selectKuangName = btn.name;\r\n+        this.updateState();\r\n     }\r\n \r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n@@ -303,310 +304,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectArr: any = [];\r\n-\r\n-    private _textArr: any = [];\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        selectKuangName\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624507623316,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,8 +88,17 @@\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n@@ -134,9 +143,9 @@\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.selectKuangName = btn.name;\r\n-        this.updateState();\r\n+        this.updateState(state);\r\n     }\r\n \r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n"
                },
                {
                    "date": 1624507629581,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,316 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectArr: any = [];\r\n+\r\n+    private _textArr: any = [];\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624507639907,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,9 +88,9 @@\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n-        let selectGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n                 this._kuangNameArr.push(btn.name);\r\n@@ -313,320 +313,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectArr: any = [];\r\n-\r\n-    private _textArr: any = [];\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624507652770,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n     private _submitBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n-    private _selectArr: any = [];\r\n+    private _selectArr: any = {};\r\n \r\n     private _textArr: any = [];\r\n \r\n     private _kuangNameArr: any = [];\r\n"
                },
                {
                    "date": 1624507659258,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n     private _submitBtn: fgui.GButton;\r\n \r\n     private _package: any;\r\n \r\n-    private _selectArr: any = {};\r\n+    private _selectMap: any = {};\r\n \r\n     private _textArr: any = [];\r\n \r\n     private _kuangNameArr: any = [];\r\n"
                },
                {
                    "date": 1624507668364,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,9 +27,9 @@\n     private _package: any;\r\n \r\n     private _selectMap: any = {};\r\n \r\n-    private _textArr: any = [];\r\n+    private _textMap: any = {};\r\n \r\n     private _kuangNameArr: any = [];\r\n \r\n     private submitType: any = cc.Enum({\r\n"
                },
                {
                    "date": 1624507689005,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -91,9 +91,10 @@\n \r\n         let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n+                let btn = this._view.getChildAt(i).asImage;\r\n+                _selectMap\r\n                 this._kuangNameArr.push(btn.name);\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624507697146,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -91,10 +91,10 @@\n \r\n         let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asImage;\r\n-                _selectMap\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap\r\n                 this._kuangNameArr.push(btn.name);\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624507718724,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,10 +92,10 @@\n         let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap\r\n-                this._kuangNameArr.push(btn.name);\r\n+                this._selectMap[this._kuangNameArr[i]] = \r\n+                .push(btn.name);\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624507728333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -92,10 +92,10 @@\n         let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[i]] = \r\n-                .push(btn.name);\r\n+                this._selectMap[this._kuangNameArr[i]] = img;\r\n+\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624507735298,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,8 @@\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let img = this._view.getChildAt(i).asImage;\r\n                 this._selectMap[this._kuangNameArr[i]] = img;\r\n \r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n"
                },
                {
                    "date": 1624507741471,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,9 +93,9 @@\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let img = this._view.getChildAt(i).asImage;\r\n                 this._selectMap[this._kuangNameArr[i]] = img;\r\n-\r\n+                img.visible = false;\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n"
                },
                {
                    "date": 1624507747219,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -90,9 +90,9 @@\n         }\r\n \r\n         let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n                 let img = this._view.getChildAt(i).asImage;\r\n                 this._selectMap[this._kuangNameArr[i]] = img;\r\n                 img.visible = false;\r\n             }\r\n"
                },
                {
                    "date": 1624507765387,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -97,8 +97,17 @@\n                 img.visible = false;\r\n             }\r\n         }\r\n \r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[i]] = img;\r\n+                img.visible = false;\r\n+            }\r\n+        }\r\n+\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n"
                },
                {
                    "date": 1624507788836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -99,10 +99,10 @@\n         }\r\n \r\n         let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let img = this._view.getChildAt(i).asLabel;\r\n                 this._selectMap[this._kuangNameArr[i]] = img;\r\n                 img.visible = false;\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624507805414,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -100,10 +100,10 @@\n \r\n         let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == textGroup) {\r\n-                let img = this._view.getChildAt(i).asLabel;\r\n-                this._selectMap[this._kuangNameArr[i]] = img;\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._selectMap[this._kuangNameArr[i]] = label;\r\n                 img.visible = false;\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624507815419,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,10 +101,9 @@\n         let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == textGroup) {\r\n                 let label = this._view.getChildAt(i).asLabel;\r\n-                this._selectMap[this._kuangNameArr[i]] = label;\r\n-                img.visible = false;\r\n+                this._selectMap[this._textMap[i]] = label;\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n"
                },
                {
                    "date": 1624507822682,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,8 +102,9 @@\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == textGroup) {\r\n                 let label = this._view.getChildAt(i).asLabel;\r\n                 this._selectMap[this._textMap[i]] = label;\r\n+\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n"
                },
                {
                    "date": 1624507855443,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,9 +101,9 @@\n         let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == textGroup) {\r\n                 let label = this._view.getChildAt(i).asLabel;\r\n-                this._selectMap[this._textMap[i]] = label;\r\n+                this._textMap[this._kuangNameArr[i]] = label;\r\n \r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624507885195,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -199,8 +199,11 @@\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n             }\r\n         }\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n             this.playTitle(state.title);\r\n         }\r\n"
                },
                {
                    "date": 1624507890412,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -200,9 +200,10 @@\n \r\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-            this.playTitle(state.title);\r\n+\r\n+\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n             this.playTitle(state.title);\r\n"
                },
                {
                    "date": 1624507895574,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -201,9 +201,11 @@\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n+            if () {\r\n \r\n+            }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n             this.playTitle(state.title);\r\n"
                },
                {
                    "date": 1624507901518,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -201,10 +201,11 @@\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n-            if () {\r\n+            if (state.selectKuangName) {\r\n \r\n+\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n"
                },
                {
                    "date": 1624507912084,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -201,9 +201,9 @@\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n-            if (state.selectKuangName) {\r\n+            if (state.selectKuangName != '') {\r\n \r\n \r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624508003127,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -203,8 +203,9 @@\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n             if (state.selectKuangName != '') {\r\n \r\n+                this._selectMap[state.selectKuangName]\r\n \r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624508018316,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -203,9 +203,9 @@\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n             if (state.selectKuangName != '') {\r\n \r\n-                this._selectMap[state.selectKuangName]\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n \r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624508023413,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -204,9 +204,8 @@\n \r\n             if (state.selectKuangName != '') {\r\n \r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n-\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n"
                },
                {
                    "date": 1624508033180,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -201,12 +201,16 @@\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n+\r\n             if (state.selectKuangName != '') {\r\n \r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n+            if () {\r\n+\r\n+            }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n             this.playTitle(state.title);\r\n"
                },
                {
                    "date": 1624508044772,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -206,10 +206,10 @@\n             if (state.selectKuangName != '') {\r\n \r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n-            if () {\r\n-\r\n+            if (oldState.selectKuangName != '') {\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n"
                },
                {
                    "date": 1624508050106,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -207,9 +207,9 @@\n \r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n             if (oldState.selectKuangName != '') {\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n+                this._selectMap[state.selectKuangName].visible = false;\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n"
                },
                {
                    "date": 1624508055301,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -206,9 +206,11 @@\n             if (state.selectKuangName != '') {\r\n \r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n+\r\n             if (oldState.selectKuangName != '') {\r\n+\r\n                 this._selectMap[state.selectKuangName].visible = false;\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624508067077,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[i]] = img;\r\n+                img.visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[i]] = label;\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624508081843,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -335,342 +335,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[i]] = img;\r\n-                img.visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[i]] = label;\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624508174958,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,338 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[i]] = img;\r\n+                img.visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[i]] = label;\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624508203177,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -83,8 +83,9 @@\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== ===' + );\r\n                 this._kuangNameArr.push(btn.name);\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n@@ -335,342 +336,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[i]] = img;\r\n-                img.visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[i]] = label;\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624508208627,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -83,9 +83,9 @@\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== ===' + );\r\n+                console.log('=== ===' + btn.name);\r\n                 this._kuangNameArr.push(btn.name);\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624508214049,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -83,9 +83,9 @@\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== ===' + btn.name);\r\n+                console.log('=== name ===' + btn.name);\r\n                 this._kuangNameArr.push(btn.name);\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624508264847,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -90,8 +90,9 @@\n             }\r\n         }\r\n \r\n         let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == selectGroup) {\r\n                 let img = this._view.getChildAt(i).asImage;\r\n                 this._selectMap[this._kuangNameArr[i]] = img;\r\n"
                },
                {
                    "date": 1624508270782,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,9 +94,9 @@\n         let indexTemp = 0;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == selectGroup) {\r\n                 let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[i]] = img;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n                 img.visible = false;\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624508275880,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -96,8 +96,9 @@\n             if (this._view.getChildAt(i).group == selectGroup) {\r\n                 let img = this._view.getChildAt(i).asImage;\r\n                 this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n                 img.visible = false;\r\n+                indexTemp++;\r\n             }\r\n         }\r\n \r\n         let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n"
                },
                {
                    "date": 1624508284189,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -100,8 +100,9 @@\n                 indexTemp++;\r\n             }\r\n         }\r\n \r\n+        indexTemp = 0;\r\n         let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == textGroup) {\r\n                 let label = this._view.getChildAt(i).asLabel;\r\n"
                },
                {
                    "date": 1624508292374,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -105,10 +105,10 @@\n         let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == textGroup) {\r\n                 let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[i]] = label;\r\n-\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n"
                },
                {
                    "date": 1624508397756,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -110,8 +110,17 @@\n                 indexTemp++;\r\n             }\r\n         }\r\n \r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n"
                },
                {
                    "date": 1624508411984,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -110,9 +110,9 @@\n                 indexTemp++;\r\n             }\r\n         }\r\n \r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        let textGroup = this._view.getChild(\"key\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == textGroup) {\r\n                 let label = this._view.getChildAt(i).asLabel;\r\n                 this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n"
                },
                {
                    "date": 1624508417063,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -110,9 +110,9 @@\n                 indexTemp++;\r\n             }\r\n         }\r\n \r\n-        let textGroup = this._view.getChild(\"key\").asGroup;\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == textGroup) {\r\n                 let label = this._view.getChildAt(i).asLabel;\r\n                 this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n"
                },
                {
                    "date": 1624508423179,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -112,9 +112,9 @@\n         }\r\n \r\n         let keyGroup = this._view.getChild(\"key\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n                 let label = this._view.getChildAt(i).asLabel;\r\n                 this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n                 indexTemp++;\r\n             }\r\n"
                },
                {
                    "date": 1624508430371,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -113,9 +113,9 @@\n \r\n         let keyGroup = this._view.getChild(\"key\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n+                let label = this._view.getChildAt(i).asButton;\r\n                 this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n                 indexTemp++;\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624508457440,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -113,10 +113,10 @@\n \r\n         let keyGroup = this._view.getChild(\"key\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let label = this._view.getChildAt(i).asButton;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = keyBtn;\r\n                 indexTemp++;\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624508490673,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,351 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = keyBtn;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624508504394,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,363 +115,13 @@\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == keyGroup) {\r\n                 let keyBtn = this._view.getChildAt(i).asButton;\r\n                 this._textMap[this._kuangNameArr[indexTemp]] = keyBtn;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n                 indexTemp++;\r\n             }\r\n         }\r\n \r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = keyBtn;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n"
                },
                {
                    "date": 1624508521821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -114,11 +114,9 @@\n         let keyGroup = this._view.getChild(\"key\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == keyGroup) {\r\n                 let keyBtn = this._view.getChildAt(i).asButton;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = keyBtn;\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-                indexTemp++;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n"
                },
                {
                    "date": 1624508548972,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,8 +167,16 @@\n         state.selectKuangName = btn.name;\r\n         this.updateState(state);\r\n     }\r\n \r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n"
                },
                {
                    "date": 1624508555997,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -159,9 +159,9 @@\n             }\r\n         }\r\n     }\r\n \r\n-    private _clickKuang(evt: any) {\r\n+    private _clickKey(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.selectKuangName = btn.name;\r\n"
                },
                {
                    "date": 1624508621003,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -114,9 +114,9 @@\n         let keyGroup = this._view.getChild(\"key\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == keyGroup) {\r\n                 let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n             }\r\n         }\r\n \r\n         // 初始化state\r\n"
                },
                {
                    "date": 1624508649973,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -123,8 +123,9 @@\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n             selectKuangName: '',\r\n+            keyNumber: '',\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n"
                },
                {
                    "date": 1624508664341,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,359 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624508674520,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,359 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624508680843,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -163,8 +163,9 @@\n \r\n     private _clickKey(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.keyNumber = btn.name;\r\n         this.updateState(state);\r\n     }\r\n@@ -356,722 +357,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624508973297,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -163,9 +163,9 @@\n \r\n     private _clickKey(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-\r\n+        let subName = btn.name.substring('input'.length);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.keyNumber = btn.name;\r\n         this.updateState(state);\r\n     }\r\n"
                },
                {
                    "date": 1624508984485,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -164,8 +164,9 @@\n     private _clickKey(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n+        console.log('==== ==');\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.keyNumber = btn.name;\r\n         this.updateState(state);\r\n     }\r\n"
                },
                {
                    "date": 1624508990476,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -164,9 +164,9 @@\n     private _clickKey(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n-        console.log('==== ==');\r\n+        console.log('==== subName ==' + );\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.keyNumber = btn.name;\r\n         this.updateState(state);\r\n     }\r\n"
                },
                {
                    "date": 1624508997698,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -164,9 +164,9 @@\n     private _clickKey(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + );\r\n+        console.log('==== subName ==' + subName);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.keyNumber = btn.name;\r\n         this.updateState(state);\r\n     }\r\n"
                },
                {
                    "date": 1624509027001,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,361 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624509032519,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -358,365 +358,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624509046301,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -166,9 +166,9 @@\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n         console.log('==== subName ==' + subName);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = btn.name;\r\n+        state.keyNumber = subName;\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickKuang(evt: any) {\r\n"
                },
                {
                    "date": 1624509079777,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -166,9 +166,9 @@\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n         console.log('==== subName ==' + subName);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n+        state.keyNumber += subName;\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickKuang(evt: any) {\r\n"
                },
                {
                    "date": 1624509132742,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,361 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber += subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624509139192,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -358,365 +358,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber += subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624509277020,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -166,9 +166,9 @@\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n         console.log('==== subName ==' + subName);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber += subName;\r\n+        state.keyNumber = subName;\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickKuang(evt: any) {\r\n"
                },
                {
                    "date": 1624509824498,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -235,9 +235,23 @@\n \r\n                 this._selectMap[oldState.selectKuangName].visible = false;\r\n             }\r\n         }\r\n+        keyNumber\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n         if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n             this.playTitle(state.title);\r\n         }\r\n     }\r\n"
                },
                {
                    "date": 1624509830240,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -222,9 +222,9 @@\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n             }\r\n         }\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n \r\n             if (state.selectKuangName != '') {\r\n \r\n@@ -235,9 +235,9 @@\n \r\n                 this._selectMap[oldState.selectKuangName].visible = false;\r\n             }\r\n         }\r\n-        keyNumber\r\n+\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n \r\n             if (state.selectKuangName != '') {\r\n"
                },
                {
                    "date": 1624509835579,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,375 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624509840695,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -229,13 +229,8 @@\n             if (state.keyNumber != '') {\r\n \r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n@@ -372,379 +367,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624509878372,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -227,8 +227,11 @@\n \r\n \r\n             if (state.keyNumber != '') {\r\n \r\n+                if (oldState.selectKuangName) {\r\n+\r\n+                }\r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624509887871,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -227,9 +227,9 @@\n \r\n \r\n             if (state.keyNumber != '') {\r\n \r\n-                if (oldState.selectKuangName) {\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                 }\r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n"
                },
                {
                    "date": 1624509892987,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -229,8 +229,10 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n+                } else {\r\n+\r\n                 }\r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624509915599,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -229,8 +229,9 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n+                    this._textMap[] = \r\n                 } else {\r\n \r\n                 }\r\n                 this._selectMap[state.selectKuangName].visible = true;\r\n"
                },
                {
                    "date": 1624509921056,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,376 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    this._textMap[state.selectKuangName] = \r\n+                } else {\r\n+\r\n+                }\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624510052223,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -373,380 +373,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    this._textMap[] = \r\n-                } else {\r\n-\r\n-                }\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624510063509,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -231,11 +231,11 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     this._textMap[state.selectKuangName] = \r\n                 } else {\r\n+                    this._textMap[state.selectKuangName] = \r\n+                }\r\n \r\n-                }\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n"
                },
                {
                    "date": 1624510087569,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -231,9 +231,9 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     this._textMap[state.selectKuangName] = \r\n                 } else {\r\n-                    this._textMap[state.selectKuangName] = \r\n+                    this._textMap[state.selectKuangName].text = \r\n                 }\r\n \r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624510125968,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -229,11 +229,11 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n-                    this._textMap[state.selectKuangName] = \r\n+                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n                 } else {\r\n-                    this._textMap[state.selectKuangName].text = \r\n+                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n                 }\r\n \r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624510264051,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,376 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n+                } else {\r\n+                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+                }\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624510318978,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,376 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n+                } else {\r\n+                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+                }\r\n+\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624510421561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -175,8 +175,9 @@\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.selectKuangName = btn.name;\r\n+        console.log('== ====');\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickSubmit(evt: any) {\r\n@@ -373,756 +374,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n-                } else {\r\n-                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n-                }\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n-                } else {\r\n-                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n-                }\r\n-\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624510428426,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -175,9 +175,8 @@\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.selectKuangName = btn.name;\r\n-        console.log('== ====');\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickSubmit(evt: any) {\r\n"
                },
                {
                    "date": 1624510458665,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -118,8 +118,10 @@\n                 keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n             }\r\n         }\r\n \r\n+        this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n@@ -233,9 +235,8 @@\n                     this._textMap[state.selectKuangName] = state.keyNumber;\r\n                 } else {\r\n                     this._textMap[state.selectKuangName].text += state.keyNumber;\r\n                 }\r\n-\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n"
                },
                {
                    "date": 1624510472437,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -118,9 +118,9 @@\n                 keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n             }\r\n         }\r\n \r\n-        this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+        this._textMap['kuang2'].text = '';\r\n \r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n"
                },
                {
                    "date": 1624510479222,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -118,9 +118,9 @@\n                 keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n             }\r\n         }\r\n \r\n-        this._textMap['kuang2'].text = '';\r\n+        this._textMap['kuang2'].text = 'pppp';\r\n \r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n"
                },
                {
                    "date": 1624510934533,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -118,10 +118,8 @@\n                 keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n             }\r\n         }\r\n \r\n-        this._textMap['kuang2'].text = 'pppp';\r\n-\r\n         // 初始化state\r\n         this._state = {\r\n             title: false,\r\n             submit: this.submitType.No,\r\n"
                },
                {
                    "date": 1624511220799,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -224,8 +224,9 @@\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n+            console.log('==== ====');\r\n \r\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n"
                },
                {
                    "date": 1624511225948,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -224,9 +224,9 @@\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n-            console.log('==== ====');\r\n+            console.log('==== ====' + );\r\n \r\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n"
                },
                {
                    "date": 1624511305475,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -224,9 +224,10 @@\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n-            console.log('==== ====' + );\r\n+            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n+            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n \r\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n"
                },
                {
                    "date": 1624511312989,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -225,9 +225,9 @@\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n             console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n-            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n+            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n \r\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n"
                },
                {
                    "date": 1624511501963,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -235,8 +235,12 @@\n                     this._textMap[state.selectKuangName] = state.keyNumber;\r\n                 } else {\r\n                     this._textMap[state.selectKuangName].text += state.keyNumber;\r\n                 }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                }, 0.01);\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n"
                },
                {
                    "date": 1624511507066,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -238,9 +238,10 @@\n                 }\r\n \r\n                 setTimeout(() => {\r\n \r\n-                }, 0.01);\r\n+\r\n+                }, 0.02);\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n"
                },
                {
                    "date": 1624511519108,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -238,8 +238,11 @@\n                 }\r\n \r\n                 setTimeout(() => {\r\n \r\n+                    let state: any = globalThis._.cloneDeep(this._state);\r\n+                    state.title = false;\r\n+                    this.updateState(state);\r\n \r\n                 }, 0.02);\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624511526468,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -238,11 +238,11 @@\n                 }\r\n \r\n                 setTimeout(() => {\r\n \r\n-                    let state: any = globalThis._.cloneDeep(this._state);\r\n-                    state.title = false;\r\n-                    this.updateState(state);\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.title = false;\r\n+                    this.updateState(state2);\r\n \r\n                 }, 0.02);\r\n             }\r\n         }\r\n"
                },
                {
                    "date": 1624511532986,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,385 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n+            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n+                } else {\r\n+                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 0.02);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624511540933,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -382,389 +382,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n-            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n-                } else {\r\n-                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.title = false;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 0.02);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624511613035,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,385 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n+            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n+                } else {\r\n+                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 0.02);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624511626941,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -174,393 +174,11 @@\n     private _clickKuang(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n+        if () {\r\n \r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n         }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n-            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n-                } else {\r\n-                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 0.02);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n         state.selectKuangName = btn.name;\r\n         this.updateState(state);\r\n     }\r\n \r\n"
                },
                {
                    "date": 1624511633198,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -174,9 +174,9 @@\n     private _clickKuang(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n-        if () {\r\n+        if (state.selectKuangName === ) {\r\n \r\n         }\r\n         state.selectKuangName = btn.name;\r\n         this.updateState(state);\r\n"
                },
                {
                    "date": 1624511638413,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -174,9 +174,9 @@\n     private _clickKuang(evt: any) {\r\n \r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === ) {\r\n+        if (state.selectKuangName === btn.name) {\r\n \r\n         }\r\n         state.selectKuangName = btn.name;\r\n         this.updateState(state);\r\n"
                },
                {
                    "date": 1624511650354,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,388 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        }\r\n+        state.selectKuangName = btn.name;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n+            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n+                } else {\r\n+                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 0.02);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624511658533,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -176,401 +176,15 @@\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         if (state.selectKuangName === btn.name) {\r\n             state.selectKuangName = '';\r\n-        }\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n-            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n-                } else {\r\n-                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 0.02);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n         } else {\r\n-            this.disableForbidHandle();\r\n+            state.selectKuangName = btn.name;\r\n         }\r\n-    }\r\n \r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n         this.updateState(state);\r\n     }\r\n \r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-\r\n-        }\r\n-        state.selectKuangName = btn.name;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n"
                },
                {
                    "date": 1624511664174,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -177,8 +177,9 @@\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         if (state.selectKuangName === btn.name) {\r\n             state.selectKuangName = '';\r\n         } else {\r\n+\r\n             state.selectKuangName = btn.name;\r\n         }\r\n \r\n         this.updateState(state);\r\n"
                },
                {
                    "date": 1624511695201,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,391 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n+            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n+                } else {\r\n+                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 0.02);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624511713473,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -388,395 +388,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n-            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n-                } else {\r\n-                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 0.02);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624514970707,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -230,11 +230,8 @@\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n-            console.log('==== oldState.selectKuangName ====' + oldState.selectKuangName);\r\n-            console.log('==== state.selectKuangName ====' + state.selectKuangName);\r\n-\r\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n"
                },
                {
                    "date": 1624515054461,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,8 +124,9 @@\n             title: false,\r\n             submit: this.submitType.No,\r\n             selectKuangName: '',\r\n             keyNumber: '',\r\n+            textMap:\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n"
                },
                {
                    "date": 1624515061536,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,9 +124,9 @@\n             title: false,\r\n             submit: this.submitType.No,\r\n             selectKuangName: '',\r\n             keyNumber: '',\r\n-            textMap:\r\n+            textMap: {}\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n"
                },
                {
                    "date": 1624515177896,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -79,8 +79,9 @@\n \r\n         this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n         if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n \r\n+        let tempAnswerMap = {};\r\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n"
                },
                {
                    "date": 1624515205790,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,8 +86,9 @@\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n                 console.log('=== name ===' + btn.name);\r\n                 this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[] = 0;\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624515212842,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n                 console.log('=== name ===' + btn.name);\r\n                 this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[] = 0;\r\n+                tempAnswerMap[btn.name] = 0;\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624515259463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -126,9 +126,9 @@\n             title: false,\r\n             submit: this.submitType.No,\r\n             selectKuangName: '',\r\n             keyNumber: '',\r\n-            textMap: {}\r\n+            textMap: tempAnswerMap;\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n"
                },
                {
                    "date": 1624515271639,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n                 console.log('=== name ===' + btn.name);\r\n                 this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = 0;\r\n+                tempAnswerMap[btn.name] = '';\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n         }\r\n \r\n@@ -126,9 +126,9 @@\n             title: false,\r\n             submit: this.submitType.No,\r\n             selectKuangName: '',\r\n             keyNumber: '',\r\n-            textMap: tempAnswerMap;\r\n+            textMap: tempAnswerMap,\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n"
                },
                {
                    "date": 1624515307698,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -252,8 +252,10 @@\n                 }, 0.02);\r\n             }\r\n         }\r\n \r\n+        tempAnswerMap\r\n+\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n \r\n             if (state.selectKuangName != '') {\r\n"
                },
                {
                    "date": 1624515352046,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -252,8 +252,11 @@\n                 }, 0.02);\r\n             }\r\n         }\r\n \r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n         tempAnswerMap\r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n"
                },
                {
                    "date": 1624515357357,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -252,13 +252,13 @@\n                 }, 0.02);\r\n             }\r\n         }\r\n \r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+        if (!globalThis._.isEqual(oldState.tempAnswerMap, state.tempAnswerMap)) {\r\n             this.playTitle(state.title);\r\n         }\r\n-        tempAnswerMap\r\n \r\n+\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n \r\n             if (state.selectKuangName != '') {\r\n"
                },
                {
                    "date": 1624515362521,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -253,9 +253,10 @@\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.tempAnswerMap, state.tempAnswerMap)) {\r\n-            this.playTitle(state.title);\r\n+\r\n+\r\n         }\r\n \r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n"
                },
                {
                    "date": 1624515369312,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -255,8 +255,9 @@\n \r\n         if (!globalThis._.isEqual(oldState.tempAnswerMap, state.tempAnswerMap)) {\r\n \r\n \r\n+\r\n         }\r\n \r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n"
                },
                {
                    "date": 1624515432325,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -126,9 +126,9 @@\n             title: false,\r\n             submit: this.submitType.No,\r\n             selectKuangName: '',\r\n             keyNumber: '',\r\n-            textMap: tempAnswerMap,\r\n+            answerMap: tempAnswerMap,\r\n         }\r\n     }\r\n \r\n     async init(data: any) {\r\n@@ -252,9 +252,9 @@\n                 }, 0.02);\r\n             }\r\n         }\r\n \r\n-        if (!globalThis._.isEqual(oldState.tempAnswerMap, state.tempAnswerMap)) {\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n \r\n \r\n         }\r\n"
                },
                {
                    "date": 1624515439329,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -255,9 +255,8 @@\n \r\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n \r\n-\r\n         }\r\n \r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n"
                },
                {
                    "date": 1624515448847,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -255,8 +255,9 @@\n \r\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n \r\n+\r\n         }\r\n \r\n \r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n"
                },
                {
                    "date": 1624515553441,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,11 +237,11 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n-                    this._textMap[state.selectKuangName] = state.keyNumber;\r\n+                    state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                 } else {\r\n-                    this._textMap[state.selectKuangName].text += state.keyNumber;\r\n+                    state.answerMap[state.selectKuangName] += state.keyNumber;\r\n                 }\r\n \r\n                 setTimeout(() => {\r\n \r\n"
                },
                {
                    "date": 1624515576067,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -246,8 +246,9 @@\n                 setTimeout(() => {\r\n \r\n                     let state2: any = globalThis._.cloneDeep(this._state);\r\n                     state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n                     this.updateState(state2);\r\n \r\n                 }, 0.02);\r\n             }\r\n"
                },
                {
                    "date": 1624515615413,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -255,9 +255,11 @@\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n+            for (let key int state.answerMap) {\r\n \r\n+            }\r\n \r\n         }\r\n \r\n \r\n"
                },
                {
                    "date": 1624515632945,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -255,10 +255,11 @@\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n-            for (let key int state.answerMap) {\r\n+            for (let key in state.answerMap) {\r\n \r\n+                this._textMap[] = \r\n             }\r\n \r\n         }\r\n \r\n"
                },
                {
                    "date": 1624515666103,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -257,9 +257,9 @@\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n             for (let key in state.answerMap) {\r\n \r\n-                this._textMap[] = \r\n+                this._textMap[state.answerMap[key]] =  \r\n             }\r\n \r\n         }\r\n \r\n"
                },
                {
                    "date": 1624515675794,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -257,9 +257,9 @@\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n             for (let key in state.answerMap) {\r\n \r\n-                this._textMap[state.answerMap[key]] =  \r\n+                this._textMap[state.answerMap[key]].text =  \r\n             }\r\n \r\n         }\r\n \r\n"
                },
                {
                    "date": 1624515688140,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -257,9 +257,9 @@\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n             for (let key in state.answerMap) {\r\n \r\n-                this._textMap[state.answerMap[key]].text =  \r\n+                this._textMap[].text = state.answerMap[key];\r\n             }\r\n \r\n         }\r\n \r\n"
                },
                {
                    "date": 1624515699903,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -257,9 +257,9 @@\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n             for (let key in state.answerMap) {\r\n \r\n-                this._textMap[].text = state.answerMap[key];\r\n+                this._textMap[key].text = state.answerMap[key];\r\n             }\r\n \r\n         }\r\n \r\n"
                },
                {
                    "date": 1624515715045,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,8 +237,11 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n+                    if () {\r\n+\r\n+                    }\r\n                     state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                 } else {\r\n                     state.answerMap[state.selectKuangName] += state.keyNumber;\r\n                 }\r\n"
                },
                {
                    "date": 1624515723184,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,9 +237,9 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n-                    if () {\r\n+                    if (state.keyNumber = ) {\r\n \r\n                     }\r\n                     state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                 } else {\r\n"
                },
                {
                    "date": 1624515733643,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,9 +237,9 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n-                    if (state.keyNumber = ) {\r\n+                    if (state.keyNumber === 'x') {\r\n \r\n                     }\r\n                     state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                 } else {\r\n"
                },
                {
                    "date": 1624515924503,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,10 +239,12 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x') {\r\n \r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n-                    state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+\r\n                 } else {\r\n                     state.answerMap[state.selectKuangName] += state.keyNumber;\r\n                 }\r\n \r\n"
                },
                {
                    "date": 1624515934910,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -244,8 +244,13 @@\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n                 } else {\r\n+                    if (state.keyNumber === 'x') {\r\n+\r\n+                    } else {\r\n+\r\n+                    }\r\n                     state.answerMap[state.selectKuangName] += state.keyNumber;\r\n                 }\r\n \r\n                 setTimeout(() => {\r\n"
                },
                {
                    "date": 1624515940941,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -244,14 +244,15 @@\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n                 } else {\r\n+\r\n                     if (state.keyNumber === 'x') {\r\n \r\n                     } else {\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n \r\n-                    }\r\n-                    state.answerMap[state.selectKuangName] += state.keyNumber;\r\n                 }\r\n \r\n                 setTimeout(() => {\r\n \r\n"
                },
                {
                    "date": 1624515947224,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,414 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x') {\r\n+\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x') {\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 0.02);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624515953236,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -411,417 +411,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x') {\r\n-\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x') {\r\n-\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 0.02);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624516679279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,414 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x') {\r\n+\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x') {\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 0.02);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624516714910,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -411,418 +411,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x') {\r\n-\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x') {\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 0.02);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624536806250,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,8 +239,9 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x') {\r\n \r\n+\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624536813553,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,9 +239,8 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x') {\r\n \r\n-\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624536872310,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,8 +239,9 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x') {\r\n \r\n+                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring();\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624536883895,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,9 +239,9 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x') {\r\n \r\n-                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring();\r\n+                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0,);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624536919741,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,9 +239,9 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x') {\r\n \r\n-                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0,);\r\n+                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624537061583,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,9 +237,9 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n-                    if (state.keyNumber === 'x') {\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length) {\r\n \r\n                         state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n"
                },
                {
                    "date": 1624537067165,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -237,9 +237,9 @@\n             if (state.keyNumber != '') {\r\n \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length) {\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n                         state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n"
                },
                {
                    "date": 1624537146463,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -246,10 +246,11 @@\n                     }\r\n \r\n                 } else {\r\n \r\n-                    if (state.keyNumber === 'x') {\r\n+                    if (state.keyNumber === 'x' && && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n+\r\n                     } else {\r\n \r\n                         state.answerMap[state.selectKuangName] += state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624537235959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -246,11 +246,11 @@\n                     }\r\n \r\n                 } else {\r\n \r\n-                    if (state.keyNumber === 'x' && && state.answerMap[state.selectKuangName].length !== 0) {\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n \r\n-\r\n                     } else {\r\n \r\n                         state.answerMap[state.selectKuangName] += state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624537244202,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -247,10 +247,11 @@\n \r\n                 } else {\r\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n \r\n+                        state.answerMap[state.selectKuangName] -= state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n+\r\n                     } else {\r\n \r\n                         state.answerMap[state.selectKuangName] += state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624537392374,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -264,9 +264,9 @@\n                     state2.keyNumber = '';\r\n                     state2.answerMap = state.answerMap;\r\n                     this.updateState(state2);\r\n \r\n-                }, 0.02);\r\n+                }, 10);\r\n             }\r\n         }\r\n \r\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n"
                },
                {
                    "date": 1624537530642,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -169,9 +169,9 @@\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n         console.log('==== subName ==' + subName);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName;\r\n+        state.keyNumber = subName + '';\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickKuang(evt: any) {\r\n"
                },
                {
                    "date": 1624537774725,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,8 +239,9 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n+                        console.log('=== ===');\r\n                         state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624537782038,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,9 +239,9 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n-                        console.log('=== ===');\r\n+                        console.log('=== ===' + state.answerMap[state.selectKuangName]);\r\n                         state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624537797689,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -239,9 +239,10 @@\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n-                        console.log('=== ===' + state.answerMap[state.selectKuangName]);\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName]\r\n                         state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624537806213,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -240,10 +240,11 @@\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n                         console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName]\r\n-                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+\r\n+                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, str.length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624537812002,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -242,9 +242,9 @@\n \r\n                         console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n                         let str = state.answerMap[state.selectKuangName];\r\n \r\n-                        state.answerMap[state.selectKuangName] = state.answerMap[state.selectKuangName].substring(0, str.length - 1);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624537820014,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,9 +241,9 @@\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n                         console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n                         let str = state.answerMap[state.selectKuangName];\r\n-\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n                         state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624537826957,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,9 +241,9 @@\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n                         console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n                         let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        console.log('=== 222 ===' + str);\r\n                         state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n                     } else {\r\n                         state.answerMap[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624537838613,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,420 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 222 ===' + str);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        state.answerMap[state.selectKuangName] -= state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624537843855,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,420 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 222 ===' + str);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        state.answerMap[state.selectKuangName] -= state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624537948867,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -251,428 +251,12 @@\n                 } else {\r\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n-                        state.answerMap[state.selectKuangName] -= state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n                         console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n                         let str = state.answerMap[state.selectKuangName];\r\n                         console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n \r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n                         state.answerMap[state.selectKuangName] -= state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n \r\n                     } else {\r\n \r\n@@ -837,424 +421,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        state.answerMap[state.selectKuangName] -= state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624537965460,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -251,13 +251,13 @@\n                 } else {\r\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n                         let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 222 ===' + str);\r\n+                        console.log('=== 444 ===' + str);\r\n \r\n-                        state.answerMap[state.selectKuangName] -= state.answerMap[state.selectKuangName].substring(0, state.answerMap[state.selectKuangName].length - 1);\r\n+                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n \r\n                     } else {\r\n \r\n                         state.answerMap[state.selectKuangName] += state.keyNumber;\r\n"
                },
                {
                    "date": 1624538057182,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,424 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 222 ===' + str);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n+\r\n+                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624538062304,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -421,428 +421,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 444 ===' + str);\r\n-\r\n-                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624538166637,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -279,8 +279,9 @@\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n             for (let key in state.answerMap) {\r\n \r\n+                console.log('=== ==' + );\r\n                 this._textMap[key].text = state.answerMap[key];\r\n             }\r\n \r\n         }\r\n"
                },
                {
                    "date": 1624538173483,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -279,9 +279,10 @@\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n             for (let key in state.answerMap) {\r\n \r\n-                console.log('=== ==' + );\r\n+                console.log('=== ==' + key);\r\n+\r\n                 this._textMap[key].text = state.answerMap[key];\r\n             }\r\n \r\n         }\r\n"
                },
                {
                    "date": 1624538187000,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,426 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 222 ===' + str);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n+\r\n+                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                console.log('=== key ==' + key);\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624538198319,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,426 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 222 ===' + str);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n+\r\n+                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                console.log('=== key ==' + key + '' + );\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624538203469,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,426 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 222 ===' + str);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n+\r\n+                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                console.log('=== key ==' + key + '' + state.answerMap[key]);\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624538210131,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -279,9 +279,9 @@\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n             for (let key in state.answerMap) {\r\n \r\n-                console.log('=== key ==' + key + '' + state.answerMap[key]);\r\n+                console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n \r\n                 this._textMap[key].text = state.answerMap[key];\r\n             }\r\n \r\n@@ -423,1282 +423,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n-\r\n-                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                console.log('=== key ==' + key + '' + );\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n-\r\n-                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                console.log('=== key ==' + key);\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n-\r\n-                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                console.log('=== ==' + key);\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624538267850,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,426 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 222 ===' + str);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n+\r\n+                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624538291591,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -266,434 +266,15 @@\n                 }\r\n \r\n                 setTimeout(() => {\r\n \r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n+                    for (let key in state.answerMap) {\r\n \r\n-                }, 10);\r\n-            }\r\n-        }\r\n+                        console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n \r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                        this._textMap[key].text = state.answerMap[key];\r\n                     }\r\n \r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n-\r\n-                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n                     let state2: any = globalThis._.cloneDeep(this._state);\r\n                     state2.keyNumber = '';\r\n                     state2.answerMap = state.answerMap;\r\n                     this.updateState(state2);\r\n"
                },
                {
                    "date": 1624538304437,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,433 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                if (oldState.selectKuangName != state.selectKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 222 ===' + str);\r\n+                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                    } else {\r\n+                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+\r\n+                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n+                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n+\r\n+                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n+\r\n+                    } else {\r\n+\r\n+                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    for (let key in state.answerMap) {\r\n+\r\n+                        console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n+\r\n+                        this._textMap[key].text = state.answerMap[key];\r\n+                    }\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = state.answerMap;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624538312399,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -268,9 +268,9 @@\n                 setTimeout(() => {\r\n \r\n                     for (let key in state.answerMap) {\r\n \r\n-                        console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n+                        console.log('=== key111 ==' + key + '== v11 ==' + state.answerMap[key]);\r\n \r\n                         this._textMap[key].text = state.answerMap[key];\r\n                     }\r\n \r\n@@ -430,437 +430,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n-                    } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n-\r\n-                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n-                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n-\r\n-                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n-\r\n-                    } else {\r\n-\r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    for (let key in state.answerMap) {\r\n-\r\n-                        console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n-\r\n-                        this._textMap[key].text = state.answerMap[key];\r\n-                    }\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624538318357,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -270,9 +270,8 @@\n                     for (let key in state.answerMap) {\r\n \r\n                         console.log('=== key111 ==' + key + '== v11 ==' + state.answerMap[key]);\r\n \r\n-                        this._textMap[key].text = state.answerMap[key];\r\n                     }\r\n \r\n                     let state2: any = globalThis._.cloneDeep(this._state);\r\n                     state2.keyNumber = '';\r\n"
                },
                {
                    "date": 1624538416333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -235,8 +235,9 @@\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n             if (state.keyNumber != '') {\r\n \r\n+                let answerMapTemp = \r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n"
                },
                {
                    "date": 1624538422310,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -235,9 +235,9 @@\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n             if (state.keyNumber != '') {\r\n \r\n-                let answerMapTemp = \r\n+                let answerMapTemp = state.answerMap;\r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n \r\n"
                },
                {
                    "date": 1624538451047,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -238,31 +238,31 @@\n \r\n                 let answerMapTemp = state.answerMap;\r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[state.selectKuangName].length !== 0) {\r\n \r\n-                        console.log('=== 1111 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 1111 ===' + answerMapTemp[state.selectKuangName]);\r\n+                        let str = answerMapTemp[state.selectKuangName];\r\n                         console.log('=== 222 ===' + str);\r\n-                        state.answerMap[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[state.selectKuangName] = str.substring(0, str.length - 1);\r\n                     } else {\r\n-                        state.answerMap[state.selectKuangName] = state.keyNumber;\r\n+                        answerMapTemp[state.selectKuangName] = state.keyNumber;\r\n                     }\r\n \r\n                 } else {\r\n \r\n-                    if (state.keyNumber === 'x' && state.answerMap[state.selectKuangName].length !== 0) {\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[state.selectKuangName].length !== 0) {\r\n \r\n-                        console.log('=== 333 ===' + state.answerMap[state.selectKuangName]);\r\n-                        let str = state.answerMap[state.selectKuangName];\r\n+                        console.log('=== 333 ===' + answerMapTemp[state.selectKuangName]);\r\n+                        let str = answerMapTemp[state.selectKuangName];\r\n                         console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n \r\n-                        state.answerMap[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n+                        answerMapTemp[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n \r\n                     } else {\r\n \r\n-                        state.answerMap[state.selectKuangName] += state.keyNumber;\r\n+                        answerMapTemp[state.selectKuangName] += state.keyNumber;\r\n                     }\r\n \r\n                 }\r\n \r\n"
                },
                {
                    "date": 1624538461702,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -267,17 +267,17 @@\n                 }\r\n \r\n                 setTimeout(() => {\r\n \r\n-                    for (let key in state.answerMap) {\r\n+                    for (let key in answerMapTemp) {\r\n \r\n-                        console.log('=== key111 ==' + key + '== v11 ==' + state.answerMap[key]);\r\n+                        console.log('=== key111 ==' + key + '== v11 ==' + answerMapTemp[key]);\r\n \r\n                     }\r\n \r\n                     let state2: any = globalThis._.cloneDeep(this._state);\r\n                     state2.keyNumber = '';\r\n-                    state2.answerMap = state.answerMap;\r\n+                    state2.answerMap = answerMapTemp;\r\n                     this.updateState(state2);\r\n \r\n                 }, 10);\r\n             }\r\n"
                },
                {
                    "date": 1624538520401,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -236,8 +236,10 @@\n \r\n             if (state.keyNumber != '') {\r\n \r\n                 let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n                 if (oldState.selectKuangName != state.selectKuangName) {\r\n \r\n                     if (state.keyNumber === 'x' && answerMapTemp[state.selectKuangName].length !== 0) {\r\n \r\n"
                },
                {
                    "date": 1624538570466,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -238,33 +238,33 @@\n \r\n                 let answerMapTemp = state.answerMap;\r\n                 let curKuangName = state.selectKuangName;\r\n                 let oldKuangName = oldState.selectKuangName;\r\n-                if (oldState.selectKuangName != state.selectKuangName) {\r\n+                if (oldKuangName != curKuangName) {\r\n \r\n-                    if (state.keyNumber === 'x' && answerMapTemp[state.selectKuangName].length !== 0) {\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n \r\n-                        console.log('=== 1111 ===' + answerMapTemp[state.selectKuangName]);\r\n-                        let str = answerMapTemp[state.selectKuangName];\r\n+                        console.log('=== 1111 ===' + answerMapTemp[curKuangName]);\r\n+                        let str = answerMapTemp[curKuangName];\r\n                         console.log('=== 222 ===' + str);\r\n-                        answerMapTemp[state.selectKuangName] = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = str.substring(0, str.length - 1);\r\n                     } else {\r\n-                        answerMapTemp[state.selectKuangName] = state.keyNumber;\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n                     }\r\n \r\n                 } else {\r\n \r\n-                    if (state.keyNumber === 'x' && answerMapTemp[state.selectKuangName].length !== 0) {\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n \r\n-                        console.log('=== 333 ===' + answerMapTemp[state.selectKuangName]);\r\n-                        let str = answerMapTemp[state.selectKuangName];\r\n+                        console.log('=== 333 ===' + answerMapTemp[curKuangName]);\r\n+                        let str = answerMapTemp[curKuangName];\r\n                         console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n \r\n-                        answerMapTemp[state.selectKuangName] -= str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] -= str.substring(0, str.length - 1);\r\n \r\n                     } else {\r\n \r\n-                        answerMapTemp[state.selectKuangName] += state.keyNumber;\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n                     }\r\n \r\n                 }\r\n \r\n"
                },
                {
                    "date": 1624538865521,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -244,10 +244,11 @@\n                     if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n \r\n                         console.log('=== 1111 ===' + answerMapTemp[curKuangName]);\r\n                         let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);;\r\n                         console.log('=== 222 ===' + str);\r\n-                        answerMapTemp[curKuangName] = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = \r\n                     } else {\r\n                         answerMapTemp[curKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624538870666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -244,11 +244,11 @@\n                     if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n \r\n                         console.log('=== 1111 ===' + answerMapTemp[curKuangName]);\r\n                         let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);;\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n                         console.log('=== 222 ===' + str);\r\n-                        answerMapTemp[curKuangName] = \r\n+                        answerMapTemp[curKuangName] = strJian\r\n                     } else {\r\n                         answerMapTemp[curKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624538879995,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -242,13 +242,12 @@\n                 if (oldKuangName != curKuangName) {\r\n \r\n                     if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n \r\n-                        console.log('=== 1111 ===' + answerMapTemp[curKuangName]);\r\n                         let str = answerMapTemp[curKuangName];\r\n                         let strJian = str.substring(0, str.length - 1);\r\n-                        console.log('=== 222 ===' + str);\r\n-                        answerMapTemp[curKuangName] = strJian\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n                     } else {\r\n                         answerMapTemp[curKuangName] = state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624538898323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -254,12 +254,10 @@\n                 } else {\r\n \r\n                     if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n \r\n-                        console.log('=== 333 ===' + answerMapTemp[curKuangName]);\r\n                         let str = answerMapTemp[curKuangName];\r\n-                        console.log('=== 444 ===' + str.substring(0, str.length - 1));\r\n-\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n                         answerMapTemp[curKuangName] -= str.substring(0, str.length - 1);\r\n \r\n                     } else {\r\n \r\n"
                },
                {
                    "date": 1624538919514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -256,10 +256,11 @@\n                     if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n \r\n                         let str = answerMapTemp[curKuangName];\r\n                         let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] -= str.substring(0, str.length - 1);\r\n \r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n                     } else {\r\n \r\n                         answerMapTemp[curKuangName] += state.keyNumber;\r\n                     }\r\n"
                },
                {
                    "date": 1624538941082,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -268,14 +268,8 @@\n                 }\r\n \r\n                 setTimeout(() => {\r\n \r\n-                    for (let key in answerMapTemp) {\r\n-\r\n-                        console.log('=== key111 ==' + key + '== v11 ==' + answerMapTemp[key]);\r\n-\r\n-                    }\r\n-\r\n                     let state2: any = globalThis._.cloneDeep(this._state);\r\n                     state2.keyNumber = '';\r\n                     state2.answerMap = answerMapTemp;\r\n                     this.updateState(state2);\r\n"
                },
                {
                    "date": 1624538947132,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -281,10 +281,8 @@\n         if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n \r\n             for (let key in state.answerMap) {\r\n \r\n-                console.log('=== key ==' + key + '== v ==' + state.answerMap[key]);\r\n-\r\n                 this._textMap[key].text = state.answerMap[key];\r\n             }\r\n \r\n         }\r\n"
                },
                {
                    "date": 1624539007728,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -259,9 +259,9 @@\n                         let strJian = str.substring(0, str.length - 1);\r\n \r\n                         answerMapTemp[curKuangName] = strJian;\r\n \r\n-                    } else {\r\n+                    } else if (state.keyNumber === 'x') {\r\n \r\n                         answerMapTemp[curKuangName] += state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624539014821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -259,9 +259,9 @@\n                         let strJian = str.substring(0, str.length - 1);\r\n \r\n                         answerMapTemp[curKuangName] = strJian;\r\n \r\n-                    } else if (state.keyNumber === 'x') {\r\n+                    } else if (state.keyNumber !== 'x') {\r\n \r\n                         answerMapTemp[curKuangName] += state.keyNumber;\r\n                     }\r\n \r\n"
                },
                {
                    "date": 1624539022398,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -246,9 +246,9 @@\n                         let str = answerMapTemp[curKuangName];\r\n                         let strJian = str.substring(0, str.length - 1);\r\n                         answerMapTemp[curKuangName] = strJian;\r\n \r\n-                    } else {\r\n+                    } if (state.keyNumber !== 'x') {\r\n                         answerMapTemp[curKuangName] = state.keyNumber;\r\n                     }\r\n \r\n                 } else {\r\n"
                },
                {
                    "date": 1624539030008,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,426 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n+                if (oldKuangName != curKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } if (state.keyNumber !== 'x') {\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } else if (state.keyNumber !== 'x') {\r\n+\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = answerMapTemp;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+\r\n+        }\r\n+\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624539339511,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -423,430 +423,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                let answerMapTemp = state.answerMap;\r\n-                let curKuangName = state.selectKuangName;\r\n-                let oldKuangName = oldState.selectKuangName;\r\n-                if (oldKuangName != curKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } if (state.keyNumber !== 'x') {\r\n-                        answerMapTemp[curKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } else if (state.keyNumber !== 'x') {\r\n-\r\n-                        answerMapTemp[curKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = answerMapTemp;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-\r\n-        }\r\n-\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624539388686,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -283,12 +283,10 @@\n             for (let key in state.answerMap) {\r\n \r\n                 this._textMap[key].text = state.answerMap[key];\r\n             }\r\n-\r\n         }\r\n \r\n-\r\n         if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n \r\n \r\n             if (state.selectKuangName != '') {\r\n"
                },
                {
                    "date": 1624539574670,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -165,8 +165,11 @@\n     }\r\n \r\n     private _clickKey(evt: any) {\r\n \r\n+        if () {\r\n+            this.handTips2();\r\n+        }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n         console.log('==== subName ==' + subName);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n"
                },
                {
                    "date": 1624539697069,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -165,8 +165,13 @@\n     }\r\n \r\n     private _clickKey(evt: any) {\r\n \r\n+        for (let key in this._selectMap) {\r\n+\r\n+\r\n+        }\r\n+        _selectMap\r\n         if () {\r\n             this.handTips2();\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n"
                },
                {
                    "date": 1624539751597,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,8 +168,10 @@\n \r\n         for (let key in this._selectMap) {\r\n \r\n \r\n+\r\n+\r\n         }\r\n         _selectMap\r\n         if () {\r\n             this.handTips2();\r\n"
                },
                {
                    "date": 1624539757552,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,13 +167,13 @@\n     private _clickKey(evt: any) {\r\n \r\n         for (let key in this._selectMap) {\r\n \r\n+            this._selectMap\r\n \r\n \r\n+        }\r\n \r\n-        }\r\n-        _selectMap\r\n         if () {\r\n             this.handTips2();\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n"
                },
                {
                    "date": 1624539792008,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,434 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        let isHideAll = false;\r\n+        for (let key in this._selectMap) {\r\n+\r\n+            this._selectMap[key].visible\r\n+\r\n+        }\r\n+\r\n+        if () {\r\n+            this.handTips2();\r\n+        }\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n+                if (oldKuangName != curKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } if (state.keyNumber !== 'x') {\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } else if (state.keyNumber !== 'x') {\r\n+\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = answerMapTemp;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624539815962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,446 +168,15 @@\n \r\n         let isHideAll = false;\r\n         for (let key in this._selectMap) {\r\n \r\n-            this._selectMap[key].visible\r\n+            if (this._selectMap[key].visible) {\r\n \r\n-        }\r\n-\r\n-        if () {\r\n-            this.handTips2();\r\n-        }\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n             }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n-            if (state.keyNumber != '') {\r\n \r\n-                let answerMapTemp = state.answerMap;\r\n-                let curKuangName = state.selectKuangName;\r\n-                let oldKuangName = oldState.selectKuangName;\r\n-                if (oldKuangName != curKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } if (state.keyNumber !== 'x') {\r\n-                        answerMapTemp[curKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } else if (state.keyNumber !== 'x') {\r\n-\r\n-                        answerMapTemp[curKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = answerMapTemp;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n         }\r\n \r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        for (let key in this._selectMap) {\r\n-\r\n-            this._selectMap\r\n-\r\n-\r\n-        }\r\n-\r\n         if () {\r\n             this.handTips2();\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n"
                },
                {
                    "date": 1624539822859,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -170,11 +170,10 @@\n         for (let key in this._selectMap) {\r\n \r\n             if (this._selectMap[key].visible) {\r\n \r\n+\r\n             }\r\n-\r\n-\r\n         }\r\n \r\n         if () {\r\n             this.handTips2();\r\n"
                },
                {
                    "date": 1624539843723,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -165,14 +165,14 @@\n     }\r\n \r\n     private _clickKey(evt: any) {\r\n \r\n-        let isHideAll = false;\r\n+        let isHideAll = true;\r\n         for (let key in this._selectMap) {\r\n \r\n             if (this._selectMap[key].visible) {\r\n+                isHideAll = false;\r\n \r\n-\r\n             }\r\n         }\r\n \r\n         if () {\r\n"
                },
                {
                    "date": 1624539849916,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -170,9 +170,8 @@\n         for (let key in this._selectMap) {\r\n \r\n             if (this._selectMap[key].visible) {\r\n                 isHideAll = false;\r\n-\r\n             }\r\n         }\r\n \r\n         if () {\r\n"
                },
                {
                    "date": 1624539855170,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,435 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        let isHideAll = true;\r\n+        for (let key in this._selectMap) {\r\n+\r\n+            if (this._selectMap[key].visible) {\r\n+                isHideAll = false;\r\n+            }\r\n+        }\r\n+\r\n+        if () {\r\n+            this.handTips2();\r\n+        }\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n+                if (oldKuangName != curKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } if (state.keyNumber !== 'x') {\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } else if (state.keyNumber !== 'x') {\r\n+\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = answerMapTemp;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624539860318,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -432,439 +432,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        let isHideAll = true;\r\n-        for (let key in this._selectMap) {\r\n-\r\n-            if (this._selectMap[key].visible) {\r\n-                isHideAll = false;\r\n-            }\r\n-        }\r\n-\r\n-        if () {\r\n-            this.handTips2();\r\n-        }\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                let answerMapTemp = state.answerMap;\r\n-                let curKuangName = state.selectKuangName;\r\n-                let oldKuangName = oldState.selectKuangName;\r\n-                if (oldKuangName != curKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } if (state.keyNumber !== 'x') {\r\n-                        answerMapTemp[curKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } else if (state.keyNumber !== 'x') {\r\n-\r\n-                        answerMapTemp[curKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = answerMapTemp;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624539865755,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,435 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        let isHideAll = true;\r\n+        for (let key in this._selectMap) {\r\n+\r\n+            if (this._selectMap[key].visible) {\r\n+                isHideAll = false;\r\n+            }\r\n+        }\r\n+\r\n+        if () {\r\n+            this.handTips2();\r\n+        }\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n+                if (oldKuangName != curKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } if (state.keyNumber !== 'x') {\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } else if (state.keyNumber !== 'x') {\r\n+\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = answerMapTemp;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624539870991,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -170,8 +170,9 @@\n         for (let key in this._selectMap) {\r\n \r\n             if (this._selectMap[key].visible) {\r\n                 isHideAll = false;\r\n+                break\r\n             }\r\n         }\r\n \r\n         if () {\r\n@@ -432,439 +433,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        let isHideAll = true;\r\n-        for (let key in this._selectMap) {\r\n-\r\n-            if (this._selectMap[key].visible) {\r\n-                isHideAll = false;\r\n-            }\r\n-        }\r\n-\r\n-        if () {\r\n-            this.handTips2();\r\n-        }\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                let answerMapTemp = state.answerMap;\r\n-                let curKuangName = state.selectKuangName;\r\n-                let oldKuangName = oldState.selectKuangName;\r\n-                if (oldKuangName != curKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } if (state.keyNumber !== 'x') {\r\n-                        answerMapTemp[curKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } else if (state.keyNumber !== 'x') {\r\n-\r\n-                        answerMapTemp[curKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = answerMapTemp;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624539879479,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -170,13 +170,13 @@\n         for (let key in this._selectMap) {\r\n \r\n             if (this._selectMap[key].visible) {\r\n                 isHideAll = false;\r\n-                break\r\n+                break;\r\n             }\r\n         }\r\n \r\n-        if () {\r\n+        if (isHideAll) {\r\n             this.handTips2();\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n"
                },
                {
                    "date": 1624539884933,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,437 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        let isHideAll = true;\r\n+        for (let key in this._selectMap) {\r\n+\r\n+            if (this._selectMap[key].visible) {\r\n+                isHideAll = false;\r\n+                break;\r\n+            }\r\n+        }\r\n+\r\n+        if (isHideAll) {\r\n+            this.handTips2();\r\n+            break;\r\n+        }\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n+                if (oldKuangName != curKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } if (state.keyNumber !== 'x') {\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } else if (state.keyNumber !== 'x') {\r\n+\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = answerMapTemp;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624539893176,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,437 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        let isHideAll = true;\r\n+        for (let key in this._selectMap) {\r\n+\r\n+            if (this._selectMap[key].visible) {\r\n+                isHideAll = false;\r\n+                break;\r\n+            }\r\n+        }\r\n+\r\n+        if (isHideAll) {\r\n+            this.handTips2();\r\n+            return;\r\n+        }\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n+                if (oldKuangName != curKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } if (state.keyNumber !== 'x') {\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } else if (state.keyNumber !== 'x') {\r\n+\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = answerMapTemp;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624539931526,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -175,9 +175,9 @@\n             }\r\n         }\r\n \r\n         if (isHideAll) {\r\n-            this.handTips2();\r\n+            this.handTips2(this._selectMap[key]);\r\n             return;\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n@@ -434,877 +434,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        let isHideAll = true;\r\n-        for (let key in this._selectMap) {\r\n-\r\n-            if (this._selectMap[key].visible) {\r\n-                isHideAll = false;\r\n-                break;\r\n-            }\r\n-        }\r\n-\r\n-        if (isHideAll) {\r\n-            this.handTips2();\r\n-            break;\r\n-        }\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                let answerMapTemp = state.answerMap;\r\n-                let curKuangName = state.selectKuangName;\r\n-                let oldKuangName = oldState.selectKuangName;\r\n-                if (oldKuangName != curKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } if (state.keyNumber !== 'x') {\r\n-                        answerMapTemp[curKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } else if (state.keyNumber !== 'x') {\r\n-\r\n-                        answerMapTemp[curKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = answerMapTemp;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        let isHideAll = true;\r\n-        for (let key in this._selectMap) {\r\n-\r\n-            if (this._selectMap[key].visible) {\r\n-                isHideAll = false;\r\n-                break;\r\n-            }\r\n-        }\r\n-\r\n-        if (isHideAll) {\r\n-            this.handTips2();\r\n-        }\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                let answerMapTemp = state.answerMap;\r\n-                let curKuangName = state.selectKuangName;\r\n-                let oldKuangName = oldState.selectKuangName;\r\n-                if (oldKuangName != curKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } if (state.keyNumber !== 'x') {\r\n-                        answerMapTemp[curKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } else if (state.keyNumber !== 'x') {\r\n-\r\n-                        answerMapTemp[curKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = answerMapTemp;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624539945180,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -175,9 +175,9 @@\n             }\r\n         }\r\n \r\n         if (isHideAll) {\r\n-            this.handTips2(this._selectMap[key]);\r\n+            this.handTips2(this._selectMap['kuang1']);\r\n             return;\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n"
                },
                {
                    "date": 1624540018907,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -175,9 +175,9 @@\n             }\r\n         }\r\n \r\n         if (isHideAll) {\r\n-            this.handTips2(this._selectMap['kuang1']);\r\n+            this.handTips2(this._selectMap[this._kuangNameArr[indexTemp]]);\r\n             return;\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n"
                },
                {
                    "date": 1624540024652,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -175,9 +175,9 @@\n             }\r\n         }\r\n \r\n         if (isHideAll) {\r\n-            this.handTips2(this._selectMap[this._kuangNameArr[indexTemp]]);\r\n+            this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n             return;\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n"
                },
                {
                    "date": 1624540149527,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,8 +168,9 @@\n \r\n         let isHideAll = true;\r\n         for (let key in this._selectMap) {\r\n \r\n+            console.log('=== ====' + );\r\n             if (this._selectMap[key].visible) {\r\n                 isHideAll = false;\r\n                 break;\r\n             }\r\n"
                },
                {
                    "date": 1624540158227,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,438 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                console.log('=== name ===' + btn.name);\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        let isHideAll = true;\r\n+        for (let key in this._selectMap) {\r\n+\r\n+            console.log('=== KKKK  ====' + );\r\n+            if (this._selectMap[key].visible) {\r\n+                isHideAll = false;\r\n+                break;\r\n+            }\r\n+        }\r\n+\r\n+        if (isHideAll) {\r\n+            this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n+            return;\r\n+        }\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        console.log('==== subName ==' + subName);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.submit = this.submitType.GuideShow;\r\n+        state.submit = this.submitType.WrongFeed;\r\n+        state.submit = this.submitType.RightFeed;\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n+                if (oldKuangName != curKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } if (state.keyNumber !== 'x') {\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } else if (state.keyNumber !== 'x') {\r\n+\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = answerMapTemp;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.tween(this).stop();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624540163729,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,9 +168,9 @@\n \r\n         let isHideAll = true;\r\n         for (let key in this._selectMap) {\r\n \r\n-            console.log('=== KKKK  ====' + );\r\n+            console.log('=== KKKK  ====' + key);\r\n             if (this._selectMap[key].visible) {\r\n                 isHideAll = false;\r\n                 break;\r\n             }\r\n@@ -435,442 +435,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        let isHideAll = true;\r\n-        for (let key in this._selectMap) {\r\n-\r\n-            console.log('=== ====' + );\r\n-            if (this._selectMap[key].visible) {\r\n-                isHideAll = false;\r\n-                break;\r\n-            }\r\n-        }\r\n-\r\n-        if (isHideAll) {\r\n-            this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n-            return;\r\n-        }\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.submit = this.submitType.GuideShow;\r\n-        state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                let answerMapTemp = state.answerMap;\r\n-                let curKuangName = state.selectKuangName;\r\n-                let oldKuangName = oldState.selectKuangName;\r\n-                if (oldKuangName != curKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } if (state.keyNumber !== 'x') {\r\n-                        answerMapTemp[curKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } else if (state.keyNumber !== 'x') {\r\n-\r\n-                        answerMapTemp[curKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = answerMapTemp;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-        cc.tween(this).stop();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                },
                {
                    "date": 1624540170376,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -169,8 +169,9 @@\n         let isHideAll = true;\r\n         for (let key in this._selectMap) {\r\n \r\n             console.log('=== KKKK  ====' + key);\r\n+\r\n             if (this._selectMap[key].visible) {\r\n                 isHideAll = false;\r\n                 break;\r\n             }\r\n"
                },
                {
                    "date": 1624540221654,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -176,8 +176,9 @@\n                 break;\r\n             }\r\n         }\r\n \r\n+        console.log('=== ==' + this._kuangNameArr[0]);\r\n         if (isHideAll) {\r\n             this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n             return;\r\n         }\r\n"
                },
                {
                    "date": 1624540226772,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -176,9 +176,9 @@\n                 break;\r\n             }\r\n         }\r\n \r\n-        console.log('=== ==' + this._kuangNameArr[0]);\r\n+        console.log('=== HHH ==' + this._kuangNameArr[0]);\r\n         if (isHideAll) {\r\n             this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n             return;\r\n         }\r\n"
                },
                {
                    "date": 1624540248471,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -176,9 +176,9 @@\n                 break;\r\n             }\r\n         }\r\n \r\n-        console.log('=== HHH ==' + this._kuangNameArr[0]);\r\n+        console.log('=== HHH ==' + this._selectMap[this._kuangNameArr[0]]);\r\n         if (isHideAll) {\r\n             this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n             return;\r\n         }\r\n"
                },
                {
                    "date": 1624540273400,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,24 +168,20 @@\n \r\n         let isHideAll = true;\r\n         for (let key in this._selectMap) {\r\n \r\n-            console.log('=== KKKK  ====' + key);\r\n-\r\n             if (this._selectMap[key].visible) {\r\n                 isHideAll = false;\r\n                 break;\r\n             }\r\n         }\r\n \r\n-        console.log('=== HHH ==' + this._selectMap[this._kuangNameArr[0]]);\r\n         if (isHideAll) {\r\n             this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n             return;\r\n         }\r\n         var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n         let subName = btn.name.substring('input'.length);\r\n-        console.log('==== subName ==' + subName);\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n         state.keyNumber = subName + '';\r\n         this.updateState(state);\r\n     }\r\n"
                },
                {
                    "date": 1624540760466,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,8 +31,10 @@\n     private _textMap: any = {};\r\n \r\n     private _kuangNameArr: any = [];\r\n \r\n+    private _rightAnswer: {};\r\n+\r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n         GuideShow: 1,\r\n"
                },
                {
                    "date": 1624540808868,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n     private _textMap: any = {};\r\n \r\n     private _kuangNameArr: any = [];\r\n \r\n-    private _rightAnswer: {};\r\n+    private _rightAnswer: { '': , '':, '':};\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n"
                },
                {
                    "date": 1624540871009,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n     private _textMap: any = {};\r\n \r\n     private _kuangNameArr: any = [];\r\n \r\n-    private _rightAnswer: { '': , '':, '':};\r\n+    private _rightAnswer: { 'kuang1': 2, 'kuang2': 1, 'kuang3': 2 };\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n"
                },
                {
                    "date": 1624540943309,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -203,8 +203,12 @@\n     }\r\n \r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n+\r\n+        for (let key in state.answerMap) {\r\n+\r\n+        }\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n \r\n"
                },
                {
                    "date": 1624540948526,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -206,8 +206,10 @@\n         let state: any = globalThis._.cloneDeep(this._state);\r\n \r\n         for (let key in state.answerMap) {\r\n \r\n+\r\n+\r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n"
                },
                {
                    "date": 1624540953959,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -207,9 +207,8 @@\n \r\n         for (let key in state.answerMap) {\r\n \r\n \r\n-\r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n"
                },
                {
                    "date": 1624540964602,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -207,8 +207,9 @@\n \r\n         for (let key in state.answerMap) {\r\n \r\n \r\n+\r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n"
                },
                {
                    "date": 1624540974482,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -206,9 +206,11 @@\n         let state: any = globalThis._.cloneDeep(this._state);\r\n \r\n         for (let key in state.answerMap) {\r\n \r\n+            if () {\r\n \r\n+            }\r\n \r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n"
                },
                {
                    "date": 1624540983302,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -206,9 +206,9 @@\n         let state: any = globalThis._.cloneDeep(this._state);\r\n \r\n         for (let key in state.answerMap) {\r\n \r\n-            if () {\r\n+            if (state.answerMap[key]) {\r\n \r\n             }\r\n \r\n         }\r\n"
                },
                {
                    "date": 1624541005631,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -206,9 +206,9 @@\n         let state: any = globalThis._.cloneDeep(this._state);\r\n \r\n         for (let key in state.answerMap) {\r\n \r\n-            if (state.answerMap[key]) {\r\n+            if (state.answerMap[key] === this._rightAnswer[key]) {\r\n \r\n             }\r\n \r\n         }\r\n"
                },
                {
                    "date": 1624541027396,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n     private _textMap: any = {};\r\n \r\n     private _kuangNameArr: any = [];\r\n \r\n-    private _rightAnswer: { 'kuang1': 2, 'kuang2': 1, 'kuang3': 2 };\r\n+    private _rightAnswer: { 'kuang1': '2', 'kuang2': '1', 'kuang3': '2' };\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n"
                },
                {
                    "date": 1624541032507,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,8 +208,9 @@\n         for (let key in state.answerMap) {\r\n \r\n             if (state.answerMap[key] === this._rightAnswer[key]) {\r\n \r\n+\r\n             }\r\n \r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n"
                },
                {
                    "date": 1624541045865,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -206,9 +206,9 @@\n         let state: any = globalThis._.cloneDeep(this._state);\r\n \r\n         for (let key in state.answerMap) {\r\n \r\n-            if (state.answerMap[key] === this._rightAnswer[key]) {\r\n+            if (state.answerMap[key] != this._rightAnswer[key]) {\r\n \r\n \r\n             }\r\n \r\n"
                },
                {
                    "date": 1624541084276,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -204,8 +204,10 @@\n \r\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n \r\n+\r\n+        let isAllKong = false;\r\n         for (let key in state.answerMap) {\r\n \r\n             if (state.answerMap[key] != this._rightAnswer[key]) {\r\n \r\n"
                },
                {
                    "date": 1624541106034,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,11 +208,11 @@\n \r\n         let isAllKong = false;\r\n         for (let key in state.answerMap) {\r\n \r\n-            if (state.answerMap[key] != this._rightAnswer[key]) {\r\n+            if (state.answerMap[key] === '') {\r\n \r\n-\r\n+                isAllKong\r\n             }\r\n \r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n"
                },
                {
                    "date": 1624541124989,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -210,9 +210,9 @@\n         for (let key in state.answerMap) {\r\n \r\n             if (state.answerMap[key] === '') {\r\n \r\n-                isAllKong\r\n+                isAllKong = \r\n             }\r\n \r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n"
                },
                {
                    "date": 1624541131803,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -210,9 +210,9 @@\n         for (let key in state.answerMap) {\r\n \r\n             if (state.answerMap[key] === '') {\r\n \r\n-                isAllKong = \r\n+                isAllKong = true;\r\n             }\r\n \r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n"
                },
                {
                    "date": 1624541137411,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n \r\n         let isAllKong = false;\r\n         for (let key in state.answerMap) {\r\n \r\n-            if (state.answerMap[key] === '') {\r\n+            if (state.answerMap[key] != '') {\r\n \r\n                 isAllKong = true;\r\n             }\r\n \r\n"
                },
                {
                    "date": 1624541145197,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -208,9 +208,9 @@\n \r\n         let isAllKong = false;\r\n         for (let key in state.answerMap) {\r\n \r\n-            if (state.answerMap[key] != '') {\r\n+            if (state.answerMap[key] !== '') {\r\n \r\n                 isAllKong = true;\r\n             }\r\n \r\n"
                },
                {
                    "date": 1624541150865,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -205,9 +205,9 @@\n     private _clickSubmit(evt: any) {\r\n         let state: any = globalThis._.cloneDeep(this._state);\r\n \r\n \r\n-        let isAllKong = false;\r\n+        let isAllKong = true;\r\n         for (let key in state.answerMap) {\r\n \r\n             if (state.answerMap[key] !== '') {\r\n \r\n"
                },
                {
                    "date": 1624541156033,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -210,9 +210,9 @@\n         for (let key in state.answerMap) {\r\n \r\n             if (state.answerMap[key] !== '') {\r\n \r\n-                isAllKong = true;\r\n+                isAllKong = false;\r\n             }\r\n \r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n"
                },
                {
                    "date": 1624541161900,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -211,8 +211,9 @@\n \r\n             if (state.answerMap[key] !== '') {\r\n \r\n                 isAllKong = false;\r\n+                break;\r\n             }\r\n \r\n         }\r\n         state.submit = this.submitType.GuideShow;\r\n"
                },
                {
                    "date": 1624541169810,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -215,8 +215,12 @@\n                 break;\r\n             }\r\n \r\n         }\r\n+\r\n+        if () {\r\n+\r\n+        }\r\n         state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n \r\n"
                },
                {
                    "date": 1624541182629,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -216,12 +216,12 @@\n             }\r\n \r\n         }\r\n \r\n-        if () {\r\n+        if (isAllKong) {\r\n+            state.submit = this.submitType.GuideShow;\r\n+        }\r\n \r\n-        }\r\n-        state.submit = this.submitType.GuideShow;\r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n \r\n         this.updateState(state);\r\n"
                },
                {
                    "date": 1624541188635,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -218,8 +218,10 @@\n         }\r\n \r\n         if (isAllKong) {\r\n             state.submit = this.submitType.GuideShow;\r\n+        } else {\r\n+\r\n         }\r\n \r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n"
                },
                {
                    "date": 1624541196013,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -219,9 +219,17 @@\n \r\n         if (isAllKong) {\r\n             state.submit = this.submitType.GuideShow;\r\n         } else {\r\n+            for (let key in state.answerMap) {\r\n \r\n+                if (state.answerMap[key] !== '') {\r\n+\r\n+                    isAllKong = false;\r\n+                    break;\r\n+                }\r\n+\r\n+            }\r\n         }\r\n \r\n         state.submit = this.submitType.WrongFeed;\r\n         state.submit = this.submitType.RightFeed;\r\n"
                },
                {
                    "date": 1624541205283,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -221,9 +221,9 @@\n             state.submit = this.submitType.GuideShow;\r\n         } else {\r\n             for (let key in state.answerMap) {\r\n \r\n-                if (state.answerMap[key] !== '') {\r\n+                if (state.answerMap[key] === ) {\r\n \r\n                     isAllKong = false;\r\n                     break;\r\n                 }\r\n"
                },
                {
                    "date": 1624541213379,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -221,9 +221,9 @@\n             state.submit = this.submitType.GuideShow;\r\n         } else {\r\n             for (let key in state.answerMap) {\r\n \r\n-                if (state.answerMap[key] === ) {\r\n+                if (state.answerMap[key] === this._rightAnswer[key]) {\r\n \r\n                     isAllKong = false;\r\n                     break;\r\n                 }\r\n"
                },
                {
                    "date": 1624541224272,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -219,8 +219,9 @@\n \r\n         if (isAllKong) {\r\n             state.submit = this.submitType.GuideShow;\r\n         } else {\r\n+            let isAllKong = true;\r\n             for (let key in state.answerMap) {\r\n \r\n                 if (state.answerMap[key] === this._rightAnswer[key]) {\r\n \r\n"
                },
                {
                    "date": 1624541230378,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -219,9 +219,9 @@\n \r\n         if (isAllKong) {\r\n             state.submit = this.submitType.GuideShow;\r\n         } else {\r\n-            let isAllKong = true;\r\n+            let isAllDeng = true;\r\n             for (let key in state.answerMap) {\r\n \r\n                 if (state.answerMap[key] === this._rightAnswer[key]) {\r\n \r\n"
                },
                {
                    "date": 1624541249615,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -222,11 +222,11 @@\n         } else {\r\n             let isAllDeng = true;\r\n             for (let key in state.answerMap) {\r\n \r\n-                if (state.answerMap[key] === this._rightAnswer[key]) {\r\n+                if (state.answerMap[key] !== this._rightAnswer[key]) {\r\n \r\n-                    isAllKong = false;\r\n+                    isAllDeng = false;\r\n                     break;\r\n                 }\r\n \r\n             }\r\n"
                },
                {
                    "date": 1624541260634,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -227,8 +227,10 @@\n \r\n                     isAllDeng = false;\r\n                     break;\r\n                 }\r\n+            }\r\n+            if () {\r\n \r\n             }\r\n         }\r\n \r\n"
                },
                {
                    "date": 1624541273768,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -228,16 +228,18 @@\n                     isAllDeng = false;\r\n                     break;\r\n                 }\r\n             }\r\n-            if () {\r\n+            if (isAllDeng) {\r\n+                state.submit = this.submitType.RightFeed;\r\n+            } else {\r\n \r\n             }\r\n         }\r\n \r\n         state.submit = this.submitType.WrongFeed;\r\n-        state.submit = this.submitType.RightFeed;\r\n \r\n+\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickTitle(evt: any) {\r\n"
                },
                {
                    "date": 1624541279729,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -231,15 +231,15 @@\n             }\r\n             if (isAllDeng) {\r\n                 state.submit = this.submitType.RightFeed;\r\n             } else {\r\n-\r\n+                state.submit = this.submitType.WrongFeed;\r\n             }\r\n         }\r\n \r\n-        state.submit = this.submitType.WrongFeed;\r\n \r\n \r\n+\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickTitle(evt: any) {\r\n"
                },
                {
                    "date": 1624541284818,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -235,11 +235,8 @@\n                 state.submit = this.submitType.WrongFeed;\r\n             }\r\n         }\r\n \r\n-\r\n-\r\n-\r\n         this.updateState(state);\r\n     }\r\n \r\n     private _clickTitle(evt: any) {\r\n"
                },
                {
                    "date": 1624541322594,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -271,8 +271,9 @@\n                 this.answerFeedback(false);\r\n \r\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n+                this.handTips2();\r\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n"
                },
                {
                    "date": 1624541437997,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,8 @@\n         let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n         for (let i = 0; i < this._view.numChildren; i++) {\r\n             if (this._view.getChildAt(i).group == kuangGroup) {\r\n                 let btn = this._view.getChildAt(i).asButton;\r\n-                console.log('=== name ===' + btn.name);\r\n                 this._kuangNameArr.push(btn.name);\r\n                 tempAnswerMap[btn.name] = '';\r\n                 btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n             }\r\n@@ -271,9 +270,9 @@\n                 this.answerFeedback(false);\r\n \r\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n-                this.handTips2();\r\n+                this.handTips2(let keyBtn = this._view.getChildAt(i).asButton;);\r\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n"
                },
                {
                    "date": 1624541475957,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -270,8 +270,9 @@\n                 this.answerFeedback(false);\r\n \r\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n+                let keyBtn = this._view.getChildByName()\r\n                 this.handTips2(let keyBtn = this._view.getChildAt(i).asButton;);\r\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n"
                },
                {
                    "date": 1624541504058,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -270,9 +270,9 @@\n                 this.answerFeedback(false);\r\n \r\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n-                let keyBtn = this._view.getChildByName()\r\n+                let keyBtn = this._view.getChildByName('input1')\r\n                 this.handTips2(let keyBtn = this._view.getChildAt(i).asButton;);\r\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n"
                },
                {
                    "date": 1624541544965,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -270,9 +270,9 @@\n                 this.answerFeedback(false);\r\n \r\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n-                let keyBtn = this._view.getChildByName('input1')\r\n+                let keyBtn = this._view.getChild('input1').asButton;\r\n                 this.handTips2(let keyBtn = this._view.getChildAt(i).asButton;);\r\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n"
                },
                {
                    "date": 1624541552113,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -271,9 +271,9 @@\n \r\n             } else if (state.submit === this.submitType.GuideShow) {\r\n \r\n                 let keyBtn = this._view.getChild('input1').asButton;\r\n-                this.handTips2(let keyBtn = this._view.getChildAt(i).asButton;);\r\n+                this.handTips2(keyBtn);\r\n             }\r\n         }\r\n         if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n \r\n"
                },
                {
                    "date": 1624541819550,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n     private _textMap: any = {};\r\n \r\n     private _kuangNameArr: any = [];\r\n \r\n-    private _rightAnswer: { 'kuang1': '2', 'kuang2': '1', 'kuang3': '2' };\r\n+    private _rightAnswer: [{ 'kuang1': '2' }, { 'kuang2': '1' }, { 'kuang3': '2' }];\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n"
                },
                {
                    "date": 1624541887419,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n     private _textMap: any = {};\r\n \r\n     private _kuangNameArr: any = [];\r\n \r\n-    private _rightAnswer: [{ 'kuang1': '2' }, { 'kuang2': '1' }, { 'kuang3': '2' }];\r\n+    private _rightAnswer: { 'kuang1': '2', 'kuang2': '1', 'kuang3': '2' };\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n@@ -57,8 +57,9 @@\n         this.mergeState();\r\n     }\r\n \r\n     async onLoad() {\r\n+\r\n         this._worldRoot = cc.find(\"Canvas\").parent;\r\n \r\n         this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n         this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n"
                },
                {
                    "date": 1624541922590,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -222,8 +222,9 @@\n         } else {\r\n             let isAllDeng = true;\r\n             for (let key in state.answerMap) {\r\n \r\n+                console.log('== kkk ====' + this._rightAnswer[key])\r\n                 if (state.answerMap[key] !== this._rightAnswer[key]) {\r\n \r\n                     isAllDeng = false;\r\n                     break;\r\n"
                },
                {
                    "date": 1624541929099,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -222,9 +222,10 @@\n         } else {\r\n             let isAllDeng = true;\r\n             for (let key in state.answerMap) {\r\n \r\n-                console.log('== kkk ====' + this._rightAnswer[key])\r\n+                console.log('== kkk ====' + this._rightAnswer[key]) ；\r\n+\r\n                 if (state.answerMap[key] !== this._rightAnswer[key]) {\r\n \r\n                     isAllDeng = false;\r\n                     break;\r\n"
                },
                {
                    "date": 1624541934868,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -222,9 +222,9 @@\n         } else {\r\n             let isAllDeng = true;\r\n             for (let key in state.answerMap) {\r\n \r\n-                console.log('== kkk ====' + this._rightAnswer[key]) ；\r\n+                console.log('== kkk ====' + this._rightAnswer[key]);\r\n \r\n                 if (state.answerMap[key] !== this._rightAnswer[key]) {\r\n \r\n                     isAllDeng = false;\r\n"
                },
                {
                    "date": 1624542008742,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,8 +58,12 @@\n     }\r\n \r\n     async onLoad() {\r\n \r\n+        this._rightAnswer['kuang1'] = '2';\r\n+        this._rightAnswer['kuang2'] = '1';\r\n+        this._rightAnswer['kuang3'] = '3';\r\n+\r\n         this._worldRoot = cc.find(\"Canvas\").parent;\r\n \r\n         this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n         this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n"
                },
                {
                    "date": 1624542019225,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n     private _textMap: any = {};\r\n \r\n     private _kuangNameArr: any = [];\r\n \r\n-    private _rightAnswer: { 'kuang1': '2', 'kuang2': '1', 'kuang3': '2' };\r\n+    private _rightAnswer: any = { 'kuang1': '2', 'kuang2': '1', 'kuang3': '2' };\r\n \r\n     private submitType: any = cc.Enum({\r\n \r\n         No: 0,\r\n"
                },
                {
                    "date": 1624542025541,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,12 +58,8 @@\n     }\r\n \r\n     async onLoad() {\r\n \r\n-        this._rightAnswer['kuang1'] = '2';\r\n-        this._rightAnswer['kuang2'] = '1';\r\n-        this._rightAnswer['kuang3'] = '3';\r\n-\r\n         this._worldRoot = cc.find(\"Canvas\").parent;\r\n \r\n         this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n         this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n"
                },
                {
                    "date": 1624593768239,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -221,11 +221,8 @@\n             state.submit = this.submitType.GuideShow;\r\n         } else {\r\n             let isAllDeng = true;\r\n             for (let key in state.answerMap) {\r\n-\r\n-                console.log('== kkk ====' + this._rightAnswer[key]);\r\n-\r\n                 if (state.answerMap[key] !== this._rightAnswer[key]) {\r\n \r\n                     isAllDeng = false;\r\n                     break;\r\n"
                },
                {
                    "date": 1624850732080,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -459,9 +459,10 @@\n         this.registerState();\r\n     }\r\n \r\n     onDisable() {\r\n-        cc.tween(this).stop();\r\n+\r\n+        cc.Tween.stopAll();\r\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n"
                },
                {
                    "date": 1624850737366,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,467 @@\n+\r\n+/*\r\n+ * @Descripttion: \r\n+ * @version: \r\n+ * @Author: ruzhuan\r\n+ * @Date: 2021-06-08 18:00:00\r\n+ * @LastEditors: ruzhuan\r\n+ * @LastEditTime: 2021-06-08 18:00:00\r\n+ */\r\n+const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n+const { ccclass, property } = cc._decorator;\r\n+\r\n+@ccclass\r\n+export default class t4_05_model_v1 extends cc.Component {\r\n+    private _worldRoot: cc.Node;\r\n+\r\n+    private _view: fgui.GComponent;\r\n+\r\n+    private _c1: fgui.Controller;\r\n+\r\n+    private _title: fgui.GButton;\r\n+\r\n+    private _titleTrigger: fgui.GLoader;\r\n+\r\n+    private _submitBtn: fgui.GButton;\r\n+\r\n+    private _package: any;\r\n+\r\n+    private _selectMap: any = {};\r\n+\r\n+    private _textMap: any = {};\r\n+\r\n+    private _kuangNameArr: any = [];\r\n+\r\n+    private _rightAnswer: any = { 'kuang1': '2', 'kuang2': '1', 'kuang3': '2' };\r\n+\r\n+    private submitType: any = cc.Enum({\r\n+\r\n+        No: 0,\r\n+        GuideShow: 1,\r\n+        WrongFeed: 2,\r\n+        RightFeed: 3\r\n+    });\r\n+\r\n+    // 远程动态组件\r\n+    private feedback: any;\r\n+\r\n+    private _state = {};\r\n+\r\n+    get state(): any {\r\n+        return this._state;\r\n+    }\r\n+\r\n+    set state(v: any) {\r\n+        this.updateUi(this._state, v);\r\n+        this._state = v;\r\n+        this.mergeState();\r\n+    }\r\n+\r\n+    async onLoad() {\r\n+\r\n+        this._worldRoot = cc.find(\"Canvas\").parent;\r\n+\r\n+        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n+        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n+\r\n+        fgui.GRoot.inst.addChild(this._view);\r\n+\r\n+        this._c1 = this._view.getController(\"c1\");\r\n+\r\n+        // 臨時\r\n+        // bug 初始设置不播放不生效\r\n+        if (this._c1) {\r\n+            this._c1.selectedIndex = 1;\r\n+            this._c1.selectedIndex = 0;\r\n+        }\r\n+\r\n+        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n+        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n+\r\n+        this._title = this._view.getChild(\"title\").asButton;\r\n+\r\n+        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n+        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n+\r\n+        let tempAnswerMap = {};\r\n+        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == kuangGroup) {\r\n+                let btn = this._view.getChildAt(i).asButton;\r\n+                this._kuangNameArr.push(btn.name);\r\n+                tempAnswerMap[btn.name] = '';\r\n+                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n+            }\r\n+        }\r\n+\r\n+        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n+        let indexTemp = 0;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == selectGroup) {\r\n+                let img = this._view.getChildAt(i).asImage;\r\n+                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n+                img.visible = false;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        indexTemp = 0;\r\n+        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == textGroup) {\r\n+                let label = this._view.getChildAt(i).asLabel;\r\n+                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n+                indexTemp++;\r\n+            }\r\n+        }\r\n+\r\n+        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n+        for (let i = 0; i < this._view.numChildren; i++) {\r\n+            if (this._view.getChildAt(i).group == keyGroup) {\r\n+                let keyBtn = this._view.getChildAt(i).asButton;\r\n+                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n+            }\r\n+        }\r\n+\r\n+        // 初始化state\r\n+        this._state = {\r\n+            title: false,\r\n+            submit: this.submitType.No,\r\n+            selectKuangName: '',\r\n+            keyNumber: '',\r\n+            answerMap: tempAnswerMap,\r\n+        }\r\n+    }\r\n+\r\n+    async init(data: any) {\r\n+        // 临时 model component json 配置加载\r\n+        let { pathConfig, model, components } = data;\r\n+        let Package = pathConfig.packageName;\r\n+        let GComponent = model.uiPath;\r\n+        let { boxSoundUrl, guidIndex } = model.config;\r\n+        this._package = Package;\r\n+\r\n+        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n+\r\n+        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n+        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n+\r\n+\r\n+        // 动效注册\r\n+        // for (let v in ae) {\r\n+        //     if (ae[v]) {\r\n+        //         this[v] = {};\r\n+        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n+        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n+        //     }\r\n+        // }\r\n+\r\n+        if (components) {\r\n+            for (const key in components) {\r\n+                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n+                let componentBundle: any = await loadBundle(componentPath);\r\n+                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n+                this[key] = componentPrefab;\r\n+            }\r\n+        }\r\n+    }\r\n+\r\n+    private _clickKey(evt: any) {\r\n+\r\n+        let isHideAll = true;\r\n+        for (let key in this._selectMap) {\r\n+\r\n+            if (this._selectMap[key].visible) {\r\n+                isHideAll = false;\r\n+                break;\r\n+            }\r\n+        }\r\n+\r\n+        if (isHideAll) {\r\n+            this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n+            return;\r\n+        }\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let subName = btn.name.substring('input'.length);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.keyNumber = subName + '';\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickKuang(evt: any) {\r\n+\r\n+        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        if (state.selectKuangName === btn.name) {\r\n+            state.selectKuangName = '';\r\n+        } else {\r\n+\r\n+            state.selectKuangName = btn.name;\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickSubmit(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+\r\n+\r\n+        let isAllKong = true;\r\n+        for (let key in state.answerMap) {\r\n+\r\n+            if (state.answerMap[key] !== '') {\r\n+\r\n+                isAllKong = false;\r\n+                break;\r\n+            }\r\n+\r\n+        }\r\n+\r\n+        if (isAllKong) {\r\n+            state.submit = this.submitType.GuideShow;\r\n+        } else {\r\n+            let isAllDeng = true;\r\n+            for (let key in state.answerMap) {\r\n+                if (state.answerMap[key] !== this._rightAnswer[key]) {\r\n+\r\n+                    isAllDeng = false;\r\n+                    break;\r\n+                }\r\n+            }\r\n+            if (isAllDeng) {\r\n+                state.submit = this.submitType.RightFeed;\r\n+            } else {\r\n+                state.submit = this.submitType.WrongFeed;\r\n+            }\r\n+        }\r\n+\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+    private _clickTitle(evt: any) {\r\n+        let state: any = globalThis._.cloneDeep(this._state);\r\n+        state.title = true;\r\n+        this.updateState(state);\r\n+    }\r\n+\r\n+\r\n+    // 获取状态\r\n+    getState(data: any) {\r\n+        this.updateState(data);\r\n+    }\r\n+\r\n+    // 更新状态层\r\n+    updateState(curState: any) {\r\n+        if (globalThis._.isEqual(this._state, curState)) return;\r\n+        this.state = curState;\r\n+    }\r\n+\r\n+    // 更新ui层\r\n+    updateUi(oldState: any, state: any) {\r\n+\r\n+        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n+\r\n+            if (state.submit === this.submitType.RightFeed) {\r\n+\r\n+                this.answerFeedback(true);\r\n+\r\n+            } else if (state.submit === this.submitType.WrongFeed) {\r\n+\r\n+                this.answerFeedback(false);\r\n+\r\n+            } else if (state.submit === this.submitType.GuideShow) {\r\n+\r\n+                let keyBtn = this._view.getChild('input1').asButton;\r\n+                this.handTips2(keyBtn);\r\n+            }\r\n+        }\r\n+        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n+\r\n+            if (state.keyNumber != '') {\r\n+\r\n+                let answerMapTemp = state.answerMap;\r\n+                let curKuangName = state.selectKuangName;\r\n+                let oldKuangName = oldState.selectKuangName;\r\n+                if (oldKuangName != curKuangName) {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } if (state.keyNumber !== 'x') {\r\n+                        answerMapTemp[curKuangName] = state.keyNumber;\r\n+                    }\r\n+\r\n+                } else {\r\n+\r\n+                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n+\r\n+                        let str = answerMapTemp[curKuangName];\r\n+                        let strJian = str.substring(0, str.length - 1);\r\n+\r\n+                        answerMapTemp[curKuangName] = strJian;\r\n+\r\n+                    } else if (state.keyNumber !== 'x') {\r\n+\r\n+                        answerMapTemp[curKuangName] += state.keyNumber;\r\n+                    }\r\n+\r\n+                }\r\n+\r\n+                setTimeout(() => {\r\n+\r\n+                    let state2: any = globalThis._.cloneDeep(this._state);\r\n+                    state2.keyNumber = '';\r\n+                    state2.answerMap = answerMapTemp;\r\n+                    this.updateState(state2);\r\n+\r\n+                }, 10);\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n+\r\n+            for (let key in state.answerMap) {\r\n+\r\n+                this._textMap[key].text = state.answerMap[key];\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n+\r\n+\r\n+            if (state.selectKuangName != '') {\r\n+\r\n+                this._selectMap[state.selectKuangName].visible = true;\r\n+            }\r\n+\r\n+            if (oldState.selectKuangName != '') {\r\n+\r\n+                this._selectMap[oldState.selectKuangName].visible = false;\r\n+            }\r\n+        }\r\n+\r\n+        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n+            this.playTitle(state.title);\r\n+        }\r\n+    }\r\n+\r\n+\r\n+    async playTitle(bool: boolean) {\r\n+        this._c1.selectedIndex = bool ? 1 : 0;\r\n+        if (bool) {\r\n+            cc.audioEngine.stopAll();\r\n+            this.forbidHandle();\r\n+            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n+            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n+            let audioId = cc.audioEngine.play(audio, false, 1);\r\n+            cc.audioEngine.setFinishCallback(audioId, () => {\r\n+                let state: any = globalThis._.cloneDeep(this._state);\r\n+                state.title = false;\r\n+                this.updateState(state);\r\n+            });\r\n+        } else {\r\n+            this.disableForbidHandle();\r\n+        }\r\n+    }\r\n+\r\n+    answerFeedback(bool: boolean) {\r\n+        if (!this.feedback) return;\r\n+        let feedback: any = cc.instantiate(this.feedback);\r\n+        feedback.x = 960;\r\n+        feedback.y = 540;\r\n+        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n+        feedbackJs.init(bool);\r\n+        feedback.parent = cc.find(\"Canvas\").parent;\r\n+\r\n+        setTimeout(() => {\r\n+            feedback.destroy();\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state);\r\n+        }, 2000);\r\n+    }\r\n+\r\n+\r\n+    /**\r\n+     * 点击指引\r\n+     * @param obj 点击对象\r\n+     */\r\n+    handTips2(obj: fgui.GObject) {\r\n+        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n+        this._view.addChild(hand);\r\n+        let tempX = obj.x;\r\n+        let tempY = obj.y;\r\n+\r\n+        hand.x = tempX;\r\n+        hand.y = tempY;\r\n+\r\n+        cc.tween(hand).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).to(0.3, {\r\n+            x: tempX - 30,\r\n+            y: tempY - 30\r\n+        }).to(0.3, {\r\n+            x: tempX,\r\n+            y: tempY\r\n+        }).call(() => {\r\n+            this._view.removeChild(hand);\r\n+            hand = null;\r\n+            let state: any = globalThis._.cloneDeep(this._state);\r\n+            state.submit = this.submitType.No;\r\n+            this.updateState(state)\r\n+        }).start();\r\n+    }\r\n+\r\n+    // 运行时 禁止操作\r\n+    forbidHandle() {\r\n+        console.log('===  运行时 禁止操作 =====');\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (!handleMask) {\r\n+            let handleMask = new cc.Node('handleMask');\r\n+            handleMask.addComponent(cc.BlockInputEvents);\r\n+            handleMask.parent = this._worldRoot;\r\n+            handleMask.width = 1920;\r\n+            handleMask.height = 1080;\r\n+            handleMask.x = 960;\r\n+            handleMask.y = 540;\r\n+        }\r\n+    }\r\n+\r\n+    // 消除禁止\r\n+    disableForbidHandle() {\r\n+        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n+        if (handleMask) handleMask.destroy();\r\n+    }\r\n+\r\n+    // 注册状态，及获取状态的方法\r\n+    registerState() {\r\n+        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n+    }\r\n+\r\n+    // 解除状态，及获取状态的方法\r\n+    relieveState() {\r\n+        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n+    }\r\n+\r\n+    // 本组件状态合并到全局\r\n+    mergeState() {\r\n+        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n+    }\r\n+\r\n+    onEnable() {\r\n+        this.registerState();\r\n+    }\r\n+\r\n+    onDisable() {\r\n+        cc.Tween.stopAll();\r\n+        this.relieveState();\r\n+        cc.audioEngine.stopAll();\r\n+    }\r\n+}\r\n"
                },
                {
                    "date": 1624850753989,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -464,472 +464,4 @@\n         this.relieveState();\r\n         cc.audioEngine.stopAll();\r\n     }\r\n }\r\n-\r\n-/*\r\n- * @Descripttion: \r\n- * @version: \r\n- * @Author: ruzhuan\r\n- * @Date: 2021-06-08 18:00:00\r\n- * @LastEditors: ruzhuan\r\n- * @LastEditTime: 2021-06-08 18:00:00\r\n- */\r\n-const { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\n-const { ccclass, property } = cc._decorator;\r\n-\r\n-@ccclass\r\n-export default class t4_05_model_v1 extends cc.Component {\r\n-    private _worldRoot: cc.Node;\r\n-\r\n-    private _view: fgui.GComponent;\r\n-\r\n-    private _c1: fgui.Controller;\r\n-\r\n-    private _title: fgui.GButton;\r\n-\r\n-    private _titleTrigger: fgui.GLoader;\r\n-\r\n-    private _submitBtn: fgui.GButton;\r\n-\r\n-    private _package: any;\r\n-\r\n-    private _selectMap: any = {};\r\n-\r\n-    private _textMap: any = {};\r\n-\r\n-    private _kuangNameArr: any = [];\r\n-\r\n-    private _rightAnswer: any = { 'kuang1': '2', 'kuang2': '1', 'kuang3': '2' };\r\n-\r\n-    private submitType: any = cc.Enum({\r\n-\r\n-        No: 0,\r\n-        GuideShow: 1,\r\n-        WrongFeed: 2,\r\n-        RightFeed: 3\r\n-    });\r\n-\r\n-    // 远程动态组件\r\n-    private feedback: any;\r\n-\r\n-    private _state = {};\r\n-\r\n-    get state(): any {\r\n-        return this._state;\r\n-    }\r\n-\r\n-    set state(v: any) {\r\n-        this.updateUi(this._state, v);\r\n-        this._state = v;\r\n-        this.mergeState();\r\n-    }\r\n-\r\n-    async onLoad() {\r\n-\r\n-        this._worldRoot = cc.find(\"Canvas\").parent;\r\n-\r\n-        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n-        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n-\r\n-        fgui.GRoot.inst.addChild(this._view);\r\n-\r\n-        this._c1 = this._view.getController(\"c1\");\r\n-\r\n-        // 臨時\r\n-        // bug 初始设置不播放不生效\r\n-        if (this._c1) {\r\n-            this._c1.selectedIndex = 1;\r\n-            this._c1.selectedIndex = 0;\r\n-        }\r\n-\r\n-        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n-        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n-\r\n-        this._title = this._view.getChild(\"title\").asButton;\r\n-\r\n-        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n-        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n-\r\n-        let tempAnswerMap = {};\r\n-        let kuangGroup = this._view.getChild(\"kuangGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == kuangGroup) {\r\n-                let btn = this._view.getChildAt(i).asButton;\r\n-                this._kuangNameArr.push(btn.name);\r\n-                tempAnswerMap[btn.name] = '';\r\n-                btn.on(fgui.Event.CLICK, this._clickKuang, this);\r\n-            }\r\n-        }\r\n-\r\n-        let selectGroup = this._view.getChild(\"selectGroup\").asGroup;\r\n-        let indexTemp = 0;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == selectGroup) {\r\n-                let img = this._view.getChildAt(i).asImage;\r\n-                this._selectMap[this._kuangNameArr[indexTemp]] = img;\r\n-                img.visible = false;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        indexTemp = 0;\r\n-        let textGroup = this._view.getChild(\"textGroup\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == textGroup) {\r\n-                let label = this._view.getChildAt(i).asLabel;\r\n-                this._textMap[this._kuangNameArr[indexTemp]] = label;\r\n-                indexTemp++;\r\n-            }\r\n-        }\r\n-\r\n-        let keyGroup = this._view.getChild(\"key\").asGroup;\r\n-        for (let i = 0; i < this._view.numChildren; i++) {\r\n-            if (this._view.getChildAt(i).group == keyGroup) {\r\n-                let keyBtn = this._view.getChildAt(i).asButton;\r\n-                keyBtn.on(fgui.Event.CLICK, this._clickKey, this);\r\n-            }\r\n-        }\r\n-\r\n-        // 初始化state\r\n-        this._state = {\r\n-            title: false,\r\n-            submit: this.submitType.No,\r\n-            selectKuangName: '',\r\n-            keyNumber: '',\r\n-            answerMap: tempAnswerMap,\r\n-        }\r\n-    }\r\n-\r\n-    async init(data: any) {\r\n-        // 临时 model component json 配置加载\r\n-        let { pathConfig, model, components } = data;\r\n-        let Package = pathConfig.packageName;\r\n-        let GComponent = model.uiPath;\r\n-        let { boxSoundUrl, guidIndex } = model.config;\r\n-        this._package = Package;\r\n-\r\n-        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n-\r\n-        // let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n-        // this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n-\r\n-\r\n-        // 动效注册\r\n-        // for (let v in ae) {\r\n-        //     if (ae[v]) {\r\n-        //         this[v] = {};\r\n-        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n-        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n-        //     }\r\n-        // }\r\n-\r\n-        if (components) {\r\n-            for (const key in components) {\r\n-                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n-                let componentBundle: any = await loadBundle(componentPath);\r\n-                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n-                this[key] = componentPrefab;\r\n-            }\r\n-        }\r\n-    }\r\n-\r\n-    private _clickKey(evt: any) {\r\n-\r\n-        let isHideAll = true;\r\n-        for (let key in this._selectMap) {\r\n-\r\n-            if (this._selectMap[key].visible) {\r\n-                isHideAll = false;\r\n-                break;\r\n-            }\r\n-        }\r\n-\r\n-        if (isHideAll) {\r\n-            this.handTips2(this._selectMap[this._kuangNameArr[0]]);\r\n-            return;\r\n-        }\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let subName = btn.name.substring('input'.length);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.keyNumber = subName + '';\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickKuang(evt: any) {\r\n-\r\n-        var btn: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        if (state.selectKuangName === btn.name) {\r\n-            state.selectKuangName = '';\r\n-        } else {\r\n-\r\n-            state.selectKuangName = btn.name;\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickSubmit(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-\r\n-\r\n-        let isAllKong = true;\r\n-        for (let key in state.answerMap) {\r\n-\r\n-            if (state.answerMap[key] !== '') {\r\n-\r\n-                isAllKong = false;\r\n-                break;\r\n-            }\r\n-\r\n-        }\r\n-\r\n-        if (isAllKong) {\r\n-            state.submit = this.submitType.GuideShow;\r\n-        } else {\r\n-            let isAllDeng = true;\r\n-            for (let key in state.answerMap) {\r\n-                if (state.answerMap[key] !== this._rightAnswer[key]) {\r\n-\r\n-                    isAllDeng = false;\r\n-                    break;\r\n-                }\r\n-            }\r\n-            if (isAllDeng) {\r\n-                state.submit = this.submitType.RightFeed;\r\n-            } else {\r\n-                state.submit = this.submitType.WrongFeed;\r\n-            }\r\n-        }\r\n-\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-    private _clickTitle(evt: any) {\r\n-        let state: any = globalThis._.cloneDeep(this._state);\r\n-        state.title = true;\r\n-        this.updateState(state);\r\n-    }\r\n-\r\n-\r\n-    // 获取状态\r\n-    getState(data: any) {\r\n-        this.updateState(data);\r\n-    }\r\n-\r\n-    // 更新状态层\r\n-    updateState(curState: any) {\r\n-        if (globalThis._.isEqual(this._state, curState)) return;\r\n-        this.state = curState;\r\n-    }\r\n-\r\n-    // 更新ui层\r\n-    updateUi(oldState: any, state: any) {\r\n-\r\n-        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n-\r\n-            if (state.submit === this.submitType.RightFeed) {\r\n-\r\n-                this.answerFeedback(true);\r\n-\r\n-            } else if (state.submit === this.submitType.WrongFeed) {\r\n-\r\n-                this.answerFeedback(false);\r\n-\r\n-            } else if (state.submit === this.submitType.GuideShow) {\r\n-\r\n-                let keyBtn = this._view.getChild('input1').asButton;\r\n-                this.handTips2(keyBtn);\r\n-            }\r\n-        }\r\n-        if (!globalThis._.isEqual(oldState.keyNumber, state.keyNumber)) {\r\n-\r\n-            if (state.keyNumber != '') {\r\n-\r\n-                let answerMapTemp = state.answerMap;\r\n-                let curKuangName = state.selectKuangName;\r\n-                let oldKuangName = oldState.selectKuangName;\r\n-                if (oldKuangName != curKuangName) {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } if (state.keyNumber !== 'x') {\r\n-                        answerMapTemp[curKuangName] = state.keyNumber;\r\n-                    }\r\n-\r\n-                } else {\r\n-\r\n-                    if (state.keyNumber === 'x' && answerMapTemp[curKuangName].length !== 0) {\r\n-\r\n-                        let str = answerMapTemp[curKuangName];\r\n-                        let strJian = str.substring(0, str.length - 1);\r\n-\r\n-                        answerMapTemp[curKuangName] = strJian;\r\n-\r\n-                    } else if (state.keyNumber !== 'x') {\r\n-\r\n-                        answerMapTemp[curKuangName] += state.keyNumber;\r\n-                    }\r\n-\r\n-                }\r\n-\r\n-                setTimeout(() => {\r\n-\r\n-                    let state2: any = globalThis._.cloneDeep(this._state);\r\n-                    state2.keyNumber = '';\r\n-                    state2.answerMap = answerMapTemp;\r\n-                    this.updateState(state2);\r\n-\r\n-                }, 10);\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.answerMap, state.answerMap)) {\r\n-\r\n-            for (let key in state.answerMap) {\r\n-\r\n-                this._textMap[key].text = state.answerMap[key];\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.selectKuangName, state.selectKuangName)) {\r\n-\r\n-\r\n-            if (state.selectKuangName != '') {\r\n-\r\n-                this._selectMap[state.selectKuangName].visible = true;\r\n-            }\r\n-\r\n-            if (oldState.selectKuangName != '') {\r\n-\r\n-                this._selectMap[oldState.selectKuangName].visible = false;\r\n-            }\r\n-        }\r\n-\r\n-        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n-            this.playTitle(state.title);\r\n-        }\r\n-    }\r\n-\r\n-\r\n-    async playTitle(bool: boolean) {\r\n-        this._c1.selectedIndex = bool ? 1 : 0;\r\n-        if (bool) {\r\n-            cc.audioEngine.stopAll();\r\n-            this.forbidHandle();\r\n-            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n-            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n-            let audioId = cc.audioEngine.play(audio, false, 1);\r\n-            cc.audioEngine.setFinishCallback(audioId, () => {\r\n-                let state: any = globalThis._.cloneDeep(this._state);\r\n-                state.title = false;\r\n-                this.updateState(state);\r\n-            });\r\n-        } else {\r\n-            this.disableForbidHandle();\r\n-        }\r\n-    }\r\n-\r\n-    answerFeedback(bool: boolean) {\r\n-        if (!this.feedback) return;\r\n-        let feedback: any = cc.instantiate(this.feedback);\r\n-        feedback.x = 960;\r\n-        feedback.y = 540;\r\n-        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n-        feedbackJs.init(bool);\r\n-        feedback.parent = cc.find(\"Canvas\").parent;\r\n-\r\n-        setTimeout(() => {\r\n-            feedback.destroy();\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state);\r\n-        }, 2000);\r\n-    }\r\n-\r\n-\r\n-    /**\r\n-     * 点击指引\r\n-     * @param obj 点击对象\r\n-     */\r\n-    handTips2(obj: fgui.GObject) {\r\n-        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n-        this._view.addChild(hand);\r\n-        let tempX = obj.x;\r\n-        let tempY = obj.y;\r\n-\r\n-        hand.x = tempX;\r\n-        hand.y = tempY;\r\n-\r\n-        cc.tween(hand).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).to(0.3, {\r\n-            x: tempX - 30,\r\n-            y: tempY - 30\r\n-        }).to(0.3, {\r\n-            x: tempX,\r\n-            y: tempY\r\n-        }).call(() => {\r\n-            this._view.removeChild(hand);\r\n-            hand = null;\r\n-            let state: any = globalThis._.cloneDeep(this._state);\r\n-            state.submit = this.submitType.No;\r\n-            this.updateState(state)\r\n-        }).start();\r\n-    }\r\n-\r\n-    // 运行时 禁止操作\r\n-    forbidHandle() {\r\n-        console.log('===  运行时 禁止操作 =====');\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (!handleMask) {\r\n-            let handleMask = new cc.Node('handleMask');\r\n-            handleMask.addComponent(cc.BlockInputEvents);\r\n-            handleMask.parent = this._worldRoot;\r\n-            handleMask.width = 1920;\r\n-            handleMask.height = 1080;\r\n-            handleMask.x = 960;\r\n-            handleMask.y = 540;\r\n-        }\r\n-    }\r\n-\r\n-    // 消除禁止\r\n-    disableForbidHandle() {\r\n-        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n-        if (handleMask) handleMask.destroy();\r\n-    }\r\n-\r\n-    // 注册状态，及获取状态的方法\r\n-    registerState() {\r\n-        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n-    }\r\n-\r\n-    // 解除状态，及获取状态的方法\r\n-    relieveState() {\r\n-        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n-    }\r\n-\r\n-    // 本组件状态合并到全局\r\n-    mergeState() {\r\n-        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n-    }\r\n-\r\n-    onEnable() {\r\n-        this.registerState();\r\n-    }\r\n-\r\n-    onDisable() {\r\n-\r\n-        cc.Tween.stopAll();\r\n-        this.relieveState();\r\n-        cc.audioEngine.stopAll();\r\n-    }\r\n-}\r\n"
                }
            ],
            "date": 1624502666702,
            "name": "Commit-0",
            "content": "\r\n/*\r\n * @Descripttion: \r\n * @version: \r\n * @Author: ruzhuan\r\n * @Date: 2021-06-08 18:00:00\r\n * @LastEditors: ruzhuan\r\n * @LastEditTime: 2021-06-08 18:00:00\r\n */\r\nconst { loadBundle, loadPrefab, loadResource } = window['GlobalData'].sample;\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class t4_05_model_v1 extends cc.Component {\r\n    private _worldRoot: cc.Node;\r\n\r\n    private _view: fgui.GComponent;\r\n\r\n    private _c1: fgui.Controller;\r\n\r\n    private _c2: fgui.Controller;\r\n\r\n    private _paoShow: any = [];\r\n\r\n    private _chooseBtn: any = [];\r\n\r\n    private _selectIcons: any = [];\r\n\r\n    private _chooseCach: any = [];\r\n\r\n    private _title: fgui.GButton;\r\n\r\n    private _titleTrigger: fgui.GLoader;\r\n\r\n    private _submitBtn: fgui.GButton;\r\n\r\n    private _package: any;\r\n\r\n    private _boxSound: cc.AudioClip;\r\n\r\n    private _mask: fgui.GGraph;\r\n\r\n    private _guidIndex: number = 0;\r\n\r\n    private _box3D: fgui.GLoader3D;\r\n\r\n    private submitType: any = cc.Enum({\r\n\r\n        No: 0,\r\n        GuideShow: 1,\r\n        WrongFeed: 2,\r\n        RightFeed: 3\r\n    });\r\n\r\n    // 远程动态组件\r\n    private feedback: any;\r\n\r\n    private _state = {};\r\n\r\n    get state(): any {\r\n        return this._state;\r\n    }\r\n\r\n    set state(v: any) {\r\n        this.updateUi(this._state, v);\r\n        this._state = v;\r\n        this.mergeState();\r\n    }\r\n\r\n    async onLoad() {\r\n        this._worldRoot = cc.find(\"Canvas\").parent;\r\n\r\n        this._view.y = (fgui.GRoot.inst.height - this._view.height) / 2;\r\n        this._view.x = (fgui.GRoot.inst.width - this._view.width) / 2;\r\n\r\n        fgui.GRoot.inst.addChild(this._view);\r\n\r\n\r\n        this._mask = this._view.getChild('maskBg').asGraph;\r\n        this._c1 = this._view.getController(\"c1\");\r\n        this._c2 = this._view.getController(\"c2\");\r\n\r\n        // 臨時\r\n        // bug 初始设置不播放不生效\r\n        if (this._c1) {\r\n            this._c1.selectedIndex = 1;\r\n            this._c1.selectedIndex = 0;\r\n        }\r\n\r\n        this._box3D = this._view.getChild(\"box\") as fgui.GLoader3D;\r\n        this._box3D.on(fgui.Event.CLICK, this._clickBox, this);\r\n        this._box3D.url = \"ui://733aoo45gzaz75\";\r\n        this._box3D.animationName = 'sjq_idle';\r\n\r\n        this._titleTrigger = this._view.getChild(\"titleTrigger\").asLoader;\r\n        if (this._titleTrigger) this._titleTrigger.on(fgui.Event.CLICK, this._clickTitle, this);\r\n\r\n        this._title = this._view.getChild(\"title\").asButton;\r\n\r\n        this._submitBtn = this._view.getChild(\"submit\").asButton;\r\n        if (this._submitBtn) this._submitBtn.on(fgui.Event.CLICK, this._clickSubmit, this);\r\n\r\n        let paoGroup = this._view.getChild(\"pao\").asGroup;\r\n        for (let i = 0; i < this._view.numChildren; i++) {\r\n            if (this._view.getChildAt(i).group == paoGroup) {\r\n                let btn: fgui.GButton = this._view.getChildAt(i).asButton;\r\n                btn.alpha = 0;\r\n                this._paoShow.push(btn);\r\n            }\r\n        }\r\n\r\n        let chooseGroup = this._view.getChild(\"choose\").asGroup;\r\n        for (let i = 0; i < this._view.numChildren; i++) {\r\n            if (this._view.getChildAt(i).group == chooseGroup) {\r\n                let btn: fgui.GButton = this._view.getChildAt(i).asButton;\r\n                btn.data = { index: this._chooseCach.length };\r\n                let temp = { index: this._chooseCach.length, selected: false };\r\n                this._chooseCach.push(temp);\r\n                this._chooseBtn.push(btn);\r\n                btn.on(fgui.Event.CLICK, this._clickChoose, this);\r\n            }\r\n        }\r\n\r\n        let selectedGroup = this._view.getChild(\"select\").asGroup;\r\n        for (let i = 0; i < this._view.numChildren; i++) {\r\n            if (this._view.getChildAt(i).group == selectedGroup) {\r\n                let icon: fgui.GImage = this._view.getChildAt(i).asImage;\r\n                icon.visible = false;\r\n                this._selectIcons.push(icon);\r\n            }\r\n        }\r\n\r\n        // 初始化state\r\n        this._state = {\r\n            title: false,\r\n            boxPlay: false,\r\n            canChoose: false,\r\n            chooseCach: this._chooseCach,\r\n            submit: this.submitType.No,\r\n        }\r\n    }\r\n\r\n    async init(data: any) {\r\n        // 临时 model component json 配置加载\r\n        let { pathConfig, model, components } = data;\r\n        let Package = pathConfig.packageName;\r\n        let GComponent = model.uiPath;\r\n        let { boxSoundUrl, guidIndex } = model.config;\r\n        this._package = Package;\r\n\r\n        this._view = fgui.UIPackage.createObject(Package, GComponent).asCom;\r\n\r\n        let item = fgui.UIPackage.getItemByURL(boxSoundUrl);\r\n        this._boxSound = await loadResource(item.file, cc.AudioClip);\r\n\r\n        if (guidIndex) this._guidIndex = guidIndex;\r\n\r\n        // 动效注册\r\n        // for (let v in ae) {\r\n        //     if (ae[v]) {\r\n        //         this[v] = {};\r\n        //         if (ae[v].component) this[v].component = fgui.UIPackage.createObject(Package, ae[v].component).asCom;\r\n        //         if (ae[v].pos) this[v].pos = ae[v].pos;\r\n        //     }\r\n        // }\r\n\r\n        if (components) {\r\n            for (const key in components) {\r\n                let componentPath: any = `${pathConfig.remoteUrl}${pathConfig.componentBundlePath}${components[key].bundleName}`;\r\n                let componentBundle: any = await loadBundle(componentPath);\r\n                let componentPrefab: any = await loadPrefab(componentBundle, components[key].prefabName);\r\n                this[key] = componentPrefab;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _clickChoose(evt: any) {\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n        let obj: fgui.GObject = fgui.GObject.cast(evt.currentTarget);\r\n        let btn: fgui.GButton = obj.asButton;\r\n\r\n        for (let i = 0; i < state.chooseCach.length; i++) {\r\n            state.chooseCach[i].selected = false;\r\n        }\r\n        for (let i = 0; i < state.chooseCach.length; i++) {\r\n            if (state.chooseCach[i].index === btn.data.index) {\r\n                state.chooseCach[i].selected = true;\r\n                break;\r\n            }\r\n        }\r\n        this.updateState(state);\r\n    }\r\n\r\n    private _clickSubmit(evt: any) {\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n\r\n        let isHave = 0;\r\n        for (let i = 0; i < state.chooseCach.length; i++) {\r\n\r\n            if (state.chooseCach[i].selected) {\r\n                isHave++;\r\n            }\r\n        }\r\n\r\n        if (isHave === 0) {\r\n            state.submit = this.submitType.GuideShow;\r\n        } else if (isHave === 1) {\r\n\r\n            state.submit = this.submitType.WrongFeed;\r\n\r\n            for (let i = 0; i < state.chooseCach.length; i++) {\r\n\r\n                if (state.chooseCach[i].selected && state.chooseCach[i].index === 0) {\r\n\r\n                    state.submit = this.submitType.RightFeed;\r\n                    break;\r\n                }\r\n            }\r\n\r\n        } else {\r\n            state.submit = this.submitType.WrongFeed;\r\n        }\r\n\r\n        this.updateState(state);\r\n    }\r\n\r\n    private _clickBox(evt: any) {\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n        state.boxPlay = true;\r\n        this.updateState(state);\r\n    }\r\n\r\n    private _clickTitle(evt: any) {\r\n        let state: any = globalThis._.cloneDeep(this._state);\r\n        state.title = true;\r\n        this.updateState(state);\r\n    }\r\n\r\n\r\n    // 获取状态\r\n    getState(data: any) {\r\n        this.updateState(data);\r\n    }\r\n\r\n    // 更新状态层\r\n    updateState(curState: any) {\r\n        if (globalThis._.isEqual(this._state, curState)) return;\r\n        this.state = curState;\r\n    }\r\n\r\n    // 更新ui层\r\n    updateUi(oldState: any, state: any) {\r\n\r\n        if (!globalThis._.isEqual(oldState.boxPlay, state.boxPlay)) {\r\n            if (state.boxPlay) {\r\n                this.playBoxSpeak(state.boxPlay);\r\n            } else {\r\n                this._box3D.animationName = 'sjq_idle';\r\n                this._c2.selectedIndex = 0;\r\n            }\r\n        }\r\n\r\n        if (!globalThis._.isEqual(oldState.chooseCach, state.chooseCach)) {\r\n\r\n            for (let i = 0; i < state.chooseCach.length; i++) {\r\n\r\n                for (let j = 0; j < this._selectIcons.length; j++) {\r\n                    if (state.chooseCach[i].index === j) {\r\n                        this._selectIcons[j].visible = state.chooseCach[i].selected;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!globalThis._.isEqual(oldState.submit, state.submit)) {\r\n\r\n            if (state.submit === this.submitType.RightFeed) {\r\n\r\n                this.answerFeedback(true);\r\n\r\n            } else if (state.submit === this.submitType.WrongFeed) {\r\n\r\n                this.answerFeedback(false);\r\n\r\n            } else if (state.submit === this.submitType.GuideShow) {\r\n\r\n                this.handTips2(this._chooseBtn[this._guidIndex]);\r\n            }\r\n        }\r\n\r\n        if (!globalThis._.isEqual(oldState.title, state.title)) {\r\n            this.playTitle(state.title);\r\n        }\r\n\r\n        if (!globalThis._.isEqual(oldState.canChoose, state.canChoose)) {\r\n            this._mask.visible = !state.canChoose;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    async playTitle(bool: boolean) {\r\n        this._c1.selectedIndex = bool ? 1 : 0;\r\n        if (bool) {\r\n            cc.audioEngine.stopAll();\r\n            this.forbidHandle();\r\n            let item = fgui.UIPackage.getItemByURL(this._title[\"_sound\"]);\r\n            let audio: cc.AudioClip = await loadResource(item.file, cc.AudioClip);\r\n            let audioId = cc.audioEngine.play(audio, false, 1);\r\n            cc.audioEngine.setFinishCallback(audioId, () => {\r\n                let state: any = globalThis._.cloneDeep(this._state);\r\n                state.title = false;\r\n                this.updateState(state);\r\n            });\r\n        } else {\r\n            this.disableForbidHandle();\r\n        }\r\n    }\r\n\r\n    playBoxSpeak(bool: boolean) {\r\n        if (bool) {\r\n\r\n            this._box3D.animationName = 'sjq_idle1to2';\r\n\r\n            cc.tween(this._box3D)\r\n                .delay(0.3)\r\n                .call(() => {\r\n                    this._box3D.animationName = 'sjq_idle2';\r\n                })\r\n                .start()\r\n\r\n            cc.audioEngine.stopAll();\r\n            this.forbidHandle();\r\n            this.playBoxSound();\r\n\r\n        } else {\r\n            this._c2.selectedIndex = 0;\r\n            this.disableForbidHandle();\r\n        }\r\n    }\r\n\r\n    async playBoxSound() {\r\n\r\n        for (let i = 0; i < this._paoShow.length; i++) {\r\n            this._paoShow[i].alpha = 0;\r\n        }\r\n\r\n        cc.tween(this)\r\n            .delay(0.5)\r\n            .call(() => {\r\n\r\n                this._c2.selectedIndex = 1;\r\n                this.playPaoShowAnimate(0);\r\n            })\r\n            .start();\r\n\r\n        let audioId = cc.audioEngine.play(this._boxSound, false, 1);\r\n        cc.audioEngine.setFinishCallback(audioId, () => {\r\n            this._box3D.animationName = 'sjq_idle';\r\n            this.disableForbidHandle();\r\n            for (let i = 0; i < this._paoShow.length; i++) {\r\n                this._paoShow[i].alpha = 0;\r\n            }\r\n            this._c2.selectedIndex = 0;\r\n            let state: any = globalThis._.cloneDeep(this._state);\r\n            state.boxPlay = false;\r\n            state.canChoose = true;\r\n            this.updateState(state);\r\n\r\n        });\r\n    }\r\n\r\n    playPaoShowAnimate(index: number) {\r\n\r\n        cc.tween(this._paoShow[index])\r\n            .to(1.0, { alpha: 1 })\r\n            .call(() => {\r\n                index++;\r\n                if (index < this._paoShow.length) {\r\n                    this.playPaoShowAnimate(index);\r\n                }\r\n            })\r\n            .start()\r\n\r\n    }\r\n\r\n    answerFeedback(bool: boolean) {\r\n        if (!this.feedback) return;\r\n        let feedback: any = cc.instantiate(this.feedback);\r\n        feedback.x = 960;\r\n        feedback.y = 540;\r\n        let feedbackJs: any = feedback.getComponent(cc.Component);\r\n        feedbackJs.init(bool);\r\n        feedback.parent = cc.find(\"Canvas\").parent;\r\n\r\n        setTimeout(() => {\r\n            feedback.destroy();\r\n            let state: any = globalThis._.cloneDeep(this._state);\r\n            state.submit = this.submitType.No;\r\n            this.updateState(state);\r\n        }, 2000);\r\n    }\r\n\r\n\r\n    /**\r\n     * 点击指引\r\n     * @param obj 点击对象\r\n     */\r\n    handTips2(obj: fgui.GObject) {\r\n        let hand = fgui.UIPackage.createObject(this._package, 'hand');\r\n        this._view.addChild(hand);\r\n        let tempX = obj.x;\r\n        let tempY = obj.y;\r\n\r\n        hand.x = tempX;\r\n        hand.y = tempY;\r\n\r\n        cc.tween(hand).to(0.3, {\r\n            x: tempX - 30,\r\n            y: tempY - 30\r\n        }).to(0.3, {\r\n            x: tempX,\r\n            y: tempY\r\n        }).to(0.3, {\r\n            x: tempX - 30,\r\n            y: tempY - 30\r\n        }).to(0.3, {\r\n            x: tempX,\r\n            y: tempY\r\n        }).call(() => {\r\n            this._view.removeChild(hand);\r\n            hand = null;\r\n            let state: any = globalThis._.cloneDeep(this._state);\r\n            state.submit = this.submitType.No;\r\n            this.updateState(state)\r\n        }).start();\r\n    }\r\n\r\n    // 运行时 禁止操作\r\n    forbidHandle() {\r\n        console.log('===  运行时 禁止操作 =====');\r\n        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n        if (!handleMask) {\r\n            let handleMask = new cc.Node('handleMask');\r\n            handleMask.addComponent(cc.BlockInputEvents);\r\n            handleMask.parent = this._worldRoot;\r\n            handleMask.width = 1920;\r\n            handleMask.height = 1080;\r\n            handleMask.x = 960;\r\n            handleMask.y = 540;\r\n        }\r\n    }\r\n\r\n    // 消除禁止\r\n    disableForbidHandle() {\r\n        let handleMask = this._worldRoot.getChildByName('handleMask');\r\n        if (handleMask) handleMask.destroy();\r\n    }\r\n\r\n    // 注册状态，及获取状态的方法\r\n    registerState() {\r\n        if (window['GlobalData'].sample.registerState) window['GlobalData'].sample.registerState.call(this);\r\n    }\r\n\r\n    // 解除状态，及获取状态的方法\r\n    relieveState() {\r\n        if (window['GlobalData'].sample.relieveState) window['GlobalData'].sample.relieveState.call(this);\r\n    }\r\n\r\n    // 本组件状态合并到全局\r\n    mergeState() {\r\n        if (window['GlobalData'].sample.mergeState) window['GlobalData'].sample.mergeState.call(this);\r\n    }\r\n\r\n    onEnable() {\r\n        this.registerState();\r\n    }\r\n\r\n    onDisable() {\r\n        cc.tween(this._box3D).stop();\r\n        cc.tween(this).stop();\r\n        this.relieveState();\r\n        cc.audioEngine.stopAll();\r\n    }\r\n}\r\n"
        }
    ]
}