window.__require=function t(e,i,r){function n(a,s){if(!i[a]){if(!e[a]){var h=a.split("/");if(h=h[h.length-1],!e[h]){var l="function"==typeof __require&&__require;if(!s&&l)return l(h,!0);if(o)return o(h,!0);throw new Error("Cannot find module '"+a+"'")}a=h}var d=i[a]={exports:{}};e[a][0].call(d.exports,function(t){return n(e[a][1][t]||t)},d,d.exports,t,e,i,r)}return i[a].exports}for(var o="function"==typeof __require&&__require,a=0;a<r.length;a++)n(r[a]);return n}({"dragAnswer-model01-v1":[function(t,e,i){"use strict";cc._RF.push(e,"a13c8/eIVFLEpkoqHBFYILF","dragAnswer-model01-v1");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),o=this&&this.__decorate||function(t,e,i,r){var n,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});var a=window.GlobalData.utils.pointBelongArea,s=cc._decorator,h=s.ccclass,l=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._grids=[],e._cache={},e._scheduleTime=.3,e._state={},e}return n(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t,this.updateUi(this._state),this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._dragBtn=this._view.getChild("dragBtn").asButton,this._cache.dragOrigin=this.getOriginValue(this._dragBtn),this._dragBtn.draggable=!0,this._dragBtn.on(fgui.Event.DRAG_START,this._onDragStart,this),this._dragBtn.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),this._dragBtn.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._btnBox=this._view.getChild("btnBox").asButton,this._btnBox.on(fgui.Event.CLICK,this._onClick,this);for(var t=this._btnBox.getChild("grids").asGroup,e=0;e<this._btnBox.numChildren;e++)if(this._btnBox.getChildAt(e).group==t){var i=this._btnBox.getChildAt(e).asLoader;this._grids.push(i)}this._state={drag:!1,dragBtn:{x:this._dragBtn.x,y:this._dragBtn.y},drops:0}},e.prototype.init=function(t){var e=t.Package,i=t.GComponent;this._view=fgui.UIPackage.createObject(e,i).asCom},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(){var t=globalThis._.cloneDeep(this._state);t.drag=!0,this.updateState(t)},e.prototype._onDragMove=function(){},e.prototype._onDragEnd=function(){console.log("_onDragEnd");var t=globalThis._.cloneDeep(this._state);if(a("rectangle",this._btnBox,this._dragBtn)){var e=this._dragBtn.getChild("icon").asLoader,i=this._grids.find(function(t){return null===t.url});i&&(i.url=e.url,t.drops=t.drops+1)}t.drag=!1,t.dragBtn={x:this._cache.dragOrigin.x,y:this._cache.dragOrigin.y},this.updateState(t)},e.prototype._onClick=function(){var t=globalThis._.cloneDeep(this._state),e=this._grids.findIndex(function(t){return null===t.url});0!==e&&(this._grids[-1==e?this._grids.length-1:e-1].url=null,t.drops=t.drops-1,this.updateState(t))},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t){if(t.drag)this._dragBtn.x=t.dragBtn.x,this._dragBtn.y=t.dragBtn.y;else{this._dragBtn.x!==this._cache.dragOrigin.x&&(this._dragBtn.x=this._cache.dragOrigin.x,this._dragBtn.y=this._cache.dragOrigin.y);for(var e=0;e<this._grids.length;e++){var i=this._grids[e];if(t.drops>e){if(!i.url){var r=this._dragBtn.getChild("icon").asLoader;i.url=r.url}}else i.url&&(i.url=null)}this._c1.selectedIndex=t.drops}},e.prototype.dragSchedule=function(){var t=globalThis._.cloneDeep(this._state);t.drag&&(this._state.dragBtn={x:this._dragBtn.x,y:this._dragBtn.y},t.dragBtn={x:this._dragBtn.x,y:this._dragBtn.y},this.mergeState())},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState()},o([h],e)}(cc.Component));i.default=l,cc._RF.pop()},{}]},{},["dragAnswer-model01-v1"]);