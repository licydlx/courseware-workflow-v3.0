window.GlobalData={courseData:{owner:"",name:"",userid:"",role:0,timestamp:"",signalingModel:1,monitored:null,stateShoot:null,firstLoad:!0},gameData:{resourceBundle:null,apiOrigin:"https://after-school-review-8cguaeaace9d.service.tcloudbase.com"},gameMsg:{EVENT_PREVPAGE:"EVENT_PREVPAGE",EVENT_NEXTPAGE:"EVENT_NEXTPAGE",EVENT_REVIEWAGAIN:"EVENT_REVIEWAGAIN",EVENT_REVIEWEXIT:"EVENT_REVIEWEXIT",EVENT_UPDATE_STATE:"EVENT_UPDATE_STATE"},monitorMessage:function(t){window.addEventListener("message",e=>{if(e)return e.data&&"string"==typeof e.data?t(JSON.parse(e.data)):console.log("message\u6709\u8bef\uff01")})},sendMessage:function(t){window!==window.parent&&window.parent.postMessage(JSON.stringify({method:"onFileMessage",handleData:t}),"*")},stateProxy:new Proxy({},{get:function(t,e){return e?"state"==e?t:t[e]:t},set:function(t,e,a){return""===a?t[e]="":t[e]?(t[e]=a,window.GlobalData.pubSub.emit(t,"SENDMESSAGE")):t[e]=a,!0},deleteProperty:(t,e)=>(delete t[e],!0)}),pubSub:{list:{},on(t,e,a){return this.list[t]=a?e.bind(a):e},emit(t,e){Object.keys(this.list).forEach(a=>{e?e==a&&this.list[a].call(this,t):this.list[a].call(this,t)})},off(t){let e={};for(const a in this.list)Object.is(t,a)||(e[a]=this.list[a]);this.list=e}},sample:{registerSendMessage:function(t){window.GlobalData.pubSub&&window.GlobalData.pubSub.on("SENDMESSAGE",t)},registerState:function(){let t=this.node.name;window.GlobalData.pubSub&&window.GlobalData.pubSub.on(t,this.getState.bind(this)),window.GlobalData.stateProxy&&(window.GlobalData.stateProxy[t]=this._state)},relieveState:function(){let t=this.node.name;window.GlobalData.pubSub&&window.GlobalData.pubSub.off(t,this.getState.bind(this)),window.GlobalData.stateProxy&&delete window.GlobalData.stateProxy[t]},mergeState:function(){let t=this.node.name;window.GlobalData.stateProxy&&window.GlobalData.stateProxy.hasOwnProperty(t)&&(window.GlobalData.stateProxy[t]=this._state)},dispatchFn:function(t,e,a){let o=new cc.Event.EventCustom(t,!0);o.setUserData(e),(a||this.node).dispatchEvent(o)},loadResource:(t,e)=>new Promise((a,o)=>{this.GlobalData.gameData.resourceBundle?this.GlobalData.gameData.resourceBundle.load(t,e,function(t,e){t?o(t):a(e)}):console.log("\u52a0\u8f7d\u4f9d\u8d56\u8d44\u6e90\u5931\u8d25\uff01")}),loadPrefab:(t,e)=>new Promise((a,o)=>{t.load(e,cc.Prefab,function(t,e){t?o(t):a(e)})}),loadBundle:t=>new Promise((e,a)=>{cc.assetManager.loadBundle(t,(t,o)=>{t?a(t):e(o)})}),ajax:(t,e)=>new Promise(a=>{let o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){let t=o.responseText;a(t)}},o.open(t,e,!0),o.send()}),async addOpenCount(t){let{courseName:e,courseVersion:a}=t;await this.GlobalData.sample.ajax("GET",`${this.GlobalData.gameData.apiOrigin}/addOpenCount?courseName=${e}&courseVersion=${a}`)?console.log("\u7d71\u8a08\u6253\u5f00-\u6210\u529f"):console.log("\u7d71\u8a08\u6253\u5f00-\u5931\u8d25")},async addFinishCount(t){let{courseName:e,courseVersion:a}=t;await this.GlobalData.sample.ajax("GET",`${this.GlobalData.gameData.apiOrigin}/addFinishCount?courseName=${e}&courseVersion=${a}`)?console.log("\u7d71\u8a08\u5b8c\u6210-\u6210\u529f"):console.log("\u7d71\u8a08\u5b8c\u6210-\u5931\u8d25")},nextPage:()=>{window.GlobalData.pubSub.emit({action:window.GlobalData.gameMsg.EVENT_NEXTPAGE},"controller-model01")},keepPage(){}},utils:{distinct:(t,e)=>{let a=t.concat(e),o=[],s={};for(let n of a)s[n]||(o.push(n),s[n]=1);return o},parseURL:t=>{let e={};return t.substring(t.indexOf("?")+1).split("&").forEach(t=>{let a=t.split("=");e[a[0]]=a[1]}),e}}};