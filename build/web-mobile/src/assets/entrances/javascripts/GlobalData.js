window.GlobalData={courseData:{owner:"",name:"",userid:"",role:0,timestamp:"",signalingModel:1,monitored:null,stateShoot:null,firstLoad:!0},gameData:{resourceBundle:null,apiOrigin:"https://after-school-review-8cguaeaace9d.service.tcloudbase.com"},gameMsg:{EVENT_PREVPAGE:"EVENT_PREVPAGE",EVENT_NEXTPAGE:"EVENT_NEXTPAGE",EVENT_REVIEWAGAIN:"EVENT_REVIEWAGAIN",EVENT_REVIEWEXIT:"EVENT_REVIEWEXIT",EVENT_UPDATE_STATE:"EVENT_UPDATE_STATE"},monitorMessage:function(e){window.addEventListener("message",t=>{if(t)return t.data&&"string"==typeof t.data?e(JSON.parse(t.data)):console.log("message\u6709\u8bef\uff01")})},sendMessage:function(e){window!==window.parent&&window.parent.postMessage(JSON.stringify({method:"onFileMessage",handleData:e}),"*")},stateProxy:new Proxy({},{get:function(e,t){return t?"state"==t?e:e[t]:e},set:function(e,t,a){return""===a?e[t]="":e[t]?(e[t]=a,window.GlobalData.pubSub.emit(e,"SENDMESSAGE")):e[t]=a,!0},deleteProperty:(e,t)=>(delete e[t],!0)}),pubSub:{list:{},on(e,t,a){return this.list[e]=a?t.bind(a):t},emit(e,t){Object.keys(this.list).forEach(a=>{t?t==a&&this.list[a].call(this,e):this.list[a].call(this,e)})},off(e){let t={};for(const a in this.list)Object.is(e,a)||(t[a]=this.list[a]);this.list=t}},sample:{registerSendMessage:function(e){window.GlobalData.pubSub&&window.GlobalData.pubSub.on("SENDMESSAGE",e)},registerState:function(){let e=this.node.name;window.GlobalData.pubSub&&window.GlobalData.pubSub.on(e,this.getState.bind(this)),window.GlobalData.stateProxy&&(window.GlobalData.stateProxy[e]=this._state)},relieveState:function(){let e=this.node.name;window.GlobalData.pubSub&&window.GlobalData.pubSub.off(e,this.getState.bind(this)),window.GlobalData.stateProxy&&delete window.GlobalData.stateProxy[e]},mergeState:function(){let e=this.node.name;window.GlobalData.stateProxy&&window.GlobalData.stateProxy.hasOwnProperty(e)&&(window.GlobalData.stateProxy[e]=this._state)},dispatchFn:function(e,t,a){let o=new cc.Event.EventCustom(e,!0);o.setUserData(t),(a||this.node).dispatchEvent(o)},loadResource:(e,t)=>new Promise((a,o)=>{this.GlobalData.gameData.resourceBundle?this.GlobalData.gameData.resourceBundle.load(e,t,function(e,t){e?o(e):a(t)}):console.log("\u52a0\u8f7d\u4f9d\u8d56\u8d44\u6e90\u5931\u8d25\uff01")}),loadPrefab:(e,t)=>new Promise((a,o)=>{e.load(t,cc.Prefab,function(e,t){e?o(e):a(t)})}),loadBundle:e=>new Promise((t,a)=>{cc.assetManager.loadBundle(e,(e,o)=>{e?a(e):t(o)})}),ajax:(e,t)=>new Promise(a=>{let o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState&&o.status>=200&&o.status<400){let e=o.responseText;a(e)}},o.open(e,t,!0),o.send()}),async addOpenCount(e){let{courseName:t,courseVersion:a}=e;await this.GlobalData.sample.ajax("GET",`${this.GlobalData.gameData.apiOrigin}/addOpenCount?courseName=${t}&courseVersion=${a}`)?console.log("\u7d71\u8a08\u6253\u5f00-\u6210\u529f"):console.log("\u7d71\u8a08\u6253\u5f00-\u5931\u8d25")},async addFinishCount(e){let{courseName:t,courseVersion:a}=e;await this.GlobalData.sample.ajax("GET",`${this.GlobalData.gameData.apiOrigin}/addFinishCount?courseName=${t}&courseVersion=${a}`)?console.log("\u7d71\u8a08\u5b8c\u6210-\u6210\u529f"):console.log("\u7d71\u8a08\u5b8c\u6210-\u5931\u8d25")},nextPage:()=>{window.GlobalData.pubSub.emit({action:window.GlobalData.gameMsg.EVENT_NEXTPAGE},"controller-model01")},keepPage(){}},utils:{distinct:(e,t)=>{let a=e.concat(t),o=[],n={};for(let s of a)n[s]||(o.push(s),n[s]=1);return o},parseURL:e=>{let t={};return e.substring(e.indexOf("?")+1).split("&").forEach(e=>{let a=e.split("=");t[a[0]]=a[1]}),t},pointBelongArea(e,t,a){switch(e){case"rectangle":{let e=a.x-t.x,o=a.y-t.y;return e>=0&&t.width>=e&&o>=0&&t.height>=o}}}}};