window.__require=function e(t,o,a){function n(l,i){if(!o[l]){if(!t[l]){var s=l.split("/");if(s=s[s.length-1],!t[s]){var c="function"==typeof __require&&__require;if(!i&&c)return c(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+l+"'")}l=s}var u=o[l]={exports:{}};t[l][0].call(u.exports,function(e){return n(t[l][1][e]||e)},u,u.exports,e,t,o,a)}return o[l].exports}for(var r="function"==typeof __require&&__require,l=0;l<a.length;l++)n(a[l]);return n}({"controller-model02-getMessage":[function(e,t,o){"use strict";cc._RF.push(t,"38cf7npfWtCAJkVDqM7GA1y","controller-model02-getMessage");var a=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(n,r){function l(e){try{s(a.next(e))}catch(t){r(t)}}function i(e){try{s(a.throw(e))}catch(t){r(t)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(l,i)}s((a=a.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var o,a,n,r,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(e){return function(t){return s([e,t])}}function s(r){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,a&&(n=2&r[0]?a.return:r[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,r[1])).done)return n;switch(a=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,a=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!(n=(n=l.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){l.label=r[1];break}if(6===r[0]&&l.label<n[1]){l.label=n[1],n=r;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(r);break}n[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(i){r=[6,i],a=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.getMessage=void 0,o.getMessage=function(e){return a(this,void 0,void 0,function(){var t,o,a,r,l,i,s,c,u,d,p;return n(this,function(){switch(console.log("getMessage"),t=globalThis._.cloneDeep(e),console.log(t),e.method){case"onJumpPage":this.onJumpConfig(e.toPage);break;case"onFileMessage":if(e.isRestore)return[2];if("EVENT_UPDATE_STATE"==e.handleData.action){if(!window.GlobalData.stateProxy)return[2];(o=window.GlobalData.courseData).name,a=o.userid,r=o.role,l=o.signalingModel,i=o.monitored,p=e.handleData.user,s=e.handleData.handleData,c=globalThis._.cloneDeep(window.GlobalData.stateProxy.state),e.handleData.toUser?(u=e.handleData.toUser).id!=a&&encodeURIComponent(u.nickname)!=a||Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}):(0==r&&(1==l&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}),2==l&&2==p.role&&((d=globalThis._.cloneDeep(window.GlobalData.stateProxy["formal-panle-model02"])).snapshoot[p.userid]=s,window.GlobalData.stateProxy["formal-panle-model02"]="",window.GlobalData.pubSub.emit(d,"formal-panle-model02"),!i||p.userid!=i&&p.name!=i||Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||"formal-panle-model02"==e||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}))),2==r&&(1==l&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}),2==l&&0==p.role&&p.signalingModel!=l&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}),3==l&&0==p.role&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))})),1!=r&&4!=r||0==p.role&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}))}break;case"onUserChange":if(0!=window.GlobalData.courseData.role)return[2];"create"==e.data.type&&(window.GlobalData.stateProxy["formal-panle-model02"]=""),"join"==e.data.type&&2==(p=e.data.users[0]).role&&(window.GlobalData.stateProxy["formal-panle-model02"]=""),"leave"==e.data.type&&2==(p=e.data.users[0]).role&&(window.GlobalData.stateProxy["formal-panle-model02"]=""),"join"==e.data.type&&(p=e.data.users[0],this.countDown(p)),this.node.parent.getChildByName("formal-panle-model02").getComponent(cc.Component).signalCallback(e.data)}return[2]})})},cc._RF.pop()},{}],"controller-model02-sendMessage":[function(e,t,o){"use strict";cc._RF.push(t,"0ce63p0zkxIho9b/0pkRj3M","controller-model02-sendMessage"),Object.defineProperty(o,"__esModule",{value:!0}),o.sendMessage=void 0,o.sendMessage=function(e,t){console.log("sendMessage");var o=globalThis._.cloneDeep(e);console.log(o);var a=window.GlobalData.courseData,n=a.name,r=a.userid,l=a.role,i=a.signalingModel,s=window.GlobalData.gameMsg.EVENT_UPDATE_STATE;window.GlobalData.sendMessage({action:s,toUser:t||"",user:{userid:r,role:l,name:n,signalingModel:i},handleData:e}),0==window.GlobalData.courseData.role&&cc.sys.localStorage.setItem("COURSE_SIGNALING_DB",JSON.stringify({timestamp:window.GlobalData.courseData.timestamp,state:e}))},cc._RF.pop()},{}],"controller-model02":[function(e,t,o){"use strict";cc._RF.push(t,"4ec5eaLDGdCuomOJd9um7kH","controller-model02");var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,a){var n,r=arguments.length,l=r<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,o,a);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(l=(r<3?n(l):r>3?n(t,o,l):n(t,o))||l);return r>3&&l&&Object.defineProperty(t,o,l),l},l=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(n,r){function l(e){try{s(a.next(e))}catch(t){r(t)}}function i(e){try{s(a.throw(e))}catch(t){r(t)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(l,i)}s((a=a.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var o,a,n,r,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(e){return function(t){return s([e,t])}}function s(r){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,a&&(n=2&r[0]?a.return:r[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,r[1])).done)return n;switch(a=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,a=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!(n=(n=l.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){l.label=r[1];break}if(6===r[0]&&l.label<n[1]){l.label=n[1],n=r;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(r);break}n[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(i){r=[6,i],a=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,u=(s.property,window.GlobalData),d=(u.gameData,u.monitorMessage),p=window.GlobalData.sample,f=p.loadPrefab,h=p.loadBundle,w=e("./controller-model02-sendMessage"),g=e("./controller-model02-getMessage"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pagePrefabs=[],t._toPage=null,t}return n(t,e),t.prototype.onLoad=function(){},t.prototype.init=function(e){return l(this,void 0,void 0,function(){var t,o,a,n,r,l,s,c,u,d,p;return i(this,function(i){switch(i.label){case 0:return e.pathConfig.resourceName?(this.identification(),window.GlobalData.courseData.timestamp=this.getTimestamp(),window.globalThis||(window.globalThis={},window.globalThis._=window._),this._configJson=e,fgui.GRoot.create(),t=""+e.pathConfig.remoteUrl+e.pathConfig.panelBundlePath+e.pathConfig.panelName,[4,h(t)]):(console.error("\u7d20\u6750\u8d44\u6e90\u672a\u914d\u7f6e\uff01"),[2]);case 1:return o=i.sent(),[4,f(o,o.name)];case 2:a=i.sent(),(n=cc.instantiate(a)).parent=cc.find("Canvas").parent,n.x=960,n.y=540,this._panel=n,2==window.GlobalData.courseData.role&&this._panel&&(this._panel.opacity=0),window.GlobalData.sample.registerSendMessage&&window.GlobalData.sample.registerSendMessage(w.sendMessage.bind(this)),r=0,i.label=3;case 3:return r<e.chapters.length?(l=""+e.pathConfig.remoteUrl+e.pathConfig.modelBundlePath+e.chapters[r].modelBundle,[4,h(l)]):[3,7];case 4:return s=i.sent(),[4,f(s,e.chapters[r].prefabName)];case 5:c=i.sent(),this._pagePrefabs[r]=c,i.label=6;case 6:return r++,[3,3];case 7:return u=""+e.pathConfig.remoteUrl+e.pathConfig.resourceBundlePath+e.pathConfig.resourceName,d=this,[4,h(u)];case 8:return d._resourceBundle=i.sent(),[4,this.loadResourcePackage(this._resourceBundle,e.pathConfig.packageName)];case 9:return i.sent(),p=globalThis._.cloneDeep(window.GlobalData.stateProxy.state),console.log(p),this.platformConfig(this._configJson.totalPages),[2]}})})},t.prototype.loadResourcePackage=function(e,t){return l(this,void 0,void 0,function(){return i(this,function(){return[2,new Promise(function(o){fgui.UIPackage.loadPackage(e,t,function(){console.log("loadResourcePackage"),o(!0)})})]})})},t.prototype.onJumpConfig=function(e){return l(this,void 0,void 0,function(){var t,o,a,n;return i(this,function(){return t=e-1,o=this._configJson.chapters[t],fgui.GRoot.inst.removeChildren(0,-1,!0),this._currentPageNode&&this._currentPageNode.destroy(),a=this._pagePrefabs[t],(n=cc.instantiate(a)).getComponent(cc.Component).init({Package:this._configJson.pathConfig.packageName,GComponent:o.uiPath}),n.parent=this.node,this._currentPageNode=n,window.GlobalData.courseData.stateShoot=globalThis._.cloneDeep(window.GlobalData.stateProxy.state),console.log(window.GlobalData.stateProxy.state),console.log(window.GlobalData.courseData.stateShoot),[2]})})},t.prototype.identification=function(){var e=(0,window.GlobalData.utils.parseURL)(window.location.href);for(var t in e)window.GlobalData.courseData.hasOwnProperty(t)&&(window.GlobalData.courseData[t]=e[t]);e.userid||(window.GlobalData.courseData.userid=e.name)},t.prototype.platformConfig=function(e){console.log("platformConfig"),d(g.getMessage.bind(this)),window.parent.postMessage(JSON.stringify({method:"onPagenum",totalPages:e}),"*"),window.parent.postMessage(JSON.stringify({method:"onLoadComplete",coursewareRatio:16/9}),"*")},t.prototype.resetPanel=function(){if(this._panel){var e=this._panel.getComponent(cc.Component);window.GlobalData.stateProxy[this._panel.name]="",e.reset()}},t.prototype.hasRegister=function(e){return new Promise(function(t){var o=setInterval(function(){window.GlobalData.stateProxy[e]&&(clearInterval(o),t(!0))},30)})},t.prototype.recoverState=function(){if(window.GlobalData.courseData.firstLoad){var e=cc.sys.localStorage.getItem("COURSE_SIGNALING_DB");if(!e)return;var t=JSON.parse(e);if(t&&0==window.GlobalData.courseData.role&&(parseInt(this.getTimestamp())-parseInt(t.timestamp))/60<35){window.GlobalData.courseData.timestamp=t.timestamp;var o=globalThis._.cloneDeep(window.GlobalData.stateProxy.state);Object.keys(o).forEach(function(e){globalThis._.isEqual(o[e],t.state[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(t.state[e],e))})}window.GlobalData.courseData.firstLoad=!1}},t.prototype.getTimestamp=function(){return(+new Date).toString().substr(0,10)},t.prototype.countDown=function(e){var t=this,o=6;this.schedule(function(){1==--o&&t.sendInfo(e)},1,5,0)},t.prototype.sendInfo=function(e){var t=globalThis._.cloneDeep(window.GlobalData.stateProxy.state);w.sendMessage(t,e)},r([c],t)}(cc.Component);o.default=b,cc._RF.pop()},{"./controller-model02-getMessage":"controller-model02-getMessage","./controller-model02-sendMessage":"controller-model02-sendMessage"}]},{},["controller-model02-getMessage","controller-model02-sendMessage","controller-model02"]);