window.__require=function e(t,o,a){function n(i,l){if(!o[i]){if(!t[i]){var s=i.split("/");if(s=s[s.length-1],!t[s]){var c="function"==typeof __require&&__require;if(!l&&c)return c(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+i+"'")}i=s}var u=o[i]={exports:{}};t[i][0].call(u.exports,function(e){return n(t[i][1][e]||e)},u,u.exports,e,t,o,a)}return o[i].exports}for(var r="function"==typeof __require&&__require,i=0;i<a.length;i++)n(a[i]);return n}({"controller-model02-getMessage":[function(e,t,o){"use strict";cc._RF.push(t,"38cf7npfWtCAJkVDqM7GA1y","controller-model02-getMessage");var a=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(n,r){function i(e){try{s(a.next(e))}catch(t){r(t)}}function l(e){try{s(a.throw(e))}catch(t){r(t)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,l)}s((a=a.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var o,a,n,r,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(e){return function(t){return s([e,t])}}function s(r){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,a&&(n=2&r[0]?a.return:r[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,r[1])).done)return n;switch(a=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,a=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){i.label=r[1];break}if(6===r[0]&&i.label<n[1]){i.label=n[1],n=r;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(r);break}n[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(l){r=[6,l],a=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.getMessage=void 0,o.getMessage=function(e){return a(this,void 0,void 0,function(){var t,o,a,r,i,l,s,c,u,p,d,f=this;return n(this,function(){switch(console.log("getMessage"),t=globalThis._.cloneDeep(e),console.log(t),e.method){case"onJumpPage":this.onJumpConfig(e.toPage);break;case"onFileMessage":if(e.isRestore)return[2];if("EVENT_UPDATE_STATE"==e.handleData.action){if(!window.GlobalData.stateProxy)return[2];(o=window.GlobalData.courseData).name,a=o.userid,r=o.role,i=o.signalingModel,l=o.monitored,d=e.handleData.user,s=e.handleData.handleData,c=globalThis._.cloneDeep(window.GlobalData.stateProxy.state),e.handleData.toUser?(u=e.handleData.toUser).id!=a&&encodeURIComponent(u.nickname)!=a||Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}):(0==r&&(1==i&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}),2==i&&2==d.role&&((p=globalThis._.cloneDeep(window.GlobalData.stateProxy[this._panel.name])).snapshoot[d.userid]=s,window.GlobalData.stateProxy[this._panel.name]="",window.GlobalData.pubSub.emit(p,this._panel.name),!l||d.userid!=l&&d.name!=l||Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||e==f._panel.name||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}))),2==r&&(1==i&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}),2==i&&0==d.role&&d.signalingModel!=i&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}),3==i&&0==d.role&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))})),1!=r&&4!=r||0==d.role&&Object.keys(c).forEach(function(e){globalThis._.isEqual(c[e],s[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(s[e],e))}))}break;case"onUserChange":if(0!=window.GlobalData.courseData.role)return[2];"create"==e.data.type&&(window.GlobalData.stateProxy[this._panel.name]=""),"join"==e.data.type&&2==(d=e.data.users[0]).role&&(window.GlobalData.stateProxy[this._panel.name]=""),"leave"==e.data.type&&2==(d=e.data.users[0]).role&&(window.GlobalData.stateProxy[this._panel.name]=""),"join"==e.data.type&&(d=e.data.users[0],this.countDown(d)),this._panel.getComponent(cc.Component).signalCallback(e.data)}return[2]})})},cc._RF.pop()},{}],"controller-model02-sendMessage":[function(e,t,o){"use strict";cc._RF.push(t,"0ce63p0zkxIho9b/0pkRj3M","controller-model02-sendMessage"),Object.defineProperty(o,"__esModule",{value:!0}),o.sendMessage=void 0,o.sendMessage=function(e,t){console.log("sendMessage");var o=globalThis._.cloneDeep(e);console.log(o);var a=window.GlobalData.courseData,n=a.name,r=a.userid,i=a.role,l=a.signalingModel,s=window.GlobalData.gameMsg.EVENT_UPDATE_STATE;window.GlobalData.sendMessage({action:s,toUser:t||"",user:{userid:r,role:i,name:n,signalingModel:l},handleData:e}),0==window.GlobalData.courseData.role&&cc.sys.localStorage.setItem("COURSE_SIGNALING_DB",JSON.stringify({timestamp:window.GlobalData.courseData.timestamp,state:e}))},cc._RF.pop()},{}],"controller-model02":[function(e,t,o){"use strict";cc._RF.push(t,"4ec5eaLDGdCuomOJd9um7kH","controller-model02");var a,n=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,a){var n,r=arguments.length,i=r<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,o):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,a);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(i=(r<3?n(i):r>3?n(t,o,i):n(t,o))||i);return r>3&&i&&Object.defineProperty(t,o,i),i},i=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(n,r){function i(e){try{s(a.next(e))}catch(t){r(t)}}function l(e){try{s(a.throw(e))}catch(t){r(t)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,l)}s((a=a.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){var o,a,n,r,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(e){return function(t){return s([e,t])}}function s(r){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,a&&(n=2&r[0]?a.return:r[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,r[1])).done)return n;switch(a=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,a=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){i.label=r[1];break}if(6===r[0]&&i.label<n[1]){i.label=n[1],n=r;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(r);break}n[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(l){r=[6,l],a=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator,c=s.ccclass,u=(s.property,window.GlobalData.monitorMessage),p=window.GlobalData.sample,d=p.loadPrefab,f=p.loadBundle,h=e("./controller-model02-sendMessage"),w=e("./controller-model02-getMessage"),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pagePrefabs=[],t._toPage=null,t}return n(t,e),t.prototype.onLoad=function(){},t.prototype.init=function(e){return i(this,void 0,void 0,function(){var t,o,a,n,r,i,s,c,u,p;return l(this,function(l){switch(l.label){case 0:return e.pathConfig.resourceName?(this.identification(),window.GlobalData.courseData.timestamp=this.getTimestamp(),window.globalThis||(window.globalThis={},window.globalThis._=window._),this._configJson=e,fgui.GRoot.create(),t=""+e.pathConfig.remoteUrl+e.pathConfig.panelBundlePath+e.pathConfig.panelName,[4,f(t)]):(console.error("\u7d20\u6750\u8d44\u6e90\u672a\u914d\u7f6e\uff01"),[2]);case 1:return o=l.sent(),[4,d(o,o.name)];case 2:a=l.sent(),(n=cc.instantiate(a)).parent=cc.find("Canvas").parent,n.x=960,n.y=540,this._panel=n,2==window.GlobalData.courseData.role&&this._panel&&(this._panel.opacity=0),window.GlobalData.sample.registerSendMessage&&window.GlobalData.sample.registerSendMessage(h.sendMessage.bind(this)),r=0,l.label=3;case 3:return r<e.chapters.length?(i=""+e.pathConfig.remoteUrl+e.pathConfig.modelBundlePath+e.chapters[r].modelBundle,[4,f(i)]):[3,7];case 4:return s=l.sent(),[4,d(s,e.chapters[r].prefabName)];case 5:c=l.sent(),this._pagePrefabs[r]=c,l.label=6;case 6:return r++,[3,3];case 7:return u=""+e.pathConfig.remoteUrl+e.pathConfig.resourceBundlePath+e.pathConfig.resourceName,p=this,[4,f(u)];case 8:return p._resourceBundle=l.sent(),[4,this.loadResourcePackage(this._resourceBundle,e.pathConfig.packageName)];case 9:return l.sent(),this.platformConfig(this._configJson.totalPages),[2]}})})},t.prototype.loadResourcePackage=function(e,t){return i(this,void 0,void 0,function(){return l(this,function(){return[2,new Promise(function(o){fgui.UIPackage.loadPackage(e,t,function(){o(!0)})})]})})},t.prototype.onJumpConfig=function(e){return i(this,void 0,void 0,function(){var t,o,a,n;return l(this,function(){return t=e-1,o=this._configJson.chapters[t],fgui.GRoot.inst.removeChildren(0,-1,!0),this._currentPageNode&&this._currentPageNode.destroy(),a=this._pagePrefabs[t],(n=cc.instantiate(a)).getComponent(cc.Component).init({Package:this._configJson.pathConfig.packageName,GComponent:o.uiPath,config:o.config}),n.parent=this.node,this._currentPageNode=n,this.resetPanel(),window.GlobalData.courseData.stateShoot=globalThis._.cloneDeep(window.GlobalData.stateProxy.state),this.recoverState(),[2]})})},t.prototype.identification=function(){var e=(0,window.GlobalData.utils.parseURL)(window.location.href);for(var t in e)window.GlobalData.courseData.hasOwnProperty(t)&&(window.GlobalData.courseData[t]=e[t]);e.userid||(window.GlobalData.courseData.userid=e.name)},t.prototype.platformConfig=function(e){u(w.getMessage.bind(this)),window.parent.postMessage(JSON.stringify({method:"onPagenum",totalPages:e}),"*"),window.parent.postMessage(JSON.stringify({method:"onLoadComplete",coursewareRatio:16/9}),"*")},t.prototype.resetPanel=function(){if(this._panel){var e=this._panel.getComponent(cc.Component);window.GlobalData.stateProxy[this._panel.name]="",e.reset()}},t.prototype.recoverState=function(){if(window.GlobalData.courseData.firstLoad){var e=cc.sys.localStorage.getItem("COURSE_SIGNALING_DB");if(!e)return;var t=JSON.parse(e);if(t&&0==window.GlobalData.courseData.role&&(parseInt(this.getTimestamp())-parseInt(t.timestamp))/60<35){window.GlobalData.courseData.timestamp=t.timestamp;var o=globalThis._.cloneDeep(window.GlobalData.stateProxy.state);Object.keys(o).forEach(function(e){globalThis._.isEqual(o[e],t.state[e])||(window.GlobalData.stateProxy[e]="",window.GlobalData.pubSub.emit(t.state[e],e))})}window.GlobalData.courseData.firstLoad=!1}},t.prototype.getTimestamp=function(){return(+new Date).toString().substr(0,10)},t.prototype.countDown=function(e){var t=this,o=6;this.schedule(function(){1==--o&&t.sendInfo(e)},1,5,0)},t.prototype.sendInfo=function(e){var t=globalThis._.cloneDeep(window.GlobalData.stateProxy.state);h.sendMessage(t,e)},r([c],t)}(cc.Component);o.default=b,cc._RF.pop()},{"./controller-model02-getMessage":"controller-model02-getMessage","./controller-model02-sendMessage":"controller-model02-sendMessage"}]},{},["controller-model02-getMessage","controller-model02-sendMessage","controller-model02"]);