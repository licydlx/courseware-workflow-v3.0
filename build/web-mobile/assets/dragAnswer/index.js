window.__require=function t(e,i,n){function o(r,a){if(!i[r]){if(!e[r]){var h=r.split("/");if(h=h[h.length-1],!e[h]){var l="function"==typeof __require&&__require;if(!a&&l)return l(h,!0);if(s)return s(h,!0);throw new Error("Cannot find module '"+r+"'")}r=h}var d=i[r]={exports:{}};e[r][0].call(d.exports,function(t){return o(e[r][1][t]||t)},d,d.exports,t,e,i,n)}return i[r].exports}for(var s="function"==typeof __require&&__require,r=0;r<n.length;r++)o(n[r]);return o}({"dragAnswer-model01-v1":[function(t,e,i){"use strict";cc._RF.push(e,"a13c8/eIVFLEpkoqHBFYILF","dragAnswer-model01-v1");var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__decorate||function(t,e,i,n){var o,s=arguments.length,r=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(s<3?o(r):s>3?o(e,i,r):o(e,i))||r);return s>3&&r&&Object.defineProperty(e,i,r),r};Object.defineProperty(i,"__esModule",{value:!0});var r=window.GlobalData.utils.pointBelongArea,a=cc._decorator,h=a.ccclass,l=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._grids=[],e._cache={},e._scheduleTime=.3,e._dragging=!1,e._answer=0,e._state={},e}return o(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t,this.updateUi(this._state),this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._submit=this._view.getChild("submit").asButton,this._submit.on(fgui.Event.CLICK,this._clickSubmit,this),this._dragBtn=this._view.getChild("dragBtn").asButton,this._cache.dragOrigin=this.getOriginValue(this._dragBtn),this._dragBtn.draggable=!0,this._dragBtn.on(fgui.Event.DRAG_START,this._onDragStart,this),this._dragBtn.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),this._dragBtn.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._btnBox=this._view.getChild("btnBox").asButton,this._btnBox.on(fgui.Event.CLICK,this._onClick,this);for(var t=this._btnBox.getChild("grids").asGroup,e=0;e<this._btnBox.numChildren;e++)if(this._btnBox.getChildAt(e).group==t){var i=this._btnBox.getChildAt(e).asLoader;this._grids.push(i)}this._state={drag:"end",dragBtn:{x:this._dragBtn.x,y:this._dragBtn.y},drops:0,submit:!1,answer:!1}},e.prototype.init=function(t){var e=t.Package,i=t.GComponent,n=t.config,o=n.answer,s=n.ae;for(var r in this._view=fgui.UIPackage.createObject(e,i).asCom,s)s[r]&&(this[r]={},s[r].component&&(this[r].component=fgui.UIPackage.createObject(e,s[r].component).asCom),s[r].pos&&(this[r].pos=s[r].pos));o&&(this._answer=o)},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(t){t.captureTouch();var e=globalThis._.cloneDeep(this._state);e.drag="start",e.answer=e.drops===this._answer,this.updateState(e)},e.prototype._onDragMove=function(){this._dragging=!0},e.prototype._onDragEnd=function(){this._dragging=!1;var t=globalThis._.cloneDeep(this._state);if(r("rectangle",this._btnBox,this._dragBtn)){var e=this._dragBtn.getChild("icon").asLoader,i=this._grids.find(function(t){return null===t.url});i&&(i.url=e.url,t.drops=t.drops+1)}t.dragBtn={x:this._cache.dragOrigin.x,y:this._cache.dragOrigin.y},t.drag="end",t.answer=t.drops===this._answer,this.updateState(t)},e.prototype._onClick=function(){var t=globalThis._.cloneDeep(this._state),e=this._grids.findIndex(function(t){return null===t.url});0!==e&&(this._grids[-1==e?this._grids.length-1:e-1].url=null,t.answer=t.drops===this._answer,t.drops=t.drops-1,this.updateState(t))},e.prototype._clickSubmit=function(){var t=globalThis._.cloneDeep(this._state);t.answer=t.drops===this._answer,t.submit=!0,this.updateState(t)},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t){if("move"==t.drag&&(this._dragBtn.x=t.dragBtn.x,this._dragBtn.y=t.dragBtn.y),"end"==t.drag){this._dragBtn.x=this._cache.dragOrigin.x,this._dragBtn.y=this._cache.dragOrigin.y;for(var e=0;e<this._grids.length;e++){var i=this._grids[e];if(t.drops>e){if(!i.url){var n=this._dragBtn.getChild("icon").asLoader;i.url=n.url}}else i.url&&(i.url=null)}this._c1.selectedIndex=t.drops,t.answer||this.onLibraHint(),t.submit&&(t.drops?this.answerFeedback(t.answer):this.onHandleGuide())}},e.prototype.answerFeedback=function(t){var e,i,n=this,o=globalThis._.cloneDeep(this._state);t?(e=this.rightFeed.component,i=this.rightFeed.pos):(e=this.errorFeed.component,i=this.errorFeed.pos),fgui.GRoot.inst.addChild(e),i?(e.x=(fgui.GRoot.inst.width-e.width)/2+i.x,e.y=(fgui.GRoot.inst.height-e.height)/2+i.y):e.y=(fgui.GRoot.inst.height-e.height)/2,e.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(e),o.submit=!1,n.updateState(o)},2)},e.prototype.onLibraHint=function(){var t=this;this.lineBlink&&(fgui.GRoot.inst.addChild(this.lineBlink.component),this.lineBlink.pos?(this.lineBlink.component.x=(fgui.GRoot.inst.width-this.lineBlink.component.width)/2+this.lineBlink.pos.x,this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2+this.lineBlink.pos.y):this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2,this.lineBlink.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.lineBlink.component)}))},e.prototype.onHandleGuide=function(){var t=this;if(this.handleGuide){var e=globalThis._.cloneDeep(this._state);fgui.GRoot.inst.addChild(this.handleGuide.component),this.handleGuide.pos?(this.handleGuide.component.x=(fgui.GRoot.inst.width-this.handleGuide.component.width)/2+this.handleGuide.pos.x,this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2+this.handleGuide.pos.y):this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2,this.handleGuide.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.handleGuide.component),e.submit=!1,t.updateState(e)},2)}},e.prototype.dragSchedule=function(){if(this._dragging){var t=globalThis._.cloneDeep(this._state);t.drag="move",t.dragBtn={x:this._dragBtn.x,y:this._dragBtn.y},this.updateState(t)}},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState()},s([h],e)}(cc.Component));i.default=l,cc._RF.pop()},{}]},{},["dragAnswer-model01-v1"]);