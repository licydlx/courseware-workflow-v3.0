window.__require=function t(e,i,n){function r(o,s){if(!i[o]){if(!e[o]){var h=o.split("/");if(h=h[h.length-1],!e[h]){var l="function"==typeof __require&&__require;if(!s&&l)return l(h,!0);if(a)return a(h,!0);throw new Error("Cannot find module '"+o+"'")}o=h}var d=i[o]={exports:{}};e[o][0].call(d.exports,function(t){return r(e[o][1][t]||t)},d,d.exports,t,e,i,n)}return i[o].exports}for(var a="function"==typeof __require&&__require,o=0;o<n.length;o++)r(n[o]);return r}({"dragAnswer-model01-v1":[function(t,e,i){"use strict";cc._RF.push(e,"a13c8/eIVFLEpkoqHBFYILF","dragAnswer-model01-v1");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=this&&this.__decorate||function(t,e,i,n){var r,a=arguments.length,o=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(a<3?r(o):a>3?r(e,i,o):r(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(i,"__esModule",{value:!0});var o=window.GlobalData.utils.pointBelongArea,s=cc._decorator,h=s.ccclass,l=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._grids=[],e._cache={},e._scheduleTime=.3,e._dragging=!1,e._answer=0,e._state={},e}return r(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t,this.updateUi(this._state),this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._submit=this._view.getChild("submit").asButton,this._submit.on(fgui.Event.CLICK,this._clickSubmit,this),this._dragBtn=this._view.getChild("dragBtn").asButton,this._cache.dragOrigin=this.getOriginValue(this._dragBtn),this._dragBtn.draggable=!0,this._dragBtn.on(fgui.Event.DRAG_START,this._onDragStart,this),this._dragBtn.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),this._dragBtn.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._btnBox=this._view.getChild("btnBox").asButton,this._btnBox.on(fgui.Event.CLICK,this._onClick,this);for(var t=this._btnBox.getChild("grids").asGroup,e=0;e<this._btnBox.numChildren;e++)if(this._btnBox.getChildAt(e).group==t){var i=this._btnBox.getChildAt(e).asLoader;this._grids.push(i)}this._state={drag:"end",dragBtn:{x:this._dragBtn.x,y:this._dragBtn.y},drops:0,submit:!1,answer:!1}},e.prototype.init=function(t){var e=t.Package,i=t.GComponent,n=t.config.answer;this._view=fgui.UIPackage.createObject(e,i).asCom,this._handleGuide01=fgui.UIPackage.createObject(e,"handleGuide01").asCom,this._lineBlink01=fgui.UIPackage.createObject(e,"lineBlink01").asCom,n&&(this._answer=n)},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(t){t.captureTouch();var e=globalThis._.cloneDeep(this._state);e.drag="start",e.answer=e.drops===this._answer,this.updateState(e)},e.prototype._onDragMove=function(){this._dragging=!0},e.prototype._onDragEnd=function(){this._dragging=!1;var t=globalThis._.cloneDeep(this._state);if(o("rectangle",this._btnBox,this._dragBtn)){var e=this._dragBtn.getChild("icon").asLoader,i=this._grids.find(function(t){return null===t.url});i&&(i.url=e.url,t.drops=t.drops+1)}t.dragBtn={x:this._cache.dragOrigin.x,y:this._cache.dragOrigin.y},t.drag="end",t.answer=t.drops===this._answer,this.updateState(t)},e.prototype._onClick=function(){var t=globalThis._.cloneDeep(this._state),e=this._grids.findIndex(function(t){return null===t.url});0!==e&&(this._grids[-1==e?this._grids.length-1:e-1].url=null,t.answer=t.drops===this._answer,t.drops=t.drops-1,this.updateState(t))},e.prototype._clickSubmit=function(){var t=globalThis._.cloneDeep(this._state);t.answer=t.drops===this._answer,t.submit=!0,this.updateState(t)},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t){if("start"==t.drag&&(t.answer||this.libraHint()),"move"==t.drag&&(this._dragBtn.x=t.dragBtn.x,this._dragBtn.y=t.dragBtn.y),"end"==t.drag){this._dragBtn.x!==this._cache.dragOrigin.x&&(this._dragBtn.x=this._cache.dragOrigin.x,this._dragBtn.y=this._cache.dragOrigin.y);for(var e=0;e<this._grids.length;e++){var i=this._grids[e];if(t.drops>e){if(!i.url){var n=this._dragBtn.getChild("icon").asLoader;i.url=n.url}}else i.url&&(i.url=null)}this._c1.selectedIndex=t.drops,t.submit&&(t.drops?t.answer:this.handleGuide())}},e.prototype.libraHint=function(){var t=this;fgui.GRoot.inst.addChild(this._lineBlink01),this._lineBlink01.y=(fgui.GRoot.inst.height-this._lineBlink01.height)/2,this._lineBlink01.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t._lineBlink01)})},e.prototype.handleGuide=function(){var t=this,e=globalThis._.cloneDeep(this._state);fgui.GRoot.inst.addChild(this._handleGuide01),this._handleGuide01.y=(fgui.GRoot.inst.height-this._handleGuide01.height)/2,this._handleGuide01.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t._handleGuide01),e.submit=!1,t.updateState(e)},2)},e.prototype.dragSchedule=function(){if(this._dragging){var t=globalThis._.cloneDeep(this._state);t.drag="move",t.dragBtn={x:this._dragBtn.x,y:this._dragBtn.y},this.updateState(t)}},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState()},a([h],e)}(cc.Component));i.default=l,cc._RF.pop()},{}]},{},["dragAnswer-model01-v1"]);