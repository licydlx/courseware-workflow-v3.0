window.__require=function t(e,i,n){function o(a,s){if(!i[a]){if(!e[a]){var l=a.split("/");if(l=l[l.length-1],!e[l]){var c="function"==typeof __require&&__require;if(!s&&c)return c(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+a+"'")}a=l}var h=i[a]={exports:{}};e[a][0].call(h.exports,function(t){return o(e[a][1][t]||t)},h,h.exports,t,e,i,n)}return i[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)o(n[a]);return o}({"dragAnswer-model01-v1":[function(t,e,i){"use strict";cc._RF.push(e,"a13c8/eIVFLEpkoqHBFYILF","dragAnswer-model01-v1");var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},a=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function a(t){try{l(n.next(t))}catch(e){r(e)}}function s(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}l((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return l([t,e])}}function l(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0});var l=window.GlobalData.sample,c=l.loadBundle,h=l.loadPrefab,d=l.loadResource,u=window.GlobalData.utils.pointBelongArea,p=cc._decorator,g=p.ccclass,f=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._grids=[],e._cache={},e._scheduleTime=.3,e._dragging=!1,e._answer=0,e._state={},e}return o(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this.updateUi(this._state,t),this._state=t,this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._worldRoot=cc.find("Canvas").parent,this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._c2=this._view.getController("c2"),this._c2&&(this._c2.selectedIndex=1,this._c2.selectedIndex=0),this._submit=this._view.getChild("submit").asButton,this._submit&&this._submit.on(fgui.Event.CLICK,this._clickSubmit,this),this._titleTrigger=this._view.getChild("titleTrigger").asLoader,this._titleTrigger&&this._titleTrigger.on(fgui.Event.CLICK,this._clickTitle,this),this._title=this._view.getChild("title").asButton,this._dragBtn=this._view.getChild("dragBtn").asButton,this._cache.dragOrigin=this.getOriginValue(this._dragBtn),this._dragBtn.draggable=!0,this._dragBtn.on(fgui.Event.TOUCH_BEGIN,this._onDragStart,this),this._dragBtn.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),this._dragBtn.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._btnBox=this._view.getChild("btnBox").asButton,this._btnBox&&this._btnBox.on(fgui.Event.CLICK,this._clickRemove,this);for(var t=this._btnBox.getChild("grids").asGroup,e=this._btnBox.numChildren-1;e>-1;e--)if(this._btnBox.getChildAt(e).group==t){var i=this._btnBox.getChildAt(e).asLoader;this._grids.push(i)}this._state={drag:"end",dragBtn:{x:this._dragBtn.x,y:this._dragBtn.y},title:!1,drops:0,submit:!1,answer:!1},this.disableForbidHandle()},e.prototype.init=function(t){return a(this,void 0,void 0,function(){var e,i,n,o,r,a,l,d,u,p,g,f,_,b,y,v;return s(this,function(s){switch(s.label){case 0:for(u in e=t.pathConfig,i=t.model,n=t.components,o=e.packageName,r=i.uiPath,a=i.config,l=a.answer,d=a.ae,this._view=fgui.UIPackage.createObject(o,r).asCom,d)d[u]&&(this[u]={},d[u].component&&(this[u].component=fgui.UIPackage.createObject(o,d[u].component).asCom),d[u].pos&&(this[u].pos=d[u].pos));if(l&&(this._answer=l),!n)return[3,5];for(g in p=[],n)p.push(g);f=0,s.label=1;case 1:return f<p.length?(_=p[f],b=""+e.remoteUrl+e.componentBundlePath+n[_].bundleName,[4,c(b)]):[3,5];case 2:return y=s.sent(),[4,h(y,n[_].prefabName)];case 3:v=s.sent(),this[_]=v,s.label=4;case 4:return f++,[3,1];case 5:return[2]}})})},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(t){t.captureTouch();var e=globalThis._.cloneDeep(this._state);e.drag="start",e.answer=e.drops===this._answer,this.updateState(e)},e.prototype._onDragMove=function(){this._dragging=!0},e.prototype._onDragEnd=function(){this._dragging=!1;var t=globalThis._.cloneDeep(this._state);u("rectangle",this._btnBox,this._dragBtn)&&(this._dragBtn.getChild("icon").asLoader,this._grids.find(function(t){return null===t.url})&&(t.drops=t.drops+1)),t.dragBtn={x:this._cache.dragOrigin.x,y:this._cache.dragOrigin.y},t.drag="end",t.answer=t.drops===this._answer,this.updateState(t)},e.prototype._clickRemove=function(){var t=globalThis._.cloneDeep(this._state);0!==this._grids.findIndex(function(t){return null===t.url})&&(t.drops=t.drops-1,t.answer=t.drops===this._answer,this.updateState(t))},e.prototype._clickTitle=function(){var t=globalThis._.cloneDeep(this._state);t.title=!0,this.updateState(t)},e.prototype._clickSubmit=function(){return a(this,void 0,void 0,function(){var t;return s(this,function(){return(t=globalThis._.cloneDeep(this._state)).answer=t.drops===this._answer,t.submit=!0,this.updateState(t),[2]})})},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t,e){if("move"==e.drag&&(this._dragBtn.x=e.dragBtn.x,this._dragBtn.y=e.dragBtn.y),"end"==e.drag){if(this._dragBtn.x=this._cache.dragOrigin.x,this._dragBtn.y=this._cache.dragOrigin.y,!globalThis._.isEqual(t.drops,e.drops)){for(var i=0;i<this._grids.length;i++){var n=this._grids[i];if(e.drops>i){if(!n.url){var o=this._dragBtn.getChild("icon").asLoader;n.url=o.url}}else n.url&&(n.url=null)}this._c1.selectedIndex=e.drops,e.answer||this.onLibraHint()}globalThis._.isEqual(t.submit,e.submit)||e.submit&&(e.drops?this.answerFeedback(e.answer):this.onHandleGuide()),globalThis._.isEqual(t.title,e.title)||this.playTitle(e.title)}},e.prototype.playTitle=function(t){return a(this,void 0,void 0,function(){var e,i,n,o=this;return s(this,function(r){switch(r.label){case 0:return this._c2.selectedIndex=t?1:0,t?(cc.audioEngine.stopAll(),this.forbidHandle(),e=fgui.UIPackage.getItemByURL(this._title._sound),[4,d(e.file,cc.AudioClip)]):[3,2];case 1:return i=r.sent(),n=cc.audioEngine.play(i,!1,1),cc.audioEngine.setFinishCallback(n,function(){var t=globalThis._.cloneDeep(o._state);t.title=!1,o.updateState(t)}),[3,3];case 2:this.disableForbidHandle(),r.label=3;case 3:return[2]}})})},e.prototype.answerFeedback=function(t){var e=this;if(this.feedback){var i=globalThis._.cloneDeep(this._state),n=cc.instantiate(this.feedback);n.x=960,n.y=540,n.getComponent(cc.Component).init(t),n.parent=cc.find("Canvas").parent,setTimeout(function(){n.destroy(),i.submit=!1,e.updateState(i)},2e3)}},e.prototype.onLibraHint=function(){var t=this;this.lineBlink&&(fgui.GRoot.inst.addChild(this.lineBlink.component),this.lineBlink.pos?(this.lineBlink.component.x=(fgui.GRoot.inst.width-this.lineBlink.component.width)/2+this.lineBlink.pos.x,this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2+this.lineBlink.pos.y):this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2,this.lineBlink.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.lineBlink.component)}))},e.prototype.onHandleGuide=function(){var t=this;if(this.handleGuide){var e=globalThis._.cloneDeep(this._state);fgui.GRoot.inst.addChild(this.handleGuide.component),this.handleGuide.pos?(this.handleGuide.component.x=(fgui.GRoot.inst.width-this.handleGuide.component.width)/2+this.handleGuide.pos.x,this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2+this.handleGuide.pos.y):this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2,this.handleGuide.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.handleGuide.component),e.submit=!1,t.updateState(e)},2)}},e.prototype.forbidHandle=function(){if(!this._worldRoot.getChildByName("handleMask")){var t=new cc.Node("handleMask");t.addComponent(cc.BlockInputEvents),t.parent=this._worldRoot,t.width=1920,t.height=1080,t.x=960,t.y=540}},e.prototype.disableForbidHandle=function(){var t=this._worldRoot.getChildByName("handleMask");t&&t.destroy()},e.prototype.dragSchedule=function(){if(this._dragging){var t=globalThis._.cloneDeep(this._state);t.drag="move",t.dragBtn={x:this._dragBtn.x,y:this._dragBtn.y},this.updateState(t)}},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState(),cc.audioEngine.stopAll()},r([g],e)}(cc.Component));i.default=f,cc._RF.pop()},{}],"dragAnswer-model01-v2":[function(t,e,i){"use strict";cc._RF.push(e,"8f908Bl1PlGabQ0oWxCLVqT","dragAnswer-model01-v2");var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},a=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function a(t){try{l(n.next(t))}catch(e){r(e)}}function s(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}l((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return l([t,e])}}function l(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0});var l=window.GlobalData.sample,c=l.loadBundle,h=l.loadPrefab,d=l.loadResource,u=(window.GlobalData.utils.pointBelongArea,cc._decorator),p=u.ccclass,g=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._colliderBox=[],e._collideredBox=[],e._cache={},e._scheduleTime=.3,e._dragging=!1,e._answer=0,e._state={},e}return o(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this.updateUi(this._state,t),this._state=t,this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._worldRoot=cc.find("Canvas").parent,this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._c2=this._view.getController("c2"),this._c2&&(this._c2.selectedIndex=1,this._c2.selectedIndex=0),this._submit=this._view.getChild("submit").asButton,this._submit&&this._submit.on(fgui.Event.CLICK,this._clickSubmit,this),this._title=this._view.getChild("title").asButton,this._titleTrigger=this._view.getChild("titleTrigger").asLoader,this._titleTrigger&&this._titleTrigger.on(fgui.Event.CLICK,this._clickTitle,this);var t=this._view.getChild("colliderBox").asGroup,e=this._view.getChild("collideredBox").asGroup;this._cache.colliderBox=[];for(var i=0;i<this._view.numChildren;i++)if(this._view.getChildAt(i).group==t){var n=this._view.getChildAt(i).asButton;this._cache.colliderBox.push({x:n.x,y:n.y,belong:null}),n.draggable=!0,n.on(fgui.Event.TOUCH_BEGIN,this._onDragStart,this),n.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),n.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._colliderBox.push(n)}for(i=0;i<this._view.numChildren;i++)this._view.getChildAt(i).group==e&&(n=this._view.getChildAt(i).asButton,this._collideredBox.push(n));this._state={drag:"end",collider:this._cache.colliderBox.map(function(t){return t}),colliderIndex:null,title:!1,submit:!1,answer:!1},this.disableForbidHandle()},e.prototype.init=function(t){return a(this,void 0,void 0,function(){var e,i,n,o,r,a,l,d,u,p,g,f,_,b,y,v;return s(this,function(s){switch(s.label){case 0:if(e=t.pathConfig,i=t.model,n=t.components,o=e.packageName,i.uiPath&&(r=i.uiPath,this._view=fgui.UIPackage.createObject(o,r).asCom),i.config&&(a=i.config,l=a.answer,d=a.ae,l&&(this._answer=l),d))for(u in d)d[u]&&(this[u]={},d[u].component&&(this[u].component=fgui.UIPackage.createObject(o,d[u].component).asCom),d[u].pos&&(this[u].pos=d[u].pos));if(!n)return[3,5];for(g in p=[],n)p.push(g);f=0,s.label=1;case 1:return f<p.length?(_=p[f],b=""+e.remoteUrl+e.componentBundlePath+n[_].bundleName,[4,c(b)]):[3,5];case 2:return y=s.sent(),[4,h(y,n[_].prefabName)];case 3:v=s.sent(),this[_]=v,s.label=4;case 4:return f++,[3,1];case 5:return[2]}})})},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(t){t.captureTouch();var e=globalThis._.cloneDeep(this._state),i=fgui.GObject.cast(t.currentTarget),n=this._colliderBox.findIndex(function(t){return t==i});e.colliderIndex=n,this.updateState(e)},e.prototype._onDragMove=function(){this._dragging=!0},e.prototype._onDragEnd=function(t){var e=this;if(this._dragging){this._dragging=!1;var i=fgui.GObject.cast(t.currentTarget),n=this._colliderBox.findIndex(function(t){return t==i}),o=this._collideredBox.findIndex(function(t){return 1==e._belongArea(i,t,84)}),r=globalThis._.cloneDeep(this._state);if(-1==o)r.collider[n]={x:this._cache.colliderBox[n].x,y:this._cache.colliderBox[n].y,belong:null};else{var a=this._collideredBox[o].x+this._collideredBox[o].width/2-this._colliderBox[n].width/2,s=this._collideredBox[o].y+this._collideredBox[o].height/2-this._colliderBox[n].height/2,l=r.collider.find(function(t){return t.x==a&&Math.abs(t.y-s)<42});r.collider[n]={x:l?this._cache.colliderBox[n].x:a,y:l?this._cache.colliderBox[n].y:s,belong:l?null:o}}r.submit=!1,r.drag="end",r.colliderIndex=n,this.updateState(r)}},e.prototype._clickTitle=function(){var t=globalThis._.cloneDeep(this._state);t.title=!0,this.updateState(t)},e.prototype._clickSubmit=function(){var t=globalThis._.cloneDeep(this._state),e=t.collider.map(function(t){return t.belong}).filter(function(t){return t||0===t}).join("");t.answer=e==this._answer,t.submit=!0,this.updateState(t)},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t,e){if("move"==e.drag&&(this._colliderBox[e.colliderIndex].x=e.collider[e.colliderIndex].x,this._colliderBox[e.colliderIndex].y=e.collider[e.colliderIndex].y),"end"==e.drag){if(!globalThis._.isEqual(t.collider,e.collider))for(var i=0;i<e.collider.length;i++)this._colliderBox[i].x=e.collider[i].x,this._colliderBox[i].y=e.collider[i].y;if(globalThis._.isEqual(t.title,e.title)||this.playTitle(e.title),!globalThis._.isEqual(t.submit,e.submit)&&e.submit){var n=this._colliderBox.map(function(t){return{x:t.x,y:t.y}});this._cache.colliderBox.every(function(t,e){return t.x==n[e].x&&t.y==n[e].y})?this.onHandleGuide():this.onFlicker(e.answer)}}},e.prototype.playTitle=function(t){return a(this,void 0,void 0,function(){var e,i,n,o=this;return s(this,function(r){switch(r.label){case 0:return this._c2.selectedIndex=t?1:0,t?(cc.audioEngine.stopAll(),this.forbidHandle(),e=fgui.UIPackage.getItemByURL(this._title._sound),[4,d(e.file,cc.AudioClip)]):[3,2];case 1:return i=r.sent(),n=cc.audioEngine.play(i,!1,1),cc.audioEngine.setFinishCallback(n,function(){var t=globalThis._.cloneDeep(o._state);t.title=!1,o.updateState(t)}),[3,3];case 2:this.disableForbidHandle(),r.label=3;case 3:return[2]}})})},e.prototype._belongArea=function(t,e,i){void 0===i&&(i=10);var n=t.x-(e.x+e.width/2),o=t.y-(e.y+e.height/2);return Math.sqrt(n*n+o*o)<i},e.prototype.transfer=function(t){var e=this;this.forbidHandle(),setTimeout(function(){e.answerFeedback(t)},1e3)},e.prototype.answerFeedback=function(t){var e=this;if(this.feedback){var i=globalThis._.cloneDeep(this._state),n=cc.instantiate(this.feedback);n.x=960,n.y=540,n.getComponent(cc.Component).init(t),n.parent=cc.find("Canvas").parent,setTimeout(function(){e.disableForbidHandle(),n.destroy(),i.submit=!1,e.updateState(i)},2e3)}},e.prototype.onFlicker=function(t){var e=this;this._view.getTransition("t0").play(function(){e.answerFeedback(t)})},e.prototype.onHandleGuide=function(){var t=this;if(this.handleGuide){var e=globalThis._.cloneDeep(this._state);fgui.GRoot.inst.addChild(this.handleGuide.component),this.handleGuide.pos?(this.handleGuide.component.x=(fgui.GRoot.inst.width-this.handleGuide.component.width)/2+this.handleGuide.pos.x,this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2+this.handleGuide.pos.y):this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2,this.handleGuide.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.handleGuide.component),e.submit=!1,t.updateState(e)},2)}},e.prototype.forbidHandle=function(){if(!this._worldRoot.getChildByName("handleMask")){var t=new cc.Node("handleMask");t.addComponent(cc.BlockInputEvents),t.parent=this._worldRoot,t.width=1920,t.height=1080,t.x=960,t.y=540}},e.prototype.disableForbidHandle=function(){var t=this._worldRoot.getChildByName("handleMask");t&&t.destroy()},e.prototype.dragSchedule=function(){if(this._dragging){var t=globalThis._.cloneDeep(this._state);t.drag="move",t.collider[t.colliderIndex]={x:this._colliderBox[t.colliderIndex].x,y:this._colliderBox[t.colliderIndex].y},this.updateState(t)}},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState(),cc.audioEngine.stopAll()},r([p],e)}(cc.Component));i.default=g,cc._RF.pop()},{}],"dragAnswer-model02-v1":[function(t,e,i){"use strict";cc._RF.push(e,"761b7tA1DZDbZlu/VVG4SVi","dragAnswer-model02-v1");var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,i,a):o(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},a=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function a(t){try{l(n.next(t))}catch(e){r(e)}}function s(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}l((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var i,n,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return l([t,e])}}function l(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,n=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0});var l=window.GlobalData.sample,c=l.loadBundle,h=l.loadPrefab,d=l.loadResource,u=cc._decorator,p=u.ccclass,g=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._colliderBox=[],e._collideredBox=[],e._cache={},e._scheduleTime=.3,e._dragging=!1,e._answer=0,e._state={},e}return o(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this.updateUi(this._state,t),this._state=t,this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._worldRoot=cc.find("Canvas").parent,this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._c2=this._view.getController("c2"),this._c2&&(this._c2.selectedIndex=1,this._c2.selectedIndex=0),this._title=this._view.getChild("title").asButton,this._titleTrigger=this._view.getChild("titleTrigger").asLoader,this._titleTrigger&&this._titleTrigger.on(fgui.Event.CLICK,this._clickTitle,this);var t=this._view.getChild("colliderBox").asGroup,e=this._view.getChild("collideredBox").asGroup;this._cache.colliderBox=[];for(var i=0;i<this._view.numChildren;i++)if(this._view.getChildAt(i).group==t){var n=this._view.getChildAt(i).asButton;this._cache.colliderBox.push({x:n.x,y:n.y}),n.draggable=!0,n.on(fgui.Event.TOUCH_BEGIN,this._onDragStart,this),n.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),n.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._colliderBox.push(n)}for(i=0;i<this._view.numChildren;i++)this._view.getChildAt(i).group==e&&(n=this._view.getChildAt(i).asButton,this._collideredBox.push(n));this._state={drag:"end",title:!1,collider:this._cache.colliderBox.map(function(t){return t}),colliderIndex:null,answer:!1,submit:!1},this.disableForbidHandle()},e.prototype.init=function(t){return a(this,void 0,void 0,function(){var e,i,n,o,r,a,l,d,u,p,g,f,_,b,y,v;return s(this,function(s){switch(s.label){case 0:if(e=t.pathConfig,i=t.model,n=t.components,o=e.packageName,i.uiPath&&(r=i.uiPath,this._view=fgui.UIPackage.createObject(o,r).asCom),i.config&&(a=i.config,l=a.answer,d=a.ae,l&&(this._answer=l),d))for(u in d)d[u]&&(this[u]={},d[u].component&&(this[u].component=fgui.UIPackage.createObject(o,d[u].component).asCom),d[u].pos&&(this[u].pos=d[u].pos));if(!n)return[3,5];for(g in p=[],n)p.push(g);f=0,s.label=1;case 1:return f<p.length?(_=p[f],b=""+e.remoteUrl+e.componentBundlePath+n[_].bundleName,[4,c(b)]):[3,5];case 2:return y=s.sent(),[4,h(y,n[_].prefabName)];case 3:v=s.sent(),this[_]=v,s.label=4;case 4:return f++,[3,1];case 5:return[2]}})})},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(t){t.captureTouch();for(var e,i=globalThis._.cloneDeep(this._state),n=fgui.GObject.cast(t.currentTarget),o=0;o<this._colliderBox.length;o++)n==this._colliderBox[o]&&(e=o);i.colliderIndex=e,this.updateState(i)},e.prototype._onDragMove=function(){this._dragging=!0},e.prototype._onDragEnd=function(t){for(var e,i=this,n=fgui.GObject.cast(t.currentTarget),o=0;o<this._colliderBox.length;o++)n==this._colliderBox[o]&&(e=o);var r=this._adsorb(n,e);this._dragging=!1;var a=globalThis._.cloneDeep(this._state);if(r.bool)a.collider[e]={x:r.pos.x,y:r.pos.y};else for(o=0;o<this._colliderBox.length;o++)n==this._colliderBox[o]&&(a.collider[e]={x:this._cache.colliderBox[o].x,y:this._cache.colliderBox[o].y});a.drag="end",a.colliderIndex=e;var s=a.collider.every(function(t,e){return!globalThis._.isEqual(t,i._cache.colliderBox[e])});a.answer=s,s&&(a.submit=!0),this.updateState(a)},e.prototype._adsorb=function(t,e){for(var i,n,o,r,a=0;a<this._collideredBox.length;a++)i=t.x-this._collideredBox[a].x,n=t.y-this._collideredBox[a].y,o?o>Math.sqrt(i*i+n*n)&&(o=Math.sqrt(i*i+n*n),r=a):(o=Math.sqrt(i*i+n*n),r=a);return{bool:o<65&&e==r,s:r,pos:{x:this._collideredBox[r].x,y:this._collideredBox[r].y}}},e.prototype._clickTitle=function(){var t=globalThis._.cloneDeep(this._state);t.title=!0,this.updateState(t)},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t,e){if("move"==e.drag&&(this._colliderBox[e.colliderIndex].x=e.collider[e.colliderIndex].x,this._colliderBox[e.colliderIndex].y=e.collider[e.colliderIndex].y),"end"==e.drag){if(!globalThis._.isEqual(t.collider,e.collider))for(var i=0;i<e.collider.length;i++)this._colliderBox[i].x=e.collider[i].x,this._colliderBox[i].y=e.collider[i].y;globalThis._.isEqual(t.title,e.title)||this.playTitle(e.title),globalThis._.isEqual(t.answer,e.answer)||e.answer&&this.transfer(e.answer)}},e.prototype.playTitle=function(t){return a(this,void 0,void 0,function(){var e,i,n,o=this;return s(this,function(r){switch(r.label){case 0:return this._c2.selectedIndex=t?1:0,t?(cc.audioEngine.stopAll(),this.forbidHandle(),e=fgui.UIPackage.getItemByURL(this._title._sound),[4,d(e.file,cc.AudioClip)]):[3,2];case 1:return i=r.sent(),n=cc.audioEngine.play(i,!1,1),cc.audioEngine.setFinishCallback(n,function(){var t=globalThis._.cloneDeep(o._state);t.title=!1,o.updateState(t)}),[3,3];case 2:this.disableForbidHandle(),r.label=3;case 3:return[2]}})})},e.prototype.transfer=function(t){var e=this;this.forbidHandle(),setTimeout(function(){e.answerFeedback(t)},1e3)},e.prototype.answerFeedback=function(t){var e=this;if(this.feedback){var i=globalThis._.cloneDeep(this._state),n=cc.instantiate(this.feedback);n.x=960,n.y=540,n.getComponent(cc.Component).init(t),n.parent=cc.find("Canvas").parent,setTimeout(function(){e.disableForbidHandle(),n.destroy(),i.submit=!1,e.updateState(i)},2e3)}},e.prototype.onLibraHint=function(){var t=this;this.lineBlink&&(fgui.GRoot.inst.addChild(this.lineBlink.component),this.lineBlink.pos?(this.lineBlink.component.x=(fgui.GRoot.inst.width-this.lineBlink.component.width)/2+this.lineBlink.pos.x,this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2+this.lineBlink.pos.y):this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2,this.lineBlink.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.lineBlink.component)}))},e.prototype.onHandleGuide=function(){var t=this;if(this.handleGuide){var e=globalThis._.cloneDeep(this._state);fgui.GRoot.inst.addChild(this.handleGuide.component),this.handleGuide.pos?(this.handleGuide.component.x=(fgui.GRoot.inst.width-this.handleGuide.component.width)/2+this.handleGuide.pos.x,this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2+this.handleGuide.pos.y):this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2,this.handleGuide.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.handleGuide.component),e.submit=!1,t.updateState(e)},2)}},e.prototype.forbidHandle=function(){if(!this._worldRoot.getChildByName("handleMask")){var t=new cc.Node("handleMask");t.addComponent(cc.BlockInputEvents),t.parent=this._worldRoot,t.width=1920,t.height=1080,t.x=960,t.y=540}},e.prototype.disableForbidHandle=function(){var t=this._worldRoot.getChildByName("handleMask");t&&t.destroy()},e.prototype.dragSchedule=function(){if(this._dragging){var t=globalThis._.cloneDeep(this._state);t.drag="move",t.collider[t.colliderIndex]={x:this._colliderBox[t.colliderIndex].x,y:this._colliderBox[t.colliderIndex].y},this.updateState(t)}},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState(),cc.audioEngine.stopAll()},r([p],e)}(cc.Component));i.default=g,cc._RF.pop()},{}]},{},["dragAnswer-model01-v1","dragAnswer-model01-v2","dragAnswer-model02-v1"]);