window.__require=function t(e,i,o){function n(a,s){if(!i[a]){if(!e[a]){var l=a.split("/");if(l=l[l.length-1],!e[l]){var h="function"==typeof __require&&__require;if(!s&&h)return h(l,!0);if(r)return r(l,!0);throw new Error("Cannot find module '"+a+"'")}a=l}var c=i[a]={exports:{}};e[a][0].call(c.exports,function(t){return n(e[a][1][t]||t)},c,c.exports,t,e,i,o)}return i[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<o.length;a++)n(o[a]);return n}({"dragAnswer-model01-v1":[function(t,e,i){"use strict";cc._RF.push(e,"a13c8/eIVFLEpkoqHBFYILF","dragAnswer-model01-v1");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,i,a):n(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},a=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function a(t){try{l(o.next(t))}catch(e){r(e)}}function s(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}l((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var i,o,n,r,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return l([t,e])}}function l(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){a.label=r[1];break}if(6===r[0]&&a.label<n[1]){a.label=n[1],n=r;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(r);break}n[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0});var l=window.GlobalData.sample,h=l.loadBundle,c=l.loadPrefab,d=l.loadResource,u=window.GlobalData.utils.pointBelongArea,p=cc._decorator,g=p.ccclass,f=(p.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._grids=[],e._cache={},e._scheduleTime=.3,e._dragging=!1,e._answer=0,e._state={},e}return n(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this.updateUi(this._state,t),this._state=t,this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._worldRoot=cc.find("Canvas").parent,this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,this._view.x=(fgui.GRoot.inst.width-this._view.width)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._c2=this._view.getController("c2"),this._c2&&(this._c2.selectedIndex=1,this._c2.selectedIndex=0),this._submit=this._view.getChild("submit").asButton,this._submit&&this._submit.on(fgui.Event.CLICK,this._clickSubmit,this),this._titleTrigger=this._view.getChild("titleTrigger").asLoader,this._titleTrigger&&this._titleTrigger.on(fgui.Event.CLICK,this._clickTitle,this),this._title=this._view.getChild("title").asButton,this._dragBtn=this._view.getChild("dragBtn").asButton,this._cache.dragOrigin=this.getOriginValue(this._dragBtn),this._dragBtn.draggable=!0,this._dragBtn.on(fgui.Event.TOUCH_BEGIN,this._onDragStart,this),this._dragBtn.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),this._dragBtn.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._btnBox=this._view.getChild("btnBox").asButton,this._btnBox&&this._btnBox.on(fgui.Event.CLICK,this._clickRemove,this);for(var t=this._btnBox.getChild("grids").asGroup,e=this._btnBox.numChildren-1;e>-1;e--)if(this._btnBox.getChildAt(e).group==t){var i=this._btnBox.getChildAt(e).asLoader;this._grids.push(i)}this._state={drag:"end",dragBtn:{x:this._dragBtn.x,y:this._dragBtn.y},title:!1,drops:0,submit:!1,answer:!1},this.disableForbidHandle()},e.prototype.init=function(t){return a(this,void 0,void 0,function(){var e,i,o,n,r,a,l,d,u,p,g,f,_,b,y,v;return s(this,function(s){switch(s.label){case 0:for(u in e=t.pathConfig,i=t.model,o=t.components,n=e.packageName,r=i.uiPath,a=i.config,l=a.answer,d=a.ae,this._view=fgui.UIPackage.createObject(n,r).asCom,d)d[u]&&(this[u]={},d[u].component&&(this[u].component=fgui.UIPackage.createObject(n,d[u].component).asCom),d[u].pos&&(this[u].pos=d[u].pos));if(l&&(this._answer=l),!o)return[3,5];for(g in p=[],o)p.push(g);f=0,s.label=1;case 1:return f<p.length?(_=p[f],b=""+e.remoteUrl+e.componentBundlePath+o[_].bundleName,[4,h(b)]):[3,5];case 2:return y=s.sent(),[4,c(y,o[_].prefabName)];case 3:v=s.sent(),this[_]=v,s.label=4;case 4:return f++,[3,1];case 5:return[2]}})})},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(t){t.captureTouch();var e=globalThis._.cloneDeep(this._state);e.drag="start",e.answer=e.drops===this._answer,this.updateState(e)},e.prototype._onDragMove=function(){this._dragging=!0},e.prototype._onDragEnd=function(){this._dragging=!1;var t=globalThis._.cloneDeep(this._state);u("rectangle",this._btnBox,this._dragBtn)&&(this._dragBtn.getChild("icon").asLoader,this._grids.find(function(t){return null===t.url})&&(t.drops=t.drops+1)),t.dragBtn={x:this._cache.dragOrigin.x,y:this._cache.dragOrigin.y},t.drag="end",t.answer=t.drops===this._answer,this.updateState(t)},e.prototype._clickRemove=function(){var t=globalThis._.cloneDeep(this._state);0!==this._grids.findIndex(function(t){return null===t.url})&&(t.drops=t.drops-1,t.answer=t.drops===this._answer,this.updateState(t))},e.prototype._clickTitle=function(){var t=globalThis._.cloneDeep(this._state);t.title=!0,this.updateState(t)},e.prototype._clickSubmit=function(){return a(this,void 0,void 0,function(){var t;return s(this,function(){return(t=globalThis._.cloneDeep(this._state)).answer=t.drops===this._answer,t.submit=!0,this.updateState(t),[2]})})},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t,e){if("move"==e.drag&&(this._dragBtn.x=e.dragBtn.x,this._dragBtn.y=e.dragBtn.y),"end"==e.drag){if(this._dragBtn.x=this._cache.dragOrigin.x,this._dragBtn.y=this._cache.dragOrigin.y,!globalThis._.isEqual(t.drops,e.drops)){for(var i=0;i<this._grids.length;i++){var o=this._grids[i];if(e.drops>i){if(!o.url){var n=this._dragBtn.getChild("icon").asLoader;o.url=n.url}}else o.url&&(o.url=null)}this._c1.selectedIndex=e.drops,e.answer||this.onLibraHint()}globalThis._.isEqual(t.submit,e.submit)||e.submit&&(e.drops?this.answerFeedback(e.answer):this.onHandleGuide()),globalThis._.isEqual(t.title,e.title)||this.playTitle(e.title)}},e.prototype.playTitle=function(t){return a(this,void 0,void 0,function(){var e,i,o,n=this;return s(this,function(r){switch(r.label){case 0:return this._c2.selectedIndex=t?1:0,t?(cc.audioEngine.stopAll(),this.forbidHandle(),e=fgui.UIPackage.getItemByURL(this._title._sound),[4,d(e.file,cc.AudioClip)]):[3,2];case 1:return i=r.sent(),o=cc.audioEngine.play(i,!1,1),cc.audioEngine.setFinishCallback(o,function(){var t=globalThis._.cloneDeep(n._state);t.title=!1,n.updateState(t)}),[3,3];case 2:this.disableForbidHandle(),r.label=3;case 3:return[2]}})})},e.prototype.answerFeedback=function(t){var e=this;if(this.feedback){var i=globalThis._.cloneDeep(this._state),o=cc.instantiate(this.feedback);o.x=960,o.y=540,o.getComponent(cc.Component).init(t),o.parent=cc.find("Canvas").parent,setTimeout(function(){o.destroy(),i.submit=!1,e.updateState(i)},2e3)}},e.prototype.onLibraHint=function(){var t=this;this.lineBlink&&(fgui.GRoot.inst.addChild(this.lineBlink.component),this.lineBlink.pos?(this.lineBlink.component.x=(fgui.GRoot.inst.width-this.lineBlink.component.width)/2+this.lineBlink.pos.x,this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2+this.lineBlink.pos.y):this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2,this.lineBlink.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.lineBlink.component)}))},e.prototype.onHandleGuide=function(){var t=this;if(this.handleGuide){var e=globalThis._.cloneDeep(this._state);fgui.GRoot.inst.addChild(this.handleGuide.component),this.handleGuide.pos?(this.handleGuide.component.x=(fgui.GRoot.inst.width-this.handleGuide.component.width)/2+this.handleGuide.pos.x,this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2+this.handleGuide.pos.y):this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2,this.handleGuide.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.handleGuide.component),e.submit=!1,t.updateState(e)},2)}},e.prototype.forbidHandle=function(){if(!this._worldRoot.getChildByName("handleMask")){var t=new cc.Node("handleMask");t.addComponent(cc.BlockInputEvents),t.parent=this._worldRoot,t.width=1920,t.height=1080,t.x=960,t.y=540}},e.prototype.disableForbidHandle=function(){var t=this._worldRoot.getChildByName("handleMask");t&&t.destroy()},e.prototype.dragSchedule=function(){if(this._dragging){var t=globalThis._.cloneDeep(this._state);t.drag="move",t.dragBtn={x:this._dragBtn.x,y:this._dragBtn.y},this.updateState(t)}},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState(),cc.audioEngine.stopAll()},r([g],e)}(cc.Component));i.default=f,cc._RF.pop()},{}],"dragAnswer-model01-v2":[function(t,e,i){"use strict";cc._RF.push(e,"8f908Bl1PlGabQ0oWxCLVqT","dragAnswer-model01-v2");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,i,a):n(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},a=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function a(t){try{l(o.next(t))}catch(e){r(e)}}function s(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}l((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var i,o,n,r,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return l([t,e])}}function l(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){a.label=r[1];break}if(6===r[0]&&a.label<n[1]){a.label=n[1],n=r;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(r);break}n[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0});var l=window.GlobalData.sample,h=l.loadBundle,c=l.loadPrefab,d=l.loadResource,u=cc._decorator,p=u.ccclass,g=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._colliderBox=[],e._collideredBox=[],e._cache={},e._scheduleTime=.3,e._dragging=!1,e._answer=0,e._state={},e}return n(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this.updateUi(this._state,t),this._state=t,this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._worldRoot=cc.find("Canvas").parent,this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,this._view.x=(fgui.GRoot.inst.width-this._view.width)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._c2=this._view.getController("c2"),this._c2&&(this._c2.selectedIndex=1,this._c2.selectedIndex=0),this._submit=this._view.getChild("submit").asButton,this._submit&&this._submit.on(fgui.Event.CLICK,this._clickSubmit,this),this._title=this._view.getChild("title").asButton,this._titleTrigger=this._view.getChild("titleTrigger").asLoader,this._titleTrigger&&this._titleTrigger.on(fgui.Event.CLICK,this._clickTitle,this);var t=this._view.getChild("colliderBox").asGroup,e=this._view.getChild("collideredBox").asGroup;this._cache.colliderBox=[];for(var i=0;i<this._view.numChildren;i++)if(this._view.getChildAt(i).group==t){var o=this._view.getChildAt(i).asButton;this._cache.colliderBox.push({x:o.x,y:o.y,belong:null}),o.draggable=!0,o.on(fgui.Event.TOUCH_BEGIN,this._onDragStart,this),o.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),o.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._colliderBox.push(o)}for(i=0;i<this._view.numChildren;i++)this._view.getChildAt(i).group==e&&(o=this._view.getChildAt(i).asButton,this._collideredBox.push(o));this._state={drag:"end",collider:this._cache.colliderBox.map(function(t){return t}),colliderIndex:null,title:!1,submit:!1,answer:!1},this.disableForbidHandle()},e.prototype.init=function(t){return a(this,void 0,void 0,function(){var e,i,o,n,r,a,l,d,u,p,g,f,_,b,y,v;return s(this,function(s){switch(s.label){case 0:if(e=t.pathConfig,i=t.model,o=t.components,n=e.packageName,i.uiPath&&(r=i.uiPath,this._view=fgui.UIPackage.createObject(n,r).asCom),i.config&&(a=i.config,l=a.answer,d=a.ae,l&&(this._answer=l),d))for(u in d)d[u]&&(this[u]={},d[u].component&&(this[u].component=fgui.UIPackage.createObject(n,d[u].component).asCom),d[u].pos&&(this[u].pos=d[u].pos));if(!o)return[3,5];for(g in p=[],o)p.push(g);f=0,s.label=1;case 1:return f<p.length?(_=p[f],b=""+e.remoteUrl+e.componentBundlePath+o[_].bundleName,[4,h(b)]):[3,5];case 2:return y=s.sent(),[4,c(y,o[_].prefabName)];case 3:v=s.sent(),this[_]=v,s.label=4;case 4:return f++,[3,1];case 5:return[2]}})})},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(t){t.captureTouch();var e=globalThis._.cloneDeep(this._state),i=fgui.GObject.cast(t.currentTarget),o=this._colliderBox.findIndex(function(t){return t==i});e.colliderIndex=o,this.updateState(e)},e.prototype._onDragMove=function(){this._dragging=!0},e.prototype._onDragEnd=function(t){var e=this;if(this._dragging){this._dragging=!1;var i,o=fgui.GObject.cast(t.currentTarget),n=this._colliderBox.findIndex(function(t){return t==o}),r=[];this._collideredBox.forEach(function(t){1==e._belongArea(o,t,110)&&r.push(t)}),r.forEach(function(t,n){if(0==n)i=t;else{var a=e._getDistance(o,r[n-1]);e._getDistance(o,t)<a&&(i=t)}});var a=this._collideredBox.findIndex(function(t){return t==i}),s=globalThis._.cloneDeep(this._state);if(-1==a)s.collider[n]={x:this._cache.colliderBox[n].x,y:this._cache.colliderBox[n].y,belong:null};else{var l=this._collideredBox[a].x+this._collideredBox[a].width/2-this._colliderBox[n].width/2,h=this._collideredBox[a].y+this._collideredBox[a].height/2-this._colliderBox[n].height/2,c=s.collider.find(function(t){return t.x==l&&Math.abs(t.y-h)<55});s.collider[n]={x:c?this._cache.colliderBox[n].x:l,y:c?this._cache.colliderBox[n].y:h,belong:c?null:a}}s.submit=!1,s.drag="end",s.colliderIndex=n,this.updateState(s)}},e.prototype._clickTitle=function(){var t=globalThis._.cloneDeep(this._state);t.title=!0,this.updateState(t)},e.prototype._clickSubmit=function(){var t=globalThis._.cloneDeep(this._state),e=t.collider.map(function(t){return t.belong}).filter(function(t){return t||0===t}).join("");t.answer=e==this._answer,t.submit=!0,this.updateState(t)},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t,e){if("move"==e.drag&&(this._colliderBox[e.colliderIndex].x=e.collider[e.colliderIndex].x,this._colliderBox[e.colliderIndex].y=e.collider[e.colliderIndex].y),"end"==e.drag){if(!globalThis._.isEqual(t.collider,e.collider))for(var i=0;i<e.collider.length;i++)this._colliderBox[i].x=e.collider[i].x,this._colliderBox[i].y=e.collider[i].y;if(globalThis._.isEqual(t.title,e.title)||this.playTitle(e.title),!globalThis._.isEqual(t.submit,e.submit)&&e.submit){var o=this._colliderBox.map(function(t){return{x:t.x,y:t.y}});this._cache.colliderBox.every(function(t,e){return t.x==o[e].x&&t.y==o[e].y})?this.onHandleGuide():this.onFlicker(e.answer)}}},e.prototype.playTitle=function(t){return a(this,void 0,void 0,function(){var e,i,o,n=this;return s(this,function(r){switch(r.label){case 0:return this._c2.selectedIndex=t?1:0,t?(cc.audioEngine.stopAll(),this.forbidHandle(),e=fgui.UIPackage.getItemByURL(this._title._sound),[4,d(e.file,cc.AudioClip)]):[3,2];case 1:return i=r.sent(),o=cc.audioEngine.play(i,!1,1),cc.audioEngine.setFinishCallback(o,function(){var t=globalThis._.cloneDeep(n._state);t.title=!1,n.updateState(t)}),[3,3];case 2:this.disableForbidHandle(),r.label=3;case 3:return[2]}})})},e.prototype._getDistance=function(t,e){var i=t.x+t.width/2-(e.x+e.width/2),o=t.y+t.height/2-(e.y+e.height/2);return Math.sqrt(i*i+o*o)},e.prototype._belongArea=function(t,e,i){void 0===i&&(i=10);var o=t.x+t.width/2-(e.x+e.width/2),n=t.y+t.height/2-(e.y+e.height/2);return Math.sqrt(o*o+n*n)<i},e.prototype.answerFeedback=function(t){var e=this;if(this.feedback){var i=globalThis._.cloneDeep(this._state),o=cc.instantiate(this.feedback);o.x=960,o.y=540,o.getComponent(cc.Component).init(t),o.parent=cc.find("Canvas").parent,setTimeout(function(){e.disableForbidHandle(),o.destroy(),i.submit=!1,e.updateState(i)},2e3)}},e.prototype.onFlicker=function(t){var e=this;this._view.getTransition("t0").play(function(){e.answerFeedback(t)})},e.prototype.onHandleGuide=function(){var t=this;if(this.handleGuide){var e=globalThis._.cloneDeep(this._state);fgui.GRoot.inst.addChild(this.handleGuide.component),this.handleGuide.pos?(this.handleGuide.component.x=(fgui.GRoot.inst.width-this.handleGuide.component.width)/2+this.handleGuide.pos.x,this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2+this.handleGuide.pos.y):this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2,this.handleGuide.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.handleGuide.component),e.submit=!1,t.updateState(e)},2)}},e.prototype.forbidHandle=function(){if(!this._worldRoot.getChildByName("handleMask")){var t=new cc.Node("handleMask");t.addComponent(cc.BlockInputEvents),t.parent=this._worldRoot,t.width=1920,t.height=1080,t.x=960,t.y=540}},e.prototype.disableForbidHandle=function(){var t=this._worldRoot.getChildByName("handleMask");t&&t.destroy()},e.prototype.dragSchedule=function(){if(this._dragging){var t=globalThis._.cloneDeep(this._state);t.drag="move",t.collider[t.colliderIndex]={x:this._colliderBox[t.colliderIndex].x,y:this._colliderBox[t.colliderIndex].y},this.updateState(t)}},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState(),cc.audioEngine.stopAll()},r([p],e)}(cc.Component));i.default=g,cc._RF.pop()},{}],"dragAnswer-model02-v1":[function(t,e,i){"use strict";cc._RF.push(e,"761b7tA1DZDbZlu/VVG4SVi","dragAnswer-model02-v1");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),r=this&&this.__decorate||function(t,e,i,o){var n,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(a=(r<3?n(a):r>3?n(e,i,a):n(e,i))||a);return r>3&&a&&Object.defineProperty(e,i,a),a},a=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function a(t){try{l(o.next(t))}catch(e){r(e)}}function s(t){try{l(o.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}l((o=o.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var i,o,n,r,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return l([t,e])}}function l(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){a.label=r[1];break}if(6===r[0]&&a.label<n[1]){a.label=n[1],n=r;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(r);break}n[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(s){r=[6,s],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0});var l=window.GlobalData.sample,h=l.loadBundle,c=l.loadPrefab,d=l.loadResource,u=cc._decorator,p=u.ccclass,g=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._colliderBox=[],e._collideredBox=[],e._cache={},e._scheduleTime=.3,e._dragging=!1,e._answer=0,e._state={},e}return n(e,t),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(t){this.updateUi(this._state,t),this._state=t,this.mergeState()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this._worldRoot=cc.find("Canvas").parent,this._view.y=(fgui.GRoot.inst.height-this._view.height)/2,this._view.x=(fgui.GRoot.inst.width-this._view.width)/2,fgui.GRoot.inst.addChild(this._view),this._c1=this._view.getController("c1"),this._c2=this._view.getController("c2"),this._c2&&(this._c2.selectedIndex=1,this._c2.selectedIndex=0),this._title=this._view.getChild("title").asButton,this._titleTrigger=this._view.getChild("titleTrigger").asLoader,this._titleTrigger&&this._titleTrigger.on(fgui.Event.CLICK,this._clickTitle,this),this._robot=this._view.getChild("robot").asLoader,this._dyUI=this._view.getChild("dyUI").asGroup,this._colliderGroup=this._view.getChild("colliderBox").asGroup,this._collideredGroup=this._view.getChild("collideredBox").asGroup,this._cache.colliderBox=[];for(var t=0;t<this._view.numChildren;t++)if(this._view.getChildAt(t).group==this._colliderGroup){var e=this._view.getChildAt(t).asButton;this._cache.colliderBox.push({x:e.x,y:e.y}),e.draggable=!0,e.on(fgui.Event.TOUCH_BEGIN,this._onDragStart,this),e.on(fgui.Event.TOUCH_MOVE,this._onDragMove,this),e.on(fgui.Event.TOUCH_END,this._onDragEnd,this),this._colliderBox.push(e)}for(t=0;t<this._view.numChildren;t++)this._view.getChildAt(t).group==this._collideredGroup&&(e=this._view.getChildAt(t).asButton,this._collideredBox.push(e));this._state={drag:"end",title:!1,collider:this._cache.colliderBox.map(function(t){return t}),colliderIndex:null,answer:!1,submit:!1},this.disableForbidHandle()},e.prototype.init=function(t){return a(this,void 0,void 0,function(){var e,i,o,n,r,a,l,d,u,p,g,f,_,b,y,v;return s(this,function(s){switch(s.label){case 0:if(e=t.pathConfig,i=t.model,o=t.components,n=e.packageName,i.uiPath&&(r=i.uiPath,this._view=fgui.UIPackage.createObject(n,r).asCom),i.config&&(a=i.config,l=a.answer,d=a.ae,l&&(this._answer=l),d))for(u in d)d[u]&&(this[u]={},d[u].component&&(this[u].component=fgui.UIPackage.createObject(n,d[u].component).asCom),d[u].pos&&(this[u].pos=d[u].pos));if(!o)return[3,5];for(g in p=[],o)p.push(g);f=0,s.label=1;case 1:return f<p.length?(_=p[f],b=""+e.remoteUrl+e.componentBundlePath+o[_].bundleName,[4,h(b)]):[3,5];case 2:return y=s.sent(),[4,c(y,o[_].prefabName)];case 3:v=s.sent(),this[_]=v,s.label=4;case 4:return f++,[3,1];case 5:return[2]}})})},e.prototype.getOriginValue=function(t){return{x:t.x,y:t.y}},e.prototype._onDragStart=function(t){t.captureTouch();var e=globalThis._.cloneDeep(this._state),i=fgui.GObject.cast(t.currentTarget),o=this._colliderBox.findIndex(function(t){return t==i});e.colliderIndex=o,this.updateState(e)},e.prototype._onDragMove=function(){this._dragging=!0},e.prototype._onDragEnd=function(t){var e=this;if(this._dragging){this._dragging=!1;var i=fgui.GObject.cast(t.currentTarget),o=this._colliderBox.findIndex(function(t){return t==i}),n=this._adsorb(i,o),r=globalThis._.cloneDeep(this._state);if(n.bool)r.collider[o]={x:n.pos.x,y:n.pos.y};else for(var a=0;a<this._colliderBox.length;a++)i==this._colliderBox[a]&&(r.collider[o]={x:this._cache.colliderBox[a].x,y:this._cache.colliderBox[a].y});r.drag="end",r.colliderIndex=o;var s=r.collider.every(function(t,i){return!globalThis._.isEqual(t,e._cache.colliderBox[i])});r.answer=s,s&&(r.submit=!0),this.updateState(r)}},e.prototype._adsorb=function(t,e){for(var i,o,n,r,a=0;a<this._collideredBox.length;a++)i=t.x-this._collideredBox[a].x,o=t.y-this._collideredBox[a].y,n?n>Math.sqrt(i*i+o*o)&&(n=Math.sqrt(i*i+o*o),r=a):(n=Math.sqrt(i*i+o*o),r=a);return{bool:n<65&&e==r,s:r,pos:{x:this._collideredBox[r].x,y:this._collideredBox[r].y}}},e.prototype._clickTitle=function(){var t=globalThis._.cloneDeep(this._state);t.title=!0,this.updateState(t)},e.prototype.getState=function(t){this.updateState(t)},e.prototype.updateState=function(t){globalThis._.isEqual(this._state,t)||(this.state=t)},e.prototype.updateUi=function(t,e){if("move"==e.drag&&(this._colliderBox[e.colliderIndex].x=e.collider[e.colliderIndex].x,this._colliderBox[e.colliderIndex].y=e.collider[e.colliderIndex].y),"end"==e.drag){if(!globalThis._.isEqual(t.collider,e.collider))for(var i=0;i<e.collider.length;i++)this._colliderBox[i].x=e.collider[i].x,this._colliderBox[i].y=e.collider[i].y;globalThis._.isEqual(t.title,e.title)||this.playTitle(e.title),globalThis._.isEqual(t.answer,e.answer)||e.answer&&this.transfer(e.answer)}},e.prototype.playTitle=function(t){return a(this,void 0,void 0,function(){var e,i,o,n=this;return s(this,function(r){switch(r.label){case 0:return this._c2.selectedIndex=t?1:0,t?(cc.audioEngine.stopAll(),this.forbidHandle(),e=fgui.UIPackage.getItemByURL(this._title._sound),[4,d(e.file,cc.AudioClip)]):[3,2];case 1:return i=r.sent(),o=cc.audioEngine.play(i,!1,1),cc.audioEngine.setFinishCallback(o,function(){var t=globalThis._.cloneDeep(n._state);t.title=!1,n.updateState(t)}),[3,3];case 2:this.disableForbidHandle(),r.label=3;case 3:return[2]}})})},e.prototype.transfer=function(t){var e=this;this.forbidHandle(),this._dyUI.visible=!1,this._colliderGroup.visible=!1,this._collideredGroup.visible=!1,this._robot.visible=!0,this._robot.playing=!0,setTimeout(function(){e._dyUI.visible=!0,e._colliderGroup.visible=!0,e._collideredGroup.visible=!0,e._robot.visible=!1,e._robot.playing=!1,e.answerFeedback(t)},3e3)},e.prototype.answerFeedback=function(t){var e=this;if(this.feedback){var i=globalThis._.cloneDeep(this._state),o=cc.instantiate(this.feedback);o.x=960,o.y=540,o.getComponent(cc.Component).init(t),o.parent=cc.find("Canvas").parent,setTimeout(function(){e.disableForbidHandle(),o.destroy(),i.submit=!1,e.updateState(i)},2e3)}},e.prototype.onLibraHint=function(){var t=this;this.lineBlink&&(fgui.GRoot.inst.addChild(this.lineBlink.component),this.lineBlink.pos?(this.lineBlink.component.x=(fgui.GRoot.inst.width-this.lineBlink.component.width)/2+this.lineBlink.pos.x,this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2+this.lineBlink.pos.y):this.lineBlink.component.y=(fgui.GRoot.inst.height-this.lineBlink.component.height)/2,this.lineBlink.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.lineBlink.component)}))},e.prototype.onHandleGuide=function(){var t=this;if(this.handleGuide){var e=globalThis._.cloneDeep(this._state);fgui.GRoot.inst.addChild(this.handleGuide.component),this.handleGuide.pos?(this.handleGuide.component.x=(fgui.GRoot.inst.width-this.handleGuide.component.width)/2+this.handleGuide.pos.x,this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2+this.handleGuide.pos.y):this.handleGuide.component.y=(fgui.GRoot.inst.height-this.handleGuide.component.height)/2,this.handleGuide.component.getTransition("t0").play(function(){fgui.GRoot.inst.removeChild(t.handleGuide.component),e.submit=!1,t.updateState(e)},2)}},e.prototype.forbidHandle=function(){if(!this._worldRoot.getChildByName("handleMask")){var t=new cc.Node("handleMask");t.addComponent(cc.BlockInputEvents),t.parent=this._worldRoot,t.width=1920,t.height=1080,t.x=960,t.y=540}},e.prototype.disableForbidHandle=function(){var t=this._worldRoot.getChildByName("handleMask");t&&t.destroy()},e.prototype.dragSchedule=function(){if(this._dragging){var t=globalThis._.cloneDeep(this._state);t.drag="move",t.collider[t.colliderIndex]={x:this._colliderBox[t.colliderIndex].x,y:this._colliderBox[t.colliderIndex].y},this.updateState(t)}},e.prototype.registerState=function(){window.GlobalData.sample.registerState&&window.GlobalData.sample.registerState.call(this)},e.prototype.relieveState=function(){window.GlobalData.sample.relieveState&&window.GlobalData.sample.relieveState.call(this)},e.prototype.mergeState=function(){window.GlobalData.sample.mergeState&&window.GlobalData.sample.mergeState.call(this)},e.prototype.onEnable=function(){this.registerState(),this.schedule(this.dragSchedule,this._scheduleTime)},e.prototype.onDisable=function(){this.relieveState(),cc.audioEngine.stopAll()},r([p],e)}(cc.Component));i.default=g,cc._RF.pop()},{}]},{},["dragAnswer-model01-v1","dragAnswer-model01-v2","dragAnswer-model02-v1"]);