{"version":3,"sources":["assets\\prefabLibrary\\controllers\\controller-model02\\scripts\\controller-model02.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["/*\r\n * @Descripttion: \r\n * @version: \r\n * @Author: ydlx\r\n * @Date: 2020-12-22 11:02:45\r\n * @LastEditors: ydlx\r\n * @LastEditTime: 2021-04-22 20:56:39\r\n */\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst { monitorMessage } = window['GlobalData'];\r\nconst { loadPrefab, loadBundle } = window['GlobalData'].sample;\r\n\r\nimport { sendMessage } from \"./controller-model02-sendMessage\";\r\nimport { getMessage } from \"./controller-model02-getMessage\";\r\n\r\n@ccclass\r\nexport default class controller_model02 extends cc.Component {\r\n    private _configJson: any;         // 配置json\r\n    private _panel: any;              // 面板\r\n    private _resourceBundle: any;     // fairygui 素材资源\r\n    private _pagePrefabs = []         // 题型预制体集合\r\n    private _currentPageNode: any;    // 当前题型节点\r\n\r\n    public _toPage = null;\r\n\r\n    onLoad() { }\r\n\r\n    async init(data: any) {\r\n        // 素材资源\r\n        if (!data.pathConfig.resourceName) {\r\n            console.error(\"素材资源未配置！\");\r\n            return;\r\n        }\r\n\r\n        // 身份识别 全局变量\r\n        this.identification();\r\n\r\n        // 时间戳 标记\r\n        window['GlobalData'].courseData.timestamp = this.getTimestamp();\r\n\r\n        // 临时\r\n        // 因客户端(electron) 下，globalThis为 undefined\r\n        if (!window.globalThis) {\r\n            window.globalThis = {};\r\n            window.globalThis._ = window._;\r\n        }\r\n\r\n        this._configJson = data;\r\n\r\n        fgui.GRoot.create();\r\n\r\n        // 生成面板\r\n        let panelPath: any = `${data.pathConfig.remoteUrl}${data.pathConfig.panelBundlePath}${data.pathConfig.panelName}`;\r\n        let panelBundle: any = await loadBundle(panelPath);\r\n        let panelPrefab: any = await loadPrefab(panelBundle, panelBundle.name);\r\n        let panelNode: any = cc.instantiate(panelPrefab);\r\n        panelNode.parent = cc.find(\"Canvas\").parent;\r\n        panelNode.x = 960;\r\n        panelNode.y = 540;\r\n        this._panel = panelNode;\r\n\r\n        // 临时\r\n        // 面板 显示\r\n        // 如果是学生 面板隐藏\r\n        if (window['GlobalData'].courseData.role == 2) {\r\n            if (this._panel) this._panel.opacity = 0;\r\n        }\r\n\r\n        // 注册 发送信令的出口 逻辑\r\n        if (window['GlobalData'].sample.registerSendMessage) {\r\n            window['GlobalData'].sample.registerSendMessage(sendMessage.bind(this));\r\n        }\r\n\r\n        // 加载 所有题型预制件\r\n        for (let i = 0; i < data.chapters.length; i++) {\r\n            let modelPath: any = `${data.pathConfig.remoteUrl}${data.pathConfig.modelBundlePath}${data.chapters[i].modelBundle}`;\r\n            let modelBundle: any = await loadBundle(modelPath);\r\n            let modelPrefab: any = await loadPrefab(modelBundle, data.chapters[i].prefabName);\r\n            this._pagePrefabs[i] = modelPrefab;\r\n        }\r\n\r\n        // 加载ui 资源包\r\n        let resourcePath: any = `${data.pathConfig.remoteUrl}${data.pathConfig.resourceBundlePath}${data.pathConfig.resourceName}`;\r\n        this._resourceBundle = await loadBundle(resourcePath);\r\n        await this.loadResourcePackage(this._resourceBundle, data.pathConfig.packageName);\r\n\r\n        // 拓课云 初始化\r\n        this.platformConfig(this._configJson.totalPages);\r\n    }\r\n\r\n    async loadResourcePackage(bundle: any, packageName: any) {\r\n        return new Promise((resolve, reject) => {\r\n            fgui.UIPackage.loadPackage(bundle, packageName, () => {\r\n                resolve(true);\r\n            });\r\n        })\r\n    }\r\n\r\n    // 页面跳转 配置\r\n    async onJumpConfig(toPage: any) {\r\n        let page: number = toPage - 1;\r\n        let chapter: any = this._configJson.chapters[page];\r\n\r\n        fgui.GRoot.inst.removeChildren(0, -1, true);\r\n        if (this._currentPageNode) this._currentPageNode.destroy();\r\n\r\n        let prefab: any = this._pagePrefabs[page];\r\n        let node: any = cc.instantiate(prefab);\r\n        let nodeJs = node.getComponent(cc.Component);\r\n        nodeJs.init({ Package: this._configJson.pathConfig.packageName, GComponent: chapter.uiPath, config: chapter.config });\r\n        node.parent = this.node;\r\n\r\n        this._currentPageNode = node;\r\n        this.resetPanel();\r\n        // 当前页面 state 快照\r\n        window['GlobalData'].courseData.stateShoot = globalThis._.cloneDeep(window['GlobalData'].stateProxy[\"state\"]);\r\n        this.recoverState();\r\n    }\r\n\r\n    // 身份识别\r\n    identification() {\r\n        let parseURL = window['GlobalData'].utils.parseURL;\r\n        let urlObj = parseURL(window.location.href);\r\n        for (const key in urlObj) {\r\n            if (window['GlobalData'].courseData.hasOwnProperty(key)) {\r\n                window['GlobalData'].courseData[key] = urlObj[key];\r\n            }\r\n        }\r\n        // 临时\r\n        // 安卓ipad 部分账户 无法获取userid 用name替代\r\n        if (!urlObj[\"userid\"]) {\r\n            window['GlobalData'].courseData[\"userid\"] = urlObj[\"name\"];\r\n        }\r\n    }\r\n\r\n    // 依赖平台 配置设置\r\n    platformConfig(totalPages: number) {\r\n        // 端对端通信 监听\r\n        monitorMessage(getMessage.bind(this));\r\n        // 设置总页面\r\n        window.parent.postMessage(\r\n            JSON.stringify({ method: 'onPagenum', totalPages: totalPages }),\r\n            '*'\r\n        );\r\n        // 设置屏幕分辨率\r\n        window.parent.postMessage(\r\n            JSON.stringify({\r\n                method: 'onLoadComplete',\r\n                coursewareRatio: 16 / 9,\r\n            }),\r\n            '*'\r\n        );\r\n    }\r\n\r\n    // 重置面板\r\n    resetPanel() {\r\n        if (this._panel) {\r\n            let panelJs: any = this._panel.getComponent(cc.Component);\r\n            // 更新面板 ui 但不传信令\r\n            window['GlobalData'].stateProxy[this._panel.name] = \"\";\r\n            panelJs.reset();\r\n        }\r\n    }\r\n\r\n    // 老师恢复退出时状态\r\n    recoverState() {\r\n        if (window['GlobalData'].courseData.firstLoad) {\r\n            let db: any = cc.sys.localStorage.getItem('COURSE_SIGNALING_DB');\r\n            if (!db) return;\r\n            let signalingDB = JSON.parse(db);\r\n            // 老师 数据缓存\r\n            if (signalingDB && window['GlobalData'].courseData.role == 0) {\r\n                let curStamp = parseInt(this.getTimestamp());\r\n                let preStamp = parseInt(signalingDB.timestamp);\r\n\r\n                if ((curStamp - preStamp) / 60 < 35) {\r\n                    window['GlobalData'].courseData.timestamp = signalingDB.timestamp;\r\n                    let prevState = globalThis._.cloneDeep(window['GlobalData'].stateProxy[\"state\"]);\r\n\r\n                    Object.keys(prevState).forEach((v) => {\r\n                        if (!(globalThis._.isEqual(prevState[v], signalingDB.state[v]))) {\r\n                            // state 流转 临时\r\n                            window['GlobalData'].stateProxy[v] = \"\";\r\n                            window['GlobalData'].pubSub.emit(signalingDB.state[v], v);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            window['GlobalData'].courseData.firstLoad = false;\r\n        }\r\n    }\r\n\r\n    // 获取当前时间戳 前十位 秒\r\n    getTimestamp() {\r\n        return (+new Date()).toString().substr(0, 10);\r\n    }\r\n\r\n    // 同步 倒计时\r\n    countDown(user: any) {\r\n        let count = 6;\r\n        // 以秒为单位的时间间隔\r\n        let interval = 1;\r\n        // 重复次数\r\n        let repeat = 5;\r\n        // 开始延时\r\n        let delay = 0;\r\n        this.schedule(() => {\r\n            count--;\r\n            if (count == 1) {\r\n                this.sendInfo(user);\r\n            }\r\n        }, interval, repeat, delay);\r\n    }\r\n\r\n    sendInfo(user: any) {\r\n        let state = globalThis._.cloneDeep(window['GlobalData'].stateProxy[\"state\"]);\r\n        sendMessage(state, user);\r\n    }\r\n\r\n}\r\n"]}