{"version":3,"sources":["assets\\prefabLibrary\\controllers\\controller-model01\\scripts\\controller-model01.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;GAOG;AACG,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAEtC,IAAA,KAA+B,MAAM,CAAC,YAAY,CAAC,EAAjD,QAAQ,cAAA,EAAE,cAAc,oBAAyB,CAAC;AACpD,IAAA,KAA2C,MAAM,CAAC,YAAY,CAAC,CAAC,MAAM,EAApE,UAAU,gBAAA,EAAE,UAAU,gBAAA,EAAE,YAAY,kBAAgC,CAAC;AAI7E;IAAgD,sCAAY;IAA5D;QAAA,qEAsFC;QAnFW,kBAAY,GAAG,EAAE,CAAA,CAAS,UAAU;QAGpC,YAAM,GAAG,IAAI,CAAC,CAAa,OAAO;QAClC,gBAAU,GAAG,IAAI,CAAC,CAAS,KAAK;;IA+E5C,CAAC;IA9EG,mCAAM,GAAN,cAAW,CAAC;IAEN,iCAAI,GAAV,UAAW,IAAS;;;;;;wBAChB,OAAO;wBACP,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,YAAY,EAAE;4BAC/B,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;4BAC1B,sBAAO;yBACV;wBAED,KAAK;wBACL,yCAAyC;wBACzC,IAAI,CAAC,MAAM,CAAC,UAAU,EAAE;4BACpB,MAAM,CAAC,UAAU,GAAG,EAAE,CAAC;4BACvB,MAAM,CAAC,UAAU,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC;yBAClC;wBAED,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;wBAExB,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;wBAGhB,SAAS,GAAQ,KAAG,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,SAAW,CAAC;wBAC3F,qBAAM,UAAU,CAAC,SAAS,CAAC,EAAA;;wBAA9C,WAAW,GAAQ,SAA2B;wBAC3B,qBAAM,UAAU,CAAC,WAAW,EAAE,WAAW,CAAC,IAAI,CAAC,EAAA;;wBAAlE,WAAW,GAAQ,SAA+C;wBACtE,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;wBAC9C,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC;wBAClD,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;wBACxC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;wBAG/B,CAAC,GAAG,CAAC;;;6BAAE,CAAA,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAA;wBAChC,SAAS,GAAQ,KAAG,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,UAAY,CAAC;wBACnG,qBAAM,UAAU,CAAC,SAAS,CAAC,EAAA;;wBAA9C,WAAW,GAAQ,SAA2B;wBAC3B,qBAAM,UAAU,CAAC,WAAW,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,UAAU,CAAC,EAAA;;wBAAnF,WAAW,GAAQ,SAAgE;wBACvF,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,GAAG,WAAW,CAAC;;;wBAJG,CAAC,EAAE,CAAA;;;wBAQzC,YAAY,GAAQ,KAAG,IAAI,CAAC,UAAU,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,kBAAkB,GAAG,IAAI,CAAC,UAAU,CAAC,YAAc,CAAC;wBAC3H,KAAA,IAAI,CAAA;wBAAmB,qBAAM,UAAU,CAAC,YAAY,CAAC,EAAA;;wBAArD,GAAK,eAAe,GAAG,SAA8B,CAAC;wBACtD,KAAA,QAAQ,CAAA;wBAAkB,qBAAM,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,EAAA;;wBAA3G,GAAS,cAAc,GAAG,SAAiF,CAAC;wBAC5G,qBAAM,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,EAAA;;wBAA1B,SAA0B,CAAC;;;;;KAC9B;IAED,kBAAkB;IACZ,gDAAmB,GAAzB,UAA0B,MAAW,EAAE,WAAgB;;;gBACnD,sBAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;wBAC/B,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,MAAM,EAAE,WAAW,EAAE,UAAC,KAAK,EAAE,SAAc;4BAClE,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;wBAC/B,CAAC,CAAC,CAAC;oBACP,CAAC,CAAC,EAAA;;;KACL;IAED,UAAU;IACJ,yCAAY,GAAlB,UAAmB,MAAW;;;;gBACtB,IAAI,GAAW,MAAM,GAAG,CAAC,CAAC;gBAC1B,OAAO,GAAQ,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;gBAG/C,OAAO,GAAQ,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;gBAC9D,OAAO,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC;gBACtG,IAAI,CAAC,OAAO;oBAAE,sBAAO;gBAErB,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;gBAC5C,IAAI,IAAI,CAAC,gBAAgB;oBAAE,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC;gBAEvD,MAAM,GAAQ,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;gBACtC,IAAI,GAAQ,EAAE,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;gBACnC,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;gBAC7C,MAAM,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,KAAK,EAAE,OAAO,CAAC,KAAK,EAAE,UAAU,EAAE,OAAO,CAAC,UAAU,EAAE,CAAC,CAAC;gBAC/G,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC;gBAExB,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;gBAE7B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;gBACrB,gBAAgB;gBAChB,MAAM,CAAC,YAAY,CAAC,CAAC,UAAU,CAAC,UAAU,GAAG,UAAU,CAAC,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;;;;KACjH;IArFgB,kBAAkB;QADtC,OAAO;OACa,kBAAkB,CAsFtC;IAAD,yBAAC;CAtFD,AAsFC,CAtF+C,EAAE,CAAC,SAAS,GAsF3D;kBAtFoB,kBAAkB","file":"","sourceRoot":"/","sourcesContent":["/*\r\n * @Descripttion: \r\n * @version: \r\n * @Author: ydlx\r\n * @Date: 2020-12-22 11:02:45\r\n * @LastEditors: ydlx\r\n * @LastEditTime: 2021-05-13 21:26:06\r\n */\r\nconst { ccclass, property } = cc._decorator;\r\n\r\nconst { gameData, monitorMessage } = window['GlobalData'];\r\nconst { loadPrefab, loadBundle, loadResource } = window['GlobalData'].sample;\r\n\r\n\r\n@ccclass\r\nexport default class controller_model01 extends cc.Component {\r\n    private _configJson: any;         // 配置json\r\n    private _resourceBundle: any;     // fairygui 远程bundle\r\n    private _pagePrefabs = []         // 题型预制体集合\r\n    private _currentPageNode: any;    // 当前题型节点\r\n\r\n    private _cPage = null;             // 当前页码\r\n    private _panelNode = null;         // 面板\r\n    onLoad() { }\r\n\r\n    async init(data: any) {\r\n        // 素材资源\r\n        if (!data.pathConfig.resourceName) {\r\n            console.error(\"素材资源未配置！\");\r\n            return;\r\n        }\r\n\r\n        // 临时\r\n        // 因客户端(electron) 下，globalThis为 undefined\r\n        if (!window.globalThis) {\r\n            window.globalThis = {};\r\n            window.globalThis._ = window._;\r\n        }\r\n\r\n        this._configJson = data;\r\n\r\n        fgui.GRoot.create();\r\n\r\n        // 生成面板\r\n        let panelPath: any = `${data.pathConfig.remoteUrl}${data.pathConfig.panelBundlePath}${data.pathConfig.panelName}`;\r\n        let panelBundle: any = await loadBundle(panelPath);\r\n        let panelPrefab: any = await loadPrefab(panelBundle, panelBundle.name);\r\n        this._panelNode = cc.instantiate(panelPrefab);\r\n        this._panelNode.parent = cc.find(\"Canvas\").parent;\r\n        this._panelNode.x = cc.find(\"Canvas\").x;\r\n        this._panelNode.y = cc.find(\"Canvas\").y;\r\n\r\n        // 加载 所有题型预制件\r\n        for (let i = 0; i < data.chapters.length; i++) {\r\n            let modelPath: any = `${data.pathConfig.remoteUrl}${data.pathConfig.modelBundlePath}${data.chapters[i].model.bundleName}`;\r\n            let modelBundle: any = await loadBundle(modelPath);\r\n            let modelPrefab: any = await loadPrefab(modelBundle, data.chapters[i].model.prefabName);\r\n            this._pagePrefabs[i] = modelPrefab;\r\n        }\r\n\r\n        // 加载ui 资源包\r\n        let resourcePath: any = `${data.pathConfig.remoteUrl}${data.pathConfig.resourceBundlePath}${data.pathConfig.resourceName}`;\r\n        this._resourceBundle = await loadBundle(resourcePath);\r\n        gameData.resourceBundle = await this.loadResourcePackage(this._resourceBundle, data.pathConfig.packageName);\r\n        await this.onJumpConfig(1);\r\n    }\r\n\r\n    // 加载 fairygui 资源包\r\n    async loadResourcePackage(bundle: any, packageName: any) {\r\n        return new Promise((resolve, reject) => {\r\n            fgui.UIPackage.loadPackage(bundle, packageName, (error, UIPackage: any) => {\r\n                resolve(UIPackage._bundle);\r\n            });\r\n        })\r\n    }\r\n\r\n    // 页面跳转 配置\r\n    async onJumpConfig(toPage: any) {\r\n        let page: number = toPage - 1;\r\n        let chapter: any = this._configJson.chapters[page];\r\n\r\n        // 第一页 隐藏左箭头 最后一页 隐藏右箭头\r\n        let panelJs: any = this._panelNode.getComponent(cc.Component);\r\n        panelJs.init(page === 0 ? \"start\" : this._configJson.chapters.length - 1 === page ? \"end\" : \"normal\");\r\n        if (!chapter) return;\r\n\r\n        fgui.GRoot.inst.removeChildren(0, -1, true);\r\n        if (this._currentPageNode) this._currentPageNode.destroy();\r\n\r\n        let prefab: any = this._pagePrefabs[page];\r\n        let node: any = cc.instantiate(prefab);\r\n        let nodeJs = node.getComponent(cc.Component);\r\n        nodeJs.init({ pathConfig: this._configJson.pathConfig, model: chapter.model, components: chapter.components });\r\n        node.parent = this.node;\r\n\r\n        this._currentPageNode = node;\r\n\r\n        this._cPage = toPage;\r\n        // 当前页面 state 快照\r\n        window['GlobalData'].courseData.stateShoot = globalThis._.cloneDeep(window['GlobalData'].stateProxy[\"state\"]);\r\n    }\r\n}\r\n"]}